<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://nominatim.org/admin/Installation/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Basic Installation - Nominatim 3.5.1</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  <link href="../../styles.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Basic Installation";
    var mkdocs_page_input_path = "admin/Installation.md";
    var mkdocs_page_url = "/admin/Installation/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Nominatim 3.5.1</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Search/">Search</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Reverse/">Reverse</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Lookup/">Address Lookup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Details/">Details</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Status/">Status</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Output/">Place Output Formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Faq/">FAQ</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Administration Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Basic Installation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#software">Software</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#hardware">Hardware</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setup-of-the-server">Setup of the server</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#postgresql-tuning">PostgreSQL tuning</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#webserver-setup">Webserver setup</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configure-for-use-with-apache">Configure for use with Apache</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configure-for-use-with-nginx">Configure for use with Nginx</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Import-and-Update/">Importing and Updating</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Advanced-Installations/">Advanced Installations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Migration/">Migration from older Versions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Faq/">Troubleshooting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developers Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Import/">OSM Data Import</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Ranking/">Place Ranking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Postcodes/">Postcodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Documentation/">Documentation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">External Data Sources</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../data-sources/overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../data-sources/US-Tiger/">US Census (Tiger)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../data-sources/GB-Postcodes/">GB Postcodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../data-sources/Country-Grid/">Country Grid</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../data-sources/Wikipedia-Wikidata/">Wikipedia & Wikidata</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Appendix</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Centos-7/">Installation on CentOS 7</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Centos-8/">Installation on CentOS 8</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-18/">Installation on Ubuntu 18</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-20/">Installation on Ubuntu 20</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Nominatim 3.5.1</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration Guide &raquo;</li>
        
      
    
    <li>Basic Installation</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/openstreetmap/Nominatim/edit/master/docs/admin/Installation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="basic-installation">Basic Installation<a class="headerlink" href="#basic-installation" title="Permanent link"></a></h1>
<p>This page contains generic installation instructions for Nominatim and its
prerequisites. There are also step-by-step instructions available for
the following operating systems:</p>
<ul>
<li><a href="../../appendix/Install-on-Ubuntu-20/">Ubuntu 20.04</a></li>
<li><a href="../../appendix/Install-on-Ubuntu-18/">Ubuntu 18.04</a></li>
<li><a href="../../appendix/Install-on-Centos-8/">CentOS 8</a></li>
<li><a href="../../appendix/Install-on-Centos-7/">CentOS 7.2</a></li>
</ul>
<p>These OS-specific instructions can also be found in executable form
in the <code>vagrant/</code> directory.</p>
<p>Users have created instructions for other frameworks. We haven't tested those
and can't offer support.</p>
<ul>
<li><a href="https://github.com/mediagis/nominatim-docker">Docker</a></li>
<li><a href="https://github.com/peter-evans/nominatim-k8s">Docker on Kubernetes</a></li>
<li><a href="https://github.com/synthesio/infra-ansible-nominatim">Ansible</a></li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h2>
<h3 id="software">Software<a class="headerlink" href="#software" title="Permanent link"></a></h3>
<p>For compiling:</p>
<ul>
<li><a href="https://cmake.org/">cmake</a></li>
<li><a href="https://libexpat.github.io/">expat</a></li>
<li><a href="https://proj.org/">proj</a></li>
<li><a href="http://www.bzip.org/">bzip2</a></li>
<li><a href="https://www.zlib.net/">zlib</a></li>
<li><a href="https://www.boost.org/">Boost libraries</a>, including system and filesystem</li>
<li>PostgreSQL client libraries</li>
<li>a recent C++ compiler (gcc 5+ or Clang 3.8+)</li>
</ul>
<p>For running Nominatim:</p>
<ul>
<li><a href="https://www.postgresql.org">PostgreSQL</a> (9.3+)</li>
<li><a href="https://postgis.org">PostGIS</a> (2.2+)</li>
<li><a href="https://www.python.org/">Python 3</a></li>
<li><a href="https://initd.org/psycopg">Psycopg2</a></li>
<li><a href="https://php.net">PHP</a> (7.0 or later)</li>
<li>PHP-pgsql</li>
<li>PHP-intl (bundled with PHP)</li>
<li>a webserver (apache or nginx are recommended)</li>
</ul>
<p>For running continuous updates:</p>
<ul>
<li><a href="https://osmcode.org/pyosmium/">pyosmium</a> (with Python 3)</li>
</ul>
<p>For running tests:</p>
<ul>
<li><a href="http://pythonhosted.org/behave/">behave</a></li>
<li><a href="https://nose.readthedocs.io">nose</a></li>
<li><a href="https://phpunit.de">phpunit</a> &gt;= 7.3</li>
</ul>
<h3 id="hardware">Hardware<a class="headerlink" href="#hardware" title="Permanent link"></a></h3>
<p>A minimum of 2GB of RAM is required or installation will fail. For a full
planet import 64GB of RAM or more are strongly recommended. Do not report
out of memory problems if you have less than 64GB RAM.</p>
<p>For a full planet install you will need at least 800GB of hard disk space
(take into account that the OSM database is growing fast). SSD disks
will help considerably to speed up import and queries.</p>
<p>Even on a well configured machine the import of a full planet takes
at least 2 days. Without SSDs 7-8 days are more realistic.</p>
<h2 id="setup-of-the-server">Setup of the server<a class="headerlink" href="#setup-of-the-server" title="Permanent link"></a></h2>
<h3 id="postgresql-tuning">PostgreSQL tuning<a class="headerlink" href="#postgresql-tuning" title="Permanent link"></a></h3>
<p>You might want to tune your PostgreSQL installation so that the later steps
make best use of your hardware. You should tune the following parameters in
your <code>postgresql.conf</code> file.</p>
<div class="codehilite"><pre><span></span><code><span class="err">shared_buffers = 2GB</span>
<span class="err">maintenance_work_mem = (10GB)</span>
<span class="err">autovacuum_work_mem = 2GB</span>
<span class="err">work_mem = (50MB)</span>
<span class="err">effective_cache_size = (24GB)</span>
<span class="err">synchronous_commit = off</span>
<span class="err">checkpoint_segments = 100 # only for postgresql &lt;= 9.4</span>
<span class="err">max_wal_size = 1GB # postgresql &gt; 9.4</span>
<span class="err">checkpoint_timeout = 10min</span>
<span class="err">checkpoint_completion_target = 0.9</span>
</code></pre></div>


<p>The numbers in brackets behind some parameters seem to work fine for
64GB RAM machine. Adjust to your setup. A higher number for <code>max_wal_size</code>
means that PostgreSQL needs to run checkpoints less often but it does require
the additional space on your disk.</p>
<p>Autovacuum must not be switched off because it ensures that the
tables are frequently analysed. If your machine has very little memory,
you might consider setting:</p>
<div class="codehilite"><pre><span></span><code><span class="err">autovacuum_max_workers = 1</span>
</code></pre></div>


<p>and even reduce <code>autovacuum_work_mem</code> further. This will reduce the amount
of memory that autovacuum takes away from the import process.</p>
<p>For the initial import, you should also set:</p>
<div class="codehilite"><pre><span></span><code><span class="err">fsync = off</span>
<span class="err">full_page_writes = off</span>
</code></pre></div>


<p>Don't forget to reenable them after the initial import or you risk database
corruption.</p>
<h3 id="webserver-setup">Webserver setup<a class="headerlink" href="#webserver-setup" title="Permanent link"></a></h3>
<p>The <code>website/</code> directory in the build directory contains the configured
website. Include the directory into your webbrowser to serve php files
from there.</p>
<h4 id="configure-for-use-with-apache">Configure for use with Apache<a class="headerlink" href="#configure-for-use-with-apache" title="Permanent link"></a></h4>
<p>Make sure your Apache configuration contains the required permissions for the
directory and create an alias:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;Directory</span> <span class="s">&quot;/srv/nominatim/build/website&quot;</span><span class="nt">&gt;</span>
  <span class="nb">Options</span> FollowSymLinks MultiViews
  <span class="nb">AddType</span> text/html   .php
  <span class="nb">DirectoryIndex</span> search.php
  <span class="nb">Require</span> <span class="k">all</span> granted
<span class="nt">&lt;/Directory&gt;</span>
<span class="nb">Alias</span> <span class="sx">/nominatim</span> <span class="sx">/srv/nominatim/build/website</span>
</code></pre></div>


<p><code>/srv/nominatim/build</code> should be replaced with the location of your
build directory.</p>
<p>After making changes in the apache config you need to restart apache.
The website should now be available on http://localhost/nominatim.</p>
<h4 id="configure-for-use-with-nginx">Configure for use with Nginx<a class="headerlink" href="#configure-for-use-with-nginx" title="Permanent link"></a></h4>
<p>Use php-fpm as a deamon for serving PHP cgi. Install php-fpm together with nginx.</p>
<p>By default php listens on a network socket. If you want it to listen to a
Unix socket instead, change the pool configuration (<code>pool.d/www.conf</code>) as
follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">;</span> <span class="k">Comment</span> <span class="k">out</span> <span class="n">the</span> <span class="n">tcp</span> <span class="n">listener</span> <span class="k">and</span> <span class="k">add</span> <span class="n">the</span> <span class="n">unix</span> <span class="n">socket</span>
<span class="p">;</span><span class="k">listen</span> <span class="o">=</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">9000</span>
<span class="k">listen</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">php5</span><span class="o">-</span><span class="n">fpm</span><span class="p">.</span><span class="n">sock</span>

<span class="p">;</span> <span class="n">Ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">daemon</span> <span class="n">runs</span> <span class="k">as</span> <span class="n">the</span> <span class="n">correct</span> <span class="k">user</span>
<span class="k">listen</span><span class="p">.</span><span class="k">owner</span> <span class="o">=</span> <span class="n">www</span><span class="o">-</span><span class="k">data</span>
<span class="k">listen</span><span class="p">.</span><span class="k">group</span> <span class="o">=</span> <span class="n">www</span><span class="o">-</span><span class="k">data</span>
<span class="k">listen</span><span class="p">.</span><span class="k">mode</span> <span class="o">=</span> <span class="mi">0666</span>
</code></pre></div>


<p>Tell nginx that php files are special and to fastcgi_pass to the php-fpm
unix socket by adding the location definition to the default configuration.</p>
<div class="codehilite"><pre><span></span><code><span class="k">root</span> <span class="s">/srv/nominatim/build/website</span><span class="p">;</span>
<span class="k">index</span> <span class="s">search.php</span><span class="p">;</span>
<span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">@php</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="s">@php</span> <span class="p">{</span>
    <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="s">&quot;</span><span class="nv">$document_root$uri.php&quot;</span><span class="p">;</span>
    <span class="kn">fastcgi_param</span> <span class="s">PATH_TRANSLATED</span> <span class="s">&quot;</span><span class="nv">$document_root$uri.php&quot;</span><span class="p">;</span>
    <span class="kn">fastcgi_param</span> <span class="s">QUERY_STRING</span>    <span class="nv">$args</span><span class="p">;</span>
    <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php/php7.3-fpm.sock</span><span class="p">;</span>
    <span class="kn">fastcgi_index</span> <span class="s">index.php</span><span class="p">;</span>
    <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="p">~</span> <span class="sr">[^/]\.php(/|$)</span> <span class="p">{</span>
    <span class="kn">fastcgi_split_path_info</span> <span class="s">^(.+?\.php)(/.*)</span>$<span class="p">;</span>
    <span class="kn">if</span> <span class="s">(!-f</span> <span class="nv">$document_root$fastcgi_script_name</span><span class="s">)</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php7.3-fpm.sock</span><span class="p">;</span>
    <span class="kn">fastcgi_index</span> <span class="s">search.php</span><span class="p">;</span>
    <span class="kn">include</span> <span class="s">fastcgi.conf</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>


<p>Restart the nginx and php5-fpm services and the website should now be available
at <code>http://localhost/</code>.</p>
<p>Now continue with <a href="../Import-and-Update/">importing the database</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Import-and-Update/" class="btn btn-neutral float-right" title="Importing and Updating">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../api/Faq/" class="btn btn-neutral" title="FAQ"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/openstreetmap/Nominatim/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../api/Faq/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Import-and-Update/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
