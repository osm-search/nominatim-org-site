
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://nominatim.org/customize/Import-Styles/">
      
      
        <link rel="prev" href="../Overview/">
      
      
        <link rel="next" href="../Settings/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Import Styles - Nominatim 4.5.0 Manual</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../styles.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuring-the-import" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nominatim 4.5.0 Manual" class="md-header__button md-logo" aria-label="Nominatim 4.5.0 Manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nominatim 4.5.0 Manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Import Styles
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/openstreetmap/Nominatim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/Overview/" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../admin/Installation/" class="md-tabs__link">
          
  
  Administration Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Overview/" class="md-tabs__link">
          
  
  Customization Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../library/Getting-Started/" class="md-tabs__link">
          
  
  Library Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../develop/overview/" class="md-tabs__link">
          
  
  Developers Guide

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nominatim 4.5.0 Manual" class="md-nav__button md-logo" aria-label="Nominatim 4.5.0 Manual" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Nominatim 4.5.0 Manual
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openstreetmap/Nominatim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Reverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Lookup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Address Lookup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Details/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Details
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Status
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Place Output Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Administration Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administration Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Import/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Import
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Deployment-Python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy (Python frontend)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Deployment-PHP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy (PHP frontend)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Setup-Nominatim-UI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nominatim UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Advanced-Installations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Installations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Maintenance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migration from older Versions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Install-on-Ubuntu-22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation on Ubuntu 22
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/Install-on-Ubuntu-24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation on Ubuntu 24
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Customization Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Customization Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Import Styles
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Import Styles
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuring-the-import" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Import
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the Import">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-flex-baselua-module" class="md-nav__link">
    <span class="md-ellipsis">
      The flex-base.lua module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-recognized-tags" class="md-nav__link">
    <span class="md-ellipsis">
      Changing the recognized tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changing the recognized tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set_main_tags-principal-tags" class="md-nav__link">
    <span class="md-ellipsis">
      set_main_tags() - principal tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_prefilters-ignoring-tags" class="md-nav__link">
    <span class="md-ellipsis">
      set_prefilters() - ignoring tags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_name_tags-defining-names" class="md-nav__link">
    <span class="md-ellipsis">
      set_name_tags() - defining names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_address_tags-defining-address-parts" class="md-nav__link">
    <span class="md-ellipsis">
      set_address_tags() - defining address parts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_unused_handling-processing-remaining-tags" class="md-nav__link">
    <span class="md-ellipsis">
      set_unused_handling() - processing remaining tags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-osm2pgsql-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing osm2pgsql callbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customizing osm2pgsql callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-relation-types-to-be-handled" class="md-nav__link">
    <span class="md-ellipsis">
      Changing the relation types to be handled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-additional-logic-to-processing-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Adding additional logic to processing functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-the-main-processing-function" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing the main processing function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customizing the main processing function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-place-class" class="md-nav__link">
    <span class="md-ellipsis">
      The Place class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Match functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-gazetteer-output-of-osm2pgsql" class="md-nav__link">
    <span class="md-ellipsis">
      Using the gazetteer output of osm2pgsql
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-style-of-existing-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Changing the Style of Existing Databases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Result-Formatting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Result Formatting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Country-Settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Per-Country Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ranking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Place Ranking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Importance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Importance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tokenizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tokenizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Special-Phrases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Special Phrases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tiger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External data: US housenumbers from TIGER
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Postcodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External data: Postcodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SQLite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conversion to SQLite
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Library Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Library Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/Getting-Started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/NominatimAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nominatim API class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/Configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/Input-Parameter-Types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input Parameter Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/Result-Handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Result Handling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../library/Low-Level-DB-Access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Low-level DB Access
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developers Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developers Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/Database-Layout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Layout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/Indexing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indexing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/Tokenizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tokenizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/ICU-Tokenizer-Modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom modules for ICU tokenizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/Development-Environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup for Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/Testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/data-sources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Data Sources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Import Styles</h1>

<h2 id="configuring-the-import">Configuring the Import<a class="headerlink" href="#configuring-the-import" title="Permanent link">🔗</a></h2>
<p>In the very first step of a Nominatim import, OSM data is loaded into the
database. Nominatim uses <a href="https://osm2pgsql.org">osm2pgsql</a> for this task.
It comes with a <a href="https://osm2pgsql.org/doc/manual.html#the-flex-output">flex style</a>
specifically tailored to filter and convert OSM data into Nominatim's
internal data representation.</p>
<p>There are a number of default configurations for the flex style which
result in geocoding databases of different detail. The
<a href="../../admin/Import/#filtering-imported-data">Import section</a> explains
these default configurations in detail.</p>
<p>You can also create your own custom style. Put the style file into your
project directory and then set <code>NOMINATIM_IMPORT_STYLE</code> to the name of the file.
It is always recommended to start with one of the standard styles and customize
those. You find the standard styles under the name <code>import-&lt;stylename&gt;.lua</code>
in the standard Nominatim configuration path (usually <code>/etc/nominatim</code> or
<code>/usr/local/etc/nominatim</code>).</p>
<p>The remainder of the page describes how the flex style works and how to
customize it.</p>
<h3 id="the-flex-baselua-module">The <code>flex-base.lua</code> module<a class="headerlink" href="#the-flex-baselua-module" title="Permanent link">🔗</a></h3>
<p>The core of Nominatim's flex import configuration is the <code>flex-base</code> module.
It defines the table layout used by Nominatim and provides standard
implementations for the import callbacks that make it easy to customize
how OSM tags are used by Nominatim.</p>
<p>Every custom style should include this module to make sure that the correct
tables are created. Thus start your custom style as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;flex-base&#39;</span><span class="p">)</span>
</code></pre></div>
<p>The following sections explain how the module can be customized.</p>
<h3 id="changing-the-recognized-tags">Changing the recognized tags<a class="headerlink" href="#changing-the-recognized-tags" title="Permanent link">🔗</a></h3>
<p>If you just want to change which OSM tags are recognized during import,
then there are a number of convenience functions to set the tag lists used
during the processing.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are no built-in defaults for the tag lists, so all the functions
need to be called from your style script to fully process the data.
Make sure you start from one of the default style and only modify
the data you are interested in. You can also derive your style from an
existing style by importing the appropriate module, e.g.
<code>local flex = require('import-street')</code>.</p>
</div>
<p>Many of the following functions take <em>key match lists</em>. These lists can
contain three kinds of strings to match against tag keys:
A string that ends in an asterisk <code>*</code> is a prefix match and accordingly matches
against any key that starts with the given string (minus the <code>*</code>). 
A suffix match can be defined similarly with a string that starts with a <code>*</code>.
Any other string is matched exactly against tag keys.</p>
<h4 id="set_main_tags-principal-tags"><code>set_main_tags()</code> - principal tags<a class="headerlink" href="#set_main_tags-principal-tags" title="Permanent link">🔗</a></h4>
<p>If a principal or main tag is found on an OSM object, then the object
is included in Nominatim's search index. A single object may also have
multiple main tags. In that case, the object will be included multiple
times in the index, once for each main tag.</p>
<p>The flex script distinguishes between four types of main tags:</p>
<ul>
<li><strong>always</strong>: a main tag that is used unconditionally</li>
<li><strong>named</strong>: consider this main tag only, if the object has a proper name
  (a reference is not enough, see below).</li>
<li><strong>named_with_key</strong>: consider this main tag only, when the object has
  a proper name with a domain prefix. For example, if the main tag is
  <code>bridge=yes</code>, then it will only be added as an extra row, if there is
  a tag <code>bridge:name[:XXX]</code> for the same object. If this property is set,
  all other names that are not domain-specific are ignored.</li>
<li><strong>fallback</strong>: use this main tag only, if there is no other main tag.
  Fallback always implied <code>named</code>, i.e. fallbacks are only tried for
  named objects.</li>
</ul>
<p>The <code>set_main_tags()</code> function takes exactly one table parameter which
defines the keys and key/value combinations to include and the kind of
main tag. Each lua table key defines an OSM tag key. The value may
be a string defining the kind of main key as described above. Then the tag will
be considered a main tag for any possible value. To further restrict
which values are acceptable, give a table with the permitted values
and their kind of main tag. If the table contains a simple value without
key, then this is used as default for values that are not listed.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">set_main_tags</span><span class="p">{</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="p">{</span><span class="n">administrative</span> <span class="o">=</span> <span class="s1">&#39;named&#39;</span><span class="p">},</span>
    <span class="n">highway</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="n">street_lamp</span> <span class="o">=</span> <span class="s1">&#39;named&#39;</span><span class="p">},</span>
    <span class="n">landuse</span> <span class="o">=</span> <span class="s1">&#39;fallback&#39;</span>
<span class="p">}</span>
</code></pre></div>
<p>In this example an object with a <code>boundary</code> tag will only be included
when it has a value of <code>administrative</code>. Objects with <code>highway</code> tags are
always included. However when the value is <code>street_lamp</code> then the object
must have a name, too. With any other value, the object is included
independently of the name. Finally, if a <code>landuse</code> tag is present then
it will be used independely of the concrete value if neither boundary
nor highway tags were found and the object is named.</p>
</div>
<h4 id="set_prefilters-ignoring-tags"><code>set_prefilters()</code> - ignoring tags<a class="headerlink" href="#set_prefilters-ignoring-tags" title="Permanent link">🔗</a></h4>
<p>Pre-filtering of tags allows to ignore them for any further processing.
Thus pre-filtering takes precedence over any other tag processing. This is
useful when some specific key/value combinations need to be excluded from
processing. When tags are filtered, they may either be deleted completely
or moved to <code>extratags</code>. Extra tags are saved with the object and returned
to the user when requested, but are not used otherwise.</p>
<p><code>set_prefilters()</code> takes a table with four optional fields:</p>
<ul>
<li><strong>delete_keys</strong> is a <em>key match list</em> for tags that should be deleted</li>
<li><strong>delete_tags</strong> contains a table of tag keys pointing to a list of tag
  values. Tags with matching key/value pairs are deleted.</li>
<li><strong>extra_keys</strong> is a <em>key match list</em> for tags which should be saved into
  extratags</li>
<li><strong>extra_tags</strong> contains a table of tag keys pointing to a list of tag
  values. Tags with matching key/value pairs are moved to extratags.</li>
</ul>
<p>Key list may contain three kinds of strings:
A string that ends in an asterisk <code>*</code> is a prefix match and accordingly matches
against any key that starts with the given string (minus the <code>*</code>). 
A suffix match can be defined similarly with a string that starts with a <code>*</code>.
Any other string is matched exactly against tag keys.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">set_prefilters</span><span class="p">{</span>
    <span class="n">delete_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;source:*&#39;</span><span class="p">},</span>
    <span class="n">extra_tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">amenity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">}}</span>
<span class="p">}</span>
<span class="n">flex</span><span class="p">.</span><span class="n">set_main_tags</span><span class="p">{</span>
    <span class="n">amenity</span> <span class="o">=</span> <span class="s1">&#39;always&#39;</span>
<span class="p">}</span>
</code></pre></div>
<p>In this example any tags <code>source</code> and tags that begin with <code>source:</code>  are
deleted before any other processing is done. Getting rid of frequent tags
this way can speed up the import.</p>
<p>Tags with <code>amenity=yes</code> or <code>amenity=no</code> are moved to extratags. Later
all tags with an <code>amenity</code> key are made a main tag. This effectively means
that Nominatim will use all amenity tags except for those with value
yes and no.</p>
</div>
<h4 id="set_name_tags-defining-names"><code>set_name_tags()</code> - defining names<a class="headerlink" href="#set_name_tags-defining-names" title="Permanent link">🔗</a></h4>
<p>The flex script distinguishes between two kinds of names:</p>
<ul>
<li><strong>main</strong>: the primary names make an object fully searchable.
  Main tags of type <em>named</em> will only cause the object to be included when
  such a primary name is present. Primary names are usually those found
  in the <code>name</code> tag and its variants.</li>
<li><strong>extra</strong>: extra names are still added to the search index but they are
  alone not sufficient to make an object named.</li>
</ul>
<p><code>set_name_tags()</code> takes a table with two optional fields <code>main</code> and <code>extra</code>.
They take <em>key match lists</em> for main and extra names respectively.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;flex-base&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">set_main_tags</span><span class="p">{</span><span class="n">highway</span> <span class="o">=</span> <span class="p">{</span><span class="n">traffic_light</span> <span class="o">=</span> <span class="s1">&#39;named&#39;</span><span class="p">}}</span>
<span class="n">flex</span><span class="p">.</span><span class="n">set_name_tags</span><span class="p">{</span><span class="n">main</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;name:*&#39;</span><span class="p">},</span>
                   <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">}</span>
                  <span class="p">}</span>
</code></pre></div>
<p>This example creates a search index over traffic lights but will
only include those that have a common name and not those which just
have some reference ID from the city.</p>
</div>
<h4 id="set_address_tags-defining-address-parts"><code>set_address_tags()</code> - defining address parts<a class="headerlink" href="#set_address_tags-defining-address-parts" title="Permanent link">🔗</a></h4>
<p>Address tags will be used to build up the address of an object.</p>
<p><code>set_address_tags()</code> takes a table with arbitrary fields pointing to
<em>key match lists</em>. Two fields have a special meaning:</p>
<ul>
<li>
<p><strong>main</strong>: defines
the tags that make a full address object out of the OSM object. This
is usually the housenumber or variants thereof. If a main address tag
appears, then the object will always be included, if necessary with a
fallback of <code>place=house</code>. If the key has a prefix of <code>addr:</code> or <code>is_in:</code>
this will be stripped.</p>
</li>
<li>
<p><strong>extra</strong>: defines all supplementary tags for addresses, tags like <code>addr:street</code>, <code>addr:city</code> etc. If the key has a prefix of <code>addr:</code> or <code>is_in:</code> this will be stripped.</p>
</li>
</ul>
<p>All other fields will be handled as summary fields. If a key matches the
key match list, then its value will be added to the address tags with the
name of the field as key. If multiple tags match, then an arbitrary one
wins.</p>
<p>Country tags are handled slightly special. Only tags with a two-letter code
are accepted, all other values are discarded.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">set_address_tags</span><span class="p">{</span>
    <span class="n">main</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;addr:housenumber&#39;</span><span class="p">},</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;addr:*&#39;</span><span class="p">},</span>
    <span class="n">postcode</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;postal_code&#39;</span><span class="p">,</span> <span class="s1">&#39;postcode&#39;</span><span class="p">,</span> <span class="s1">&#39;addr:postcode&#39;</span><span class="p">},</span>
    <span class="n">country</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;ISO3166-1&#39;</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In this example all tags which begin with <code>addr:</code> will be saved in
the address tag list. If one of the tags is <code>addr:housenumber</code>, the
object will fall back to be entered as a <code>place=house</code> in the database
unless there is another interested main tag to be found.</p>
<p>Tags with keys <code>country_code</code> and <code>ISO3166-1</code> are saved with their
value under <code>country</code> in the address tag list. The same thing happens
to postcodes, they will always be saved under the key <code>postcode</code> thus
normalizing the multitude of keys that are used in the OSM database.</p>
</div>
<h4 id="set_unused_handling-processing-remaining-tags"><code>set_unused_handling()</code> - processing remaining tags<a class="headerlink" href="#set_unused_handling-processing-remaining-tags" title="Permanent link">🔗</a></h4>
<p>This function defines what to do with tags that remain after all tags
have been classified using the functions above. There are two ways in
which the function can be used:</p>
<p><code>set_unused_handling(delete_keys = ..., delete_tags = ...)</code> deletes all
keys that match the descriptions in the parameters and moves all remaining
tags into the extratags list.
<code>set_unused_handling(extra_keys = ..., extra_tags = ...)</code> moves all tags
matching the parameters into the extratags list and then deletes the remaining
tags. For the format of the parameters see the description in <code>set_prefilters()</code>
above.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">set_address_tags</span><span class="p">{</span>
    <span class="n">main</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;addr:housenumber&#39;</span><span class="p">},</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;addr:*&#39;</span><span class="p">,</span> <span class="s1">&#39;tiger:county&#39;</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">flex</span><span class="p">.</span><span class="n">set_unused_handling</span><span class="p">{</span><span class="n">delete_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tiger:*&#39;</span><span class="p">}}</span>
</code></pre></div>
<p>In this example all remaining tags except those beginning with <code>tiger:</code>
are moved to the extratags list. Note that it is not possible to
already delete the tiger tags with <code>set_prefilters()</code> because that
would remove tiger:county before the address tags are processed.</p>
</div>
<h3 id="customizing-osm2pgsql-callbacks">Customizing osm2pgsql callbacks<a class="headerlink" href="#customizing-osm2pgsql-callbacks" title="Permanent link">🔗</a></h3>
<p>osm2pgsql expects the flex style to implement three callbacks, one process
function per OSM type. If you want to implement special handling for
certain OSM types, you can override the default implementations provided
by the flex-base module.</p>
<h4 id="changing-the-relation-types-to-be-handled">Changing the relation types to be handled<a class="headerlink" href="#changing-the-relation-types-to-be-handled" title="Permanent link">🔗</a></h4>
<p>The default scripts only allows relations of type <code>multipolygon</code>, <code>boundary</code>
and <code>waterway</code>. To add other types relations, set <code>RELATION_TYPES</code> for
the type to the kind of geometry that should be created. The following
kinds of geometries can be used:</p>
<ul>
<li><strong>relation_as_multipolygon</strong> creates a (Multi)Polygon from the ways in
  the relation. If the ways do not form a valid area, then the object is
  silently discarded.</li>
<li><strong>relation_as_multiline</strong> creates a (Multi)LineString from the ways in
  the relations. Ways are combined as much as possible without any regards
  to their order in the relation.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="n">flex</span><span class="p">.</span><span class="n">RELATION_TYPES</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flex</span><span class="p">.</span><span class="n">relation_as_multipolygon</span>
</code></pre></div>
<p>With this line relations of <code>type=site</code> will be included in the index
according to main tags found. This only works when the site relation
resolves to a valid area. Nodes in the site relation are not part of the
geometry.</p>
</div>
<h4 id="adding-additional-logic-to-processing-functions">Adding additional logic to processing functions<a class="headerlink" href="#adding-additional-logic-to-processing-functions" title="Permanent link">🔗</a></h4>
<p>The default processing functions are also exported by the flex-base module
as <code>process_node</code>, <code>process_way</code> and <code>process_relation</code>. These can be used
to implement your own processing functions with some additional processing
logic.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="kr">function</span> <span class="nc">osm2pgsql</span><span class="p">.</span><span class="nf">process_relation</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">object</span><span class="p">.</span><span class="n">tags</span><span class="p">.</span><span class="n">boundary</span> <span class="o">~=</span> <span class="s1">&#39;administrative&#39;</span> <span class="ow">or</span> <span class="n">object</span><span class="p">.</span><span class="n">tags</span><span class="p">.</span><span class="n">admin_level</span> <span class="o">~=</span> <span class="s1">&#39;2&#39;</span> <span class="kr">then</span>
      <span class="n">flex</span><span class="p">.</span><span class="n">process_relation</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="kr">end</span>
</code></pre></div>
<p>This example discards all country-level boundaries and uses standard
handling for everything else. This can be useful if you want to use
your own custom country boundaries.</p>
</div>
<h3 id="customizing-the-main-processing-function">Customizing the main processing function<a class="headerlink" href="#customizing-the-main-processing-function" title="Permanent link">🔗</a></h3>
<p>The main processing function of the flex style can be found in the function
<code>process_tags</code>. This function is called for all OSM object kinds and is
responsible for filtering the tags and writing out the rows into Postgresql.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">flex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;import-full&#39;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">original_process_tags</span> <span class="o">=</span> <span class="n">flex</span><span class="p">.</span><span class="n">process_tags</span>

<span class="kr">function</span> <span class="nc">flex</span><span class="p">.</span><span class="nf">process_tags</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="kr">if</span> <span class="n">o</span><span class="p">.</span><span class="n">object</span><span class="p">.</span><span class="n">tags</span><span class="p">.</span><span class="n">highway</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">o</span><span class="p">.</span><span class="n">object</span><span class="p">.</span><span class="n">tags</span><span class="p">.</span><span class="n">access</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span> <span class="kr">then</span>
        <span class="kr">return</span>
    <span class="kr">end</span>

    <span class="n">original_process_tags</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>
<p>This example shows the most simple customization of the process_tags function.
It simply adds some additional processing before running the original code.
To do that, first save the original function and then overwrite process_tags
from the module. In this example all highways which are not accessible
by anyone will be ignored.</p>
</div>
<h4 id="the-place-class">The <code>Place</code> class<a class="headerlink" href="#the-place-class" title="Permanent link">🔗</a></h4>
<p>The <code>process_tags</code> function receives a Lua object of <code>Place</code> type which comes
with some handy functions to collect the data necessary for geocoding and
writing it into the place table. Always use this object to fill the table.</p>
<p>The Place class has some attributes which you may access read-only:</p>
<ul>
<li><strong>object</strong> is the original OSM object data handed in by osm2pgsql</li>
<li><strong>admin_level</strong> is the content of the admin_level tag, parsed into an
  integer and normalized to a value between 0 and 15</li>
<li><strong>has_name</strong> is a boolean indicating if the object has a full name</li>
<li><strong>names</strong> is a table with the collected list of name tags</li>
<li><strong>address</strong> is a table with the collected list of address tags</li>
<li><strong>extratags</strong> is a table with the collected list of additional tags to save</li>
</ul>
<p>There are a number of functions to fill these fields. All functions expect
a table parameter with fields as indicated in the description.
Many of these functions expect match functions which are described in detail
further below.</p>
<ul>
<li><strong>delete{match=...}</strong> removes all tags that match the match function given
  in <em>match</em>.</li>
<li><strong>grab_extratags{match=...}</strong> moves all tags that match the match function
  given in <em>match</em> into extratags. Returns the number of tags moved.</li>
<li><strong>clean{delete=..., extra=...}</strong> deletes all tags that match <em>delete</em> and
  moves the ones that match <em>extra</em>  into extratags</li>
<li><strong>grab_address_parts{groups=...}</strong> moves matching tags into the address table.
  <em>groups</em> must be a group match function. Tags of the group <code>main</code> and
  <code>extra</code> are added to the address table as is but with <code>addr:</code> and <code>is_in:</code>
  prefixes removed from the tag key. All other groups are added with the
  group name as key and the value from the tag. Multiple values of the same
  group overwrite each other. The function returns the number of tags saved
  from the main group.</li>
<li><strong>grab_main_parts{groups=...}</strong> moves matching tags into the name table.
  <em>groups</em> must be a group match function. If a tags of the group <code>main</code> is
  present, the object will be marked as having a name. Tags of group <code>house</code>
  produce a fallback to <code>place=house</code>. This fallback is return by the function
  if present.</li>
</ul>
<p>There are two functions to write a row into the place table. Both functions
expect the main tag (key and value) for the row and then use the collected
information from the name, address, extratags etc. fields to complete the row.
They also have a boolean parameter <code>save_extra_mains</code> which defines how any
unprocessed tags are handled: when True, the tags will be saved as extratags,
when False, they will be simply discarded.</p>
<ul>
<li><strong>write_row(key, value, save_extra_mains)</strong> creates a new table row from
  the current state of the Place object.</li>
<li><strong>write_place(key, value, mtype, save_extra_mains)</strong> creates a new row
  conditionally. When value is nil, the function will attempt to look up the
  value in the object tags. If value is still nil or mtype is nil, the row
  is ignored. An mtype of <code>always</code> will then always write out the row,
  a mtype of <code>named</code> only, when the object has a full name. When mtype
  is <code>named_with_key</code>, the function checks for a domain name, i.e. a name
  tag prefixed with the name of the main key. Only if at least one is found,
  the row will be written. The names are replaced with the domain names found.</li>
</ul>
<h4 id="match-functions">Match functions<a class="headerlink" href="#match-functions" title="Permanent link">🔗</a></h4>
<p>The Place functions usually expect either a <em>match function</em> or a
<em>group match function</em> to find the tags to apply their function to.</p>
<p>The <strong>match function</strong> is a Lua function which takes two parameters,
key and value, and returns a boolean to indicate that a tag matches. The
flex-base module has a convenience function <code>tag_match()</code> to create such a
function. It takes a table with two optional fields: <code>keys</code> takes a key match
list (see above), <code>tags</code> takes a table with keys that point to a list of
possible values, thus defining key/value matches.</p>
<p>The <strong>group match function</strong> is a Lua function which also takes two parameters,
key and value, and returns a string indicating to which group or type they
belong to. The <code>tag_group()</code> can be used to create such a function. It expects
a table where the group names are the keys and the values are a key match list.</p>
<h3 id="using-the-gazetteer-output-of-osm2pgsql">Using the gazetteer output of osm2pgsql<a class="headerlink" href="#using-the-gazetteer-output-of-osm2pgsql" title="Permanent link">🔗</a></h3>
<p>Nominatim still allows you to configure the gazetteer output to remain
backwards compatible with older imports. It will be automatically used
when the style file name ends in <code>.style</code>. For documentation of the
old import style, please refer to the documentation of older releases
of Nominatim. Do not use the gazetteer output for new imports. There is no
guarantee that new versions of Nominatim are fully compatible with the
gazetteer output.</p>
<h3 id="changing-the-style-of-existing-databases">Changing the Style of Existing Databases<a class="headerlink" href="#changing-the-style-of-existing-databases" title="Permanent link">🔗</a></h3>
<p>There is normally no issue changing the style of a database that is already
imported and now kept up-to-date with change files. Just be aware that any
change in the style applies to updates only. If you want to change the data
that is already in the database, then a reimport is necessary.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Nominatim developer community
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "toc.integrate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>