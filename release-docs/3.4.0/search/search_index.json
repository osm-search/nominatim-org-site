{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Nominatim (from the Latin, 'by name') is a tool to search OSM data by name and address and to generate synthetic addresses of OSM points (reverse geocoding). This guide comes in three parts: API reference for users of Nominatim Administration Guide for those who want to install their own Nominatim server Developer's Guide for developers of the software","title":"Introduction"},{"location":"admin/Faq/","text":"Troubleshooting Nominatim Installations \uf0c1 Installation Issues \uf0c1 Can a stopped/killed import process be resumed? \uf0c1 \"I accidentally killed the import process after it has been running for many hours. Can it be resumed?\" It is possible if the import already got to the indexing stage. Check the last line of output that was logged before the process was killed. If it looks like this: Done 844 in 13 @ 64.923080 per second - Rank 26 ETA (seconds): 7.886255 then you can resume with the following command: ./utils/setup.php --index --create-search-indices --create-country-names If the reported rank is 26 or higher, you can also safely add --index-noanalyse . PHP \"open_basedir restriction in effect\" warnings \uf0c1 PHP Warning: file_get_contents(): open_basedir restriction in effect. You need to adjust the open_basedir setting in your PHP configuration ( php.ini file ). By default this setting may look like this: open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/ Either add reported directories to the list or disable this setting temporarily by dding \";\" at the beginning of the line. Don't forget to enable this setting again once you are done with the PHP command line operations. PHP timzeone warnings \uf0c1 The Apache log may contain lots of PHP warnings like this: PHP Warning: date_default_timezone_set() function. You should set the default time zone as instructed in the warning in your php.ini file. Find the entry about timezone and set it to something like this: ; Defines the default timezone used by the date functions ; https://php.net/date.timezone date.timezone = 'America/Denver' Or echo \"date.timezone = 'America/Denver'\" > /etc/php.d/timezone.ini nominatim.so version mismatch \uf0c1 When running the import you may get a version mismatch: COPY_END for place failed: ERROR: incompatible library \"/srv/Nominatim/nominatim/build/module/nominatim.so\": version mismatch pg_config seems to use bad includes sometimes when multiple versions of PostgreSQL are available in the system. Make sure you remove the server development libraries ( postgresql-server-dev-9.5 on Ubuntu) and recompile ( cmake .. && make ). I see the error \"ERROR: permission denied for language c\" \uf0c1 nominatim.so , written in C, is required to be installed on the database server. Some managed database (cloud) services like Amazon RDS do not allow this. There is currently no work-around other than installing a database on a non-managed machine. I see the error: \"function transliteration(text) does not exist\" \uf0c1 Reinstall the nominatim functions with setup.php --create--functions and check for any errors, e.g. a missing nominatim.so file. I see the error: \"ERROR: mmap (remap) failed\" \uf0c1 This may be a simple out-of-memory error. Try reducing the memory used for --osm2pgsql-cache . Also make sure that overcommitting memory is allowed: cat /proc/sys/vm/overcommit_memory should print 0 or 1. If you are using a flatnode file, then it may also be that the underlying filesystem does not fully support 'mmap'. A notable candidate is virtualbox's vboxfs. nominatim UPDATE failed: ERROR: buffer 179261 is not owned by resource owner Portal \uf0c1 Several users reported this during the initial import of the database. It's something PostgreSQL internal Nominatim doesn't control. And PostgreSQL forums suggest it's threading related but definitely some kind of crash of a process. Users reported either rebooting the server, different hardware or just trying the import again worked. The website shows: \"Could not get word tokens\" \uf0c1 The server cannot access your database. Add &debug=1 to your URL to get the full error message. On CentOS the website shows \"Could not connect to server\" \uf0c1 could not connect to server: No such file or directory On CentOS v7 the PostgreSQL server is started with systemd . Check if /usr/lib/systemd/system/httpd.service contains a line PrivateTmp=true . If so then Apache cannot see the /tmp/.s.PGSQL.5432 file. It's a good security feature, so use the preferred solution . However, you can solve this the quick and dirty way by commenting out that line and then run sudo systemctl daemon-reload sudo systemctl restart httpd \"must be an array or an object that implements Countable\" warning in /usr/share/pear/DB.php \uf0c1 The warning started with PHP 7.2. Make sure you have at least version 1.9.3 of PEAR DB installed. Website reports \"DB Error: insufficient permissions\" \uf0c1 The user the webserver, e.g. Apache, runs under needs to have access to the Nominatim database. You can find the user like this , for default Ubuntu operating system for example it's www-data . Repeat the createuser step of the installation instructions. Give the user permission to existing tables GRANT usage ON SCHEMA public TO \"www-data\"; GRANT SELECT ON ALL TABLES IN SCHEMA public TO \"www-data\"; Website reports \"Could not load library \"nominatim.so\" \uf0c1 Example error message SELECT make_standard_name('3039 E MEADOWLARK LN') [nativecode=ERROR: could not load library \"/srv/nominatim/Nominatim-3.1.0/build/module/nominatim.so\": /srv/nominatim/Nominatim-3.1.0/build/module/nominatim.so: cannot open shared object file: Permission denied CONTEXT: PL/pgSQL function make_standard_name(text) line 5 at assignment] The PostgreSQL database, i.e. user postgres , needs to have access to that file. The permission need to be read & executable by everybody, e.g. -rwxr-xr-x 1 nominatim nominatim 297984 build/module/nominatim.so Try chmod a+r nominatim.so; chmod a+x nominatim.so . When running SELinux, make sure that the context is set up correctly . Setup.php fails with \"DB Error: extension not found\" \uf0c1 Make sure you have the PostgreSQL extensions \"hstore\" and \"postgis\" installed. See the installation instruction for a full list of required packages. Setup.php reports \"Cannot redeclare getDB()\" \uf0c1 Cannot redeclare getDB() (previously declared in /your/path/Nominatim/lib/db.php:4) The message is a bit misleading as PHP needs to load the file DB.php and instead re-loads Nominatim's db.php . To solve this make sure you have the Pear module 'DB' installed. sudo pear install DB I forgot to delete the flatnodes file before starting an import. \uf0c1 That's fine. For each import the flatnodes file get overwritten. See https://help.openstreetmap.org/questions/52419/nominatim-flatnode-storage for more information. Running your own instance \uf0c1 Can I import multiple countries and keep them up to date? \uf0c1 You should use the extracts and updates from https://download.geofabrik.de. For the initial import, download the countries you need and merge them. See OSM Help for examples how to do that. Use the resulting single osm file when running setup.php . For updates you need to download the change files for each country once per day and apply them separately using ./utils/update.php --import-diff <filename> --index See this issue for a script that runs the updates using osmosis. Can I import negative OSM ids into Nominatim? \uf0c1 See this question of Stackoverflow . Missing XML or text declaration \uf0c1 The website might show: XML Parsing Error: XML or text declaration not at start of entity Location. Make sure there are no spaces at the beginning of your settings/local.php file.","title":"Troubleshooting"},{"location":"admin/Faq/#troubleshooting-nominatim-installations","text":"","title":"Troubleshooting Nominatim Installations"},{"location":"admin/Faq/#installation-issues","text":"","title":"Installation Issues"},{"location":"admin/Faq/#can-a-stoppedkilled-import-process-be-resumed","text":"\"I accidentally killed the import process after it has been running for many hours. Can it be resumed?\" It is possible if the import already got to the indexing stage. Check the last line of output that was logged before the process was killed. If it looks like this: Done 844 in 13 @ 64.923080 per second - Rank 26 ETA (seconds): 7.886255 then you can resume with the following command: ./utils/setup.php --index --create-search-indices --create-country-names If the reported rank is 26 or higher, you can also safely add --index-noanalyse .","title":"Can a stopped/killed import process be resumed?"},{"location":"admin/Faq/#php-open_basedir-restriction-in-effect-warnings","text":"PHP Warning: file_get_contents(): open_basedir restriction in effect. You need to adjust the open_basedir setting in your PHP configuration ( php.ini file ). By default this setting may look like this: open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/ Either add reported directories to the list or disable this setting temporarily by dding \";\" at the beginning of the line. Don't forget to enable this setting again once you are done with the PHP command line operations.","title":"PHP \"open_basedir restriction in effect\" warnings"},{"location":"admin/Faq/#php-timzeone-warnings","text":"The Apache log may contain lots of PHP warnings like this: PHP Warning: date_default_timezone_set() function. You should set the default time zone as instructed in the warning in your php.ini file. Find the entry about timezone and set it to something like this: ; Defines the default timezone used by the date functions ; https://php.net/date.timezone date.timezone = 'America/Denver' Or echo \"date.timezone = 'America/Denver'\" > /etc/php.d/timezone.ini","title":"PHP timzeone warnings"},{"location":"admin/Faq/#nominatimso-version-mismatch","text":"When running the import you may get a version mismatch: COPY_END for place failed: ERROR: incompatible library \"/srv/Nominatim/nominatim/build/module/nominatim.so\": version mismatch pg_config seems to use bad includes sometimes when multiple versions of PostgreSQL are available in the system. Make sure you remove the server development libraries ( postgresql-server-dev-9.5 on Ubuntu) and recompile ( cmake .. && make ).","title":"nominatim.so version mismatch"},{"location":"admin/Faq/#i-see-the-error-error-permission-denied-for-language-c","text":"nominatim.so , written in C, is required to be installed on the database server. Some managed database (cloud) services like Amazon RDS do not allow this. There is currently no work-around other than installing a database on a non-managed machine.","title":"I see the error \"ERROR: permission denied for language c\""},{"location":"admin/Faq/#i-see-the-error-function-transliterationtext-does-not-exist","text":"Reinstall the nominatim functions with setup.php --create--functions and check for any errors, e.g. a missing nominatim.so file.","title":"I see the error: \"function transliteration(text) does not exist\""},{"location":"admin/Faq/#i-see-the-error-error-mmap-remap-failed","text":"This may be a simple out-of-memory error. Try reducing the memory used for --osm2pgsql-cache . Also make sure that overcommitting memory is allowed: cat /proc/sys/vm/overcommit_memory should print 0 or 1. If you are using a flatnode file, then it may also be that the underlying filesystem does not fully support 'mmap'. A notable candidate is virtualbox's vboxfs.","title":"I see the error: \"ERROR: mmap (remap) failed\""},{"location":"admin/Faq/#nominatim-update-failed-error-buffer-179261-is-not-owned-by-resource-owner-portal","text":"Several users reported this during the initial import of the database. It's something PostgreSQL internal Nominatim doesn't control. And PostgreSQL forums suggest it's threading related but definitely some kind of crash of a process. Users reported either rebooting the server, different hardware or just trying the import again worked.","title":"nominatim UPDATE failed: ERROR: buffer 179261 is not owned by resource owner Portal"},{"location":"admin/Faq/#the-website-shows-could-not-get-word-tokens","text":"The server cannot access your database. Add &debug=1 to your URL to get the full error message.","title":"The website shows: \"Could not get word tokens\""},{"location":"admin/Faq/#on-centos-the-website-shows-could-not-connect-to-server","text":"could not connect to server: No such file or directory On CentOS v7 the PostgreSQL server is started with systemd . Check if /usr/lib/systemd/system/httpd.service contains a line PrivateTmp=true . If so then Apache cannot see the /tmp/.s.PGSQL.5432 file. It's a good security feature, so use the preferred solution . However, you can solve this the quick and dirty way by commenting out that line and then run sudo systemctl daemon-reload sudo systemctl restart httpd","title":"On CentOS the website shows \"Could not connect to server\""},{"location":"admin/Faq/#must-be-an-array-or-an-object-that-implements-countable-warning-in-usrsharepeardbphp","text":"The warning started with PHP 7.2. Make sure you have at least version 1.9.3 of PEAR DB installed.","title":"\"must be an array or an object that implements Countable\" warning in /usr/share/pear/DB.php"},{"location":"admin/Faq/#website-reports-db-error-insufficient-permissions","text":"The user the webserver, e.g. Apache, runs under needs to have access to the Nominatim database. You can find the user like this , for default Ubuntu operating system for example it's www-data . Repeat the createuser step of the installation instructions. Give the user permission to existing tables GRANT usage ON SCHEMA public TO \"www-data\"; GRANT SELECT ON ALL TABLES IN SCHEMA public TO \"www-data\";","title":"Website reports \"DB Error: insufficient permissions\""},{"location":"admin/Faq/#website-reports-could-not-load-library-nominatimso","text":"Example error message SELECT make_standard_name('3039 E MEADOWLARK LN') [nativecode=ERROR: could not load library \"/srv/nominatim/Nominatim-3.1.0/build/module/nominatim.so\": /srv/nominatim/Nominatim-3.1.0/build/module/nominatim.so: cannot open shared object file: Permission denied CONTEXT: PL/pgSQL function make_standard_name(text) line 5 at assignment] The PostgreSQL database, i.e. user postgres , needs to have access to that file. The permission need to be read & executable by everybody, e.g. -rwxr-xr-x 1 nominatim nominatim 297984 build/module/nominatim.so Try chmod a+r nominatim.so; chmod a+x nominatim.so . When running SELinux, make sure that the context is set up correctly .","title":"Website reports \"Could not load library \"nominatim.so\""},{"location":"admin/Faq/#setupphp-fails-with-db-error-extension-not-found","text":"Make sure you have the PostgreSQL extensions \"hstore\" and \"postgis\" installed. See the installation instruction for a full list of required packages.","title":"Setup.php fails with \"DB Error: extension not found\""},{"location":"admin/Faq/#setupphp-reports-cannot-redeclare-getdb","text":"Cannot redeclare getDB() (previously declared in /your/path/Nominatim/lib/db.php:4) The message is a bit misleading as PHP needs to load the file DB.php and instead re-loads Nominatim's db.php . To solve this make sure you have the Pear module 'DB' installed. sudo pear install DB","title":"Setup.php reports \"Cannot redeclare getDB()\""},{"location":"admin/Faq/#i-forgot-to-delete-the-flatnodes-file-before-starting-an-import","text":"That's fine. For each import the flatnodes file get overwritten. See https://help.openstreetmap.org/questions/52419/nominatim-flatnode-storage for more information.","title":"I forgot to delete the flatnodes file before starting an import."},{"location":"admin/Faq/#running-your-own-instance","text":"","title":"Running your own instance"},{"location":"admin/Faq/#can-i-import-multiple-countries-and-keep-them-up-to-date","text":"You should use the extracts and updates from https://download.geofabrik.de. For the initial import, download the countries you need and merge them. See OSM Help for examples how to do that. Use the resulting single osm file when running setup.php . For updates you need to download the change files for each country once per day and apply them separately using ./utils/update.php --import-diff <filename> --index See this issue for a script that runs the updates using osmosis.","title":"Can I import multiple countries and keep them up to date?"},{"location":"admin/Faq/#can-i-import-negative-osm-ids-into-nominatim","text":"See this question of Stackoverflow .","title":"Can I import negative OSM ids into Nominatim?"},{"location":"admin/Faq/#missing-xml-or-text-declaration","text":"The website might show: XML Parsing Error: XML or text declaration not at start of entity Location. Make sure there are no spaces at the beginning of your settings/local.php file.","title":"Missing XML or text declaration"},{"location":"admin/Import-and-Update/","text":"Importing and Updating the Database \uf0c1 The following instructions explain how to create a Nominatim database from an OSM planet file and how to keep the database up to date. It is assumed that you have already successfully installed the Nominatim software itself, if not return to the installation page . Configuration setup in settings/local.php \uf0c1 The Nominatim server can be customized via the file settings/local.php in the build directory. Note that this is a PHP file, so it must always start like this: <?php without any leading spaces. There are lots of configuration settings you can tweak. Have a look at settings/default.php for a full list. Most should have a sensible default. Flatnode files \uf0c1 If you plan to import a large dataset (e.g. Europe, North America, planet), you should also enable flatnode storage of node locations. With this setting enabled, node coordinates are stored in a simple file instead of the database. This will save you import time and disk storage. Add to your settings/local.php : @define('CONST_Osm2pgsql_Flatnode_File', '/path/to/flatnode.file'); Replace the second part with a suitable path on your system and make sure the directory exists. There should be at least 40GB of free space. Downloading additional data \uf0c1 Wikipedia rankings \uf0c1 Wikipedia can be used as an optional auxiliary data source to help indicate the importance of OSM features. Nominatim will work without this information but it will improve the quality of the results if this is installed. This data is available as a binary download: cd $NOMINATIM_SOURCE_DIR/data wget https://www.nominatim.org/data/wikipedia_article.sql.bin wget https://www.nominatim.org/data/wikipedia_redirect.sql.bin Combined the 2 files are around 1.5GB and add around 30GB to the install size of Nominatim. They also increase the install time by an hour or so. NOTE: you'll need to download the Wikipedia rankings before performing the initial import of the data if you want the rankings applied to the loaded data. Great Britain, USA postcodes \uf0c1 Nominatim can use postcodes from an external source to improve searches that involve a GB or US postcode. This data can be optionally downloaded: cd $NOMINATIM_SOURCE_DIR/data wget https://www.nominatim.org/data/gb_postcode_data.sql.gz wget https://www.nominatim.org/data/us_postcode_data.sql.gz Choosing the Data to Import \uf0c1 In its default setup Nominatim is configured to import the full OSM data set for the entire planet. Such a setup requires a powerful machine with at least 32GB of RAM and around 800GB of SSD hard disks. Depending on your use case there are various ways to reduce the amount of data imported. This section discusses these methods. They can also be combined. Using an extract \uf0c1 If you only need geocoding for a smaller region, then precomputed extracts are a good way to reduce the database size and import time. Geofabrik offers extracts for most countries. They even have daily updates which can be used with the update process described below. There are also other providers for extracts . Please be aware that some extracts are not cut exactly along the country boundaries. As a result some parts of the boundary may be missing which means that Nominatim cannot compute the areas for some administrative areas. Dropping Data Required for Dynamic Updates \uf0c1 About half of the data in Nominatim's database is not really used for serving the API. It is only there to allow the data to be updated from the latest changes from OSM. For many uses these dynamic updates are not really required. If you don't plan to apply updates, the dynamic part of the database can be safely dropped using the following command: ./utils/setup.php --drop Note that you still need to provide for sufficient disk space for the initial import. So this option is particularly interesting if you plan to transfer the database or reuse the space later. Reverse-only Imports \uf0c1 If you only want to use the Nominatim database for reverse lookups or if you plan to use the installation only for exports to a photon database, then you can set up a database without search indexes. Add --reverse-only to your setup command above. This saves about 5% of disk space. Filtering Imported Data \uf0c1 Nominatim normally sets up a full search database containing administrative boundaries, places, streets, addresses and POI data. There are also other import styles available which only read selected data: settings/import-admin.style Only import administrative boundaries and places. settings/import-street.style Like the admin style but also adds streets. settings/import-address.style Import all data necessary to compute addresses down to house number level. settings/import-full.style Default style that also includes points of interest. The style can be changed with the configuration CONST_Import_Style . To give you an idea of the impact of using the different styles, the table below gives rough estimates of the final database size after import of a 2018 planet and after using the --drop option. It also shows the time needed for the import on a machine with 32GB RAM, 4 CPUS and SSDs. Note that the given sizes are just an estimate meant for comparison of style requirements. Your planet import is likely to be larger as the OSM data grows with time. style Import time DB size after drop admin 5h 190 GB 20 GB street 42h 400 GB 180 GB address 59h 500 GB 260 GB full 80h 575 GB 300 GB You can also customize the styles further. For an description of the style format see the development section . Initial import of the data \uf0c1 Important: first try the import with a small extract, for example from Geofabrik . Download the data to import and load the data with the following command from the build directory: ./utils/setup.php --osm-file <data file> --all [--osm2pgsql-cache 28000] 2>&1 | tee setup.log The --osm2pgsql-cache parameter is optional but strongly recommended for planet imports. It sets the node cache size for the osm2pgsql import part (see -C parameter in osm2pgsql help). As a rule of thumb, this should be about the same size as the file you are importing but never more than 2/3 of RAM available. If your machine starts swapping reduce the size. Computing word frequency for search terms can improve the performance of forward geocoding in particular under high load as it helps PostgreSQL's query planner to make the right decisions. To recompute word counts run: ./utils/update.php --recompute-word-counts This will take a couple of hours for a full planet installation. You can also defer that step to a later point in time when you realise that performance becomes an issue. Just make sure that updates are stopped before running this function. If you want to be able to search for places by their type through special key phrases you also need to enable these key phrases like this: ./utils/specialphrases.php --wiki-import > specialphrases.sql psql -d nominatim -f specialphrases.sql Note that this command downloads the phrases from the wiki link above. Installing Tiger housenumber data for the US \uf0c1 Nominatim is able to use the official TIGER address set to complement the OSM house number data in the US. You can add TIGER data to your own Nominatim instance by following these steps. The entire US adds about 10GB to your database. Get preprocessed TIGER 2019 data and unpack it into the data directory in your Nominatim sources: cd Nominatim/data wget https://nominatim.org/data/tiger2019-nominatim-preprocessed.tar.gz tar xf tiger2019-nominatim-preprocessed.tar.gz data-source/us-tiger/README.md explains how the data got preprocessed. Import the data into your Nominatim database: ./utils/setup.php --import-tiger-data Enable use of the Tiger data in your settings/local.php by adding: @define('CONST_Use_US_Tiger_Data', true); Apply the new settings: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions Updates \uf0c1 There are many different ways to update your Nominatim database. The following section describes how to keep it up-to-date with Pyosmium. For a list of other methods see the output of ./utils/update.php --help . Installing the newest version of Pyosmium \uf0c1 It is recommended to install Pyosmium via pip. Make sure to use python3. Run (as the same user who will later run the updates): pip3 install --user osmium Nominatim needs a tool called pyosmium-get-updates which comes with Pyosmium. You need to tell Nominatim where to find it. Add the following line to your settings/local.php : @define('CONST_Pyosmium_Binary', '/home/user/.local/bin/pyosmium-get-changes'); The path above is fine if you used the --user parameter with pip. Replace user with your user name. Setting up the update process \uf0c1 Next the update needs to be initialised. By default Nominatim is configured to update using the global minutely diffs. If you want a different update source you will need to add some settings to settings/local.php . For example, to use the daily country extracts diffs for Ireland from Geofabrik add the following: // base URL of the replication service @define('CONST_Replication_Url', 'https://download.geofabrik.de/europe/ireland-and-northern-ireland-updates'); // How often upstream publishes diffs @define('CONST_Replication_Update_Interval', '86400'); // How long to sleep if no update found yet @define('CONST_Replication_Recheck_Interval', '900'); To set up the update process now run the following command: ./utils/update.php --init-updates It outputs the date where updates will start. Recheck that this date is what you expect. The --init-updates command needs to be rerun whenever the replication service is changed. Updating Nominatim \uf0c1 The following command will keep your database constantly up to date: ./utils/update.php --import-osmosis-all (Note that even though the old name \"import-osmosis-all\" has been kept for compatibility reasons, Osmosis is not required to run this - it uses pyosmium behind the scenes.) If you have imported multiple country extracts and want to keep them up-to-date, have a look at the script in issue #60 .","title":"Importing and Updating"},{"location":"admin/Import-and-Update/#importing-and-updating-the-database","text":"The following instructions explain how to create a Nominatim database from an OSM planet file and how to keep the database up to date. It is assumed that you have already successfully installed the Nominatim software itself, if not return to the installation page .","title":"Importing and Updating the Database"},{"location":"admin/Import-and-Update/#configuration-setup-in-settingslocalphp","text":"The Nominatim server can be customized via the file settings/local.php in the build directory. Note that this is a PHP file, so it must always start like this: <?php without any leading spaces. There are lots of configuration settings you can tweak. Have a look at settings/default.php for a full list. Most should have a sensible default.","title":"Configuration setup in settings/local.php"},{"location":"admin/Import-and-Update/#flatnode-files","text":"If you plan to import a large dataset (e.g. Europe, North America, planet), you should also enable flatnode storage of node locations. With this setting enabled, node coordinates are stored in a simple file instead of the database. This will save you import time and disk storage. Add to your settings/local.php : @define('CONST_Osm2pgsql_Flatnode_File', '/path/to/flatnode.file'); Replace the second part with a suitable path on your system and make sure the directory exists. There should be at least 40GB of free space.","title":"Flatnode files"},{"location":"admin/Import-and-Update/#downloading-additional-data","text":"","title":"Downloading additional data"},{"location":"admin/Import-and-Update/#wikipedia-rankings","text":"Wikipedia can be used as an optional auxiliary data source to help indicate the importance of OSM features. Nominatim will work without this information but it will improve the quality of the results if this is installed. This data is available as a binary download: cd $NOMINATIM_SOURCE_DIR/data wget https://www.nominatim.org/data/wikipedia_article.sql.bin wget https://www.nominatim.org/data/wikipedia_redirect.sql.bin Combined the 2 files are around 1.5GB and add around 30GB to the install size of Nominatim. They also increase the install time by an hour or so. NOTE: you'll need to download the Wikipedia rankings before performing the initial import of the data if you want the rankings applied to the loaded data.","title":"Wikipedia rankings"},{"location":"admin/Import-and-Update/#great-britain-usa-postcodes","text":"Nominatim can use postcodes from an external source to improve searches that involve a GB or US postcode. This data can be optionally downloaded: cd $NOMINATIM_SOURCE_DIR/data wget https://www.nominatim.org/data/gb_postcode_data.sql.gz wget https://www.nominatim.org/data/us_postcode_data.sql.gz","title":"Great Britain, USA postcodes"},{"location":"admin/Import-and-Update/#choosing-the-data-to-import","text":"In its default setup Nominatim is configured to import the full OSM data set for the entire planet. Such a setup requires a powerful machine with at least 32GB of RAM and around 800GB of SSD hard disks. Depending on your use case there are various ways to reduce the amount of data imported. This section discusses these methods. They can also be combined.","title":"Choosing the Data to Import"},{"location":"admin/Import-and-Update/#using-an-extract","text":"If you only need geocoding for a smaller region, then precomputed extracts are a good way to reduce the database size and import time. Geofabrik offers extracts for most countries. They even have daily updates which can be used with the update process described below. There are also other providers for extracts . Please be aware that some extracts are not cut exactly along the country boundaries. As a result some parts of the boundary may be missing which means that Nominatim cannot compute the areas for some administrative areas.","title":"Using an extract"},{"location":"admin/Import-and-Update/#dropping-data-required-for-dynamic-updates","text":"About half of the data in Nominatim's database is not really used for serving the API. It is only there to allow the data to be updated from the latest changes from OSM. For many uses these dynamic updates are not really required. If you don't plan to apply updates, the dynamic part of the database can be safely dropped using the following command: ./utils/setup.php --drop Note that you still need to provide for sufficient disk space for the initial import. So this option is particularly interesting if you plan to transfer the database or reuse the space later.","title":"Dropping Data Required for Dynamic Updates"},{"location":"admin/Import-and-Update/#reverse-only-imports","text":"If you only want to use the Nominatim database for reverse lookups or if you plan to use the installation only for exports to a photon database, then you can set up a database without search indexes. Add --reverse-only to your setup command above. This saves about 5% of disk space.","title":"Reverse-only Imports"},{"location":"admin/Import-and-Update/#filtering-imported-data","text":"Nominatim normally sets up a full search database containing administrative boundaries, places, streets, addresses and POI data. There are also other import styles available which only read selected data: settings/import-admin.style Only import administrative boundaries and places. settings/import-street.style Like the admin style but also adds streets. settings/import-address.style Import all data necessary to compute addresses down to house number level. settings/import-full.style Default style that also includes points of interest. The style can be changed with the configuration CONST_Import_Style . To give you an idea of the impact of using the different styles, the table below gives rough estimates of the final database size after import of a 2018 planet and after using the --drop option. It also shows the time needed for the import on a machine with 32GB RAM, 4 CPUS and SSDs. Note that the given sizes are just an estimate meant for comparison of style requirements. Your planet import is likely to be larger as the OSM data grows with time. style Import time DB size after drop admin 5h 190 GB 20 GB street 42h 400 GB 180 GB address 59h 500 GB 260 GB full 80h 575 GB 300 GB You can also customize the styles further. For an description of the style format see the development section .","title":"Filtering Imported Data"},{"location":"admin/Import-and-Update/#initial-import-of-the-data","text":"Important: first try the import with a small extract, for example from Geofabrik . Download the data to import and load the data with the following command from the build directory: ./utils/setup.php --osm-file <data file> --all [--osm2pgsql-cache 28000] 2>&1 | tee setup.log The --osm2pgsql-cache parameter is optional but strongly recommended for planet imports. It sets the node cache size for the osm2pgsql import part (see -C parameter in osm2pgsql help). As a rule of thumb, this should be about the same size as the file you are importing but never more than 2/3 of RAM available. If your machine starts swapping reduce the size. Computing word frequency for search terms can improve the performance of forward geocoding in particular under high load as it helps PostgreSQL's query planner to make the right decisions. To recompute word counts run: ./utils/update.php --recompute-word-counts This will take a couple of hours for a full planet installation. You can also defer that step to a later point in time when you realise that performance becomes an issue. Just make sure that updates are stopped before running this function. If you want to be able to search for places by their type through special key phrases you also need to enable these key phrases like this: ./utils/specialphrases.php --wiki-import > specialphrases.sql psql -d nominatim -f specialphrases.sql Note that this command downloads the phrases from the wiki link above.","title":"Initial import of the data"},{"location":"admin/Import-and-Update/#installing-tiger-housenumber-data-for-the-us","text":"Nominatim is able to use the official TIGER address set to complement the OSM house number data in the US. You can add TIGER data to your own Nominatim instance by following these steps. The entire US adds about 10GB to your database. Get preprocessed TIGER 2019 data and unpack it into the data directory in your Nominatim sources: cd Nominatim/data wget https://nominatim.org/data/tiger2019-nominatim-preprocessed.tar.gz tar xf tiger2019-nominatim-preprocessed.tar.gz data-source/us-tiger/README.md explains how the data got preprocessed. Import the data into your Nominatim database: ./utils/setup.php --import-tiger-data Enable use of the Tiger data in your settings/local.php by adding: @define('CONST_Use_US_Tiger_Data', true); Apply the new settings: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions","title":"Installing Tiger housenumber data for the US"},{"location":"admin/Import-and-Update/#updates","text":"There are many different ways to update your Nominatim database. The following section describes how to keep it up-to-date with Pyosmium. For a list of other methods see the output of ./utils/update.php --help .","title":"Updates"},{"location":"admin/Import-and-Update/#installing-the-newest-version-of-pyosmium","text":"It is recommended to install Pyosmium via pip. Make sure to use python3. Run (as the same user who will later run the updates): pip3 install --user osmium Nominatim needs a tool called pyosmium-get-updates which comes with Pyosmium. You need to tell Nominatim where to find it. Add the following line to your settings/local.php : @define('CONST_Pyosmium_Binary', '/home/user/.local/bin/pyosmium-get-changes'); The path above is fine if you used the --user parameter with pip. Replace user with your user name.","title":"Installing the newest version of Pyosmium"},{"location":"admin/Import-and-Update/#setting-up-the-update-process","text":"Next the update needs to be initialised. By default Nominatim is configured to update using the global minutely diffs. If you want a different update source you will need to add some settings to settings/local.php . For example, to use the daily country extracts diffs for Ireland from Geofabrik add the following: // base URL of the replication service @define('CONST_Replication_Url', 'https://download.geofabrik.de/europe/ireland-and-northern-ireland-updates'); // How often upstream publishes diffs @define('CONST_Replication_Update_Interval', '86400'); // How long to sleep if no update found yet @define('CONST_Replication_Recheck_Interval', '900'); To set up the update process now run the following command: ./utils/update.php --init-updates It outputs the date where updates will start. Recheck that this date is what you expect. The --init-updates command needs to be rerun whenever the replication service is changed.","title":"Setting up the update process"},{"location":"admin/Import-and-Update/#updating-nominatim","text":"The following command will keep your database constantly up to date: ./utils/update.php --import-osmosis-all (Note that even though the old name \"import-osmosis-all\" has been kept for compatibility reasons, Osmosis is not required to run this - it uses pyosmium behind the scenes.) If you have imported multiple country extracts and want to keep them up-to-date, have a look at the script in issue #60 .","title":"Updating Nominatim"},{"location":"admin/Installation/","text":"Basic Installation \uf0c1 This page contains generic installation instructions for Nominatim and its prerequisites. There are also step-by-step instructions available for the following operating systems: Ubuntu 18.04 Ubuntu 16.04 CentOS 7.2 These OS-specific instructions can also be found in executable form in the vagrant/ directory. Users have created instructions for other frameworks. We haven't tested those and can't offer support. Docker Docker on Kubernetes Ansible Prerequisites \uf0c1 Software \uf0c1 For compiling: cmake libxml2 a recent C++ compiler Nominatim comes with its own version of osm2pgsql. See the osm2pgsql README for additional dependencies required for compiling osm2pgsql. For running tests: behave Psycopg2 nose phpunit For running Nominatim: PostgreSQL (9.3 or later) PostGIS (2.2 or later) PHP (7.0 or later) PHP-pgsql PHP-intl (bundled with PHP) PEAR::DB a webserver (apache or nginx are recommended) For running continuous updates: pyosmium (with Python 3) Hardware \uf0c1 A minimum of 2GB of RAM is required or installation will fail. For a full planet import 32GB of RAM or more are strongly recommended. For a full planet install you will need at least 700GB of hard disk space (take into account that the OSM database is growing fast). SSD disks will help considerably to speed up import and queries. On a 6-core machine with 32GB RAM and SSDs the import of a full planet takes a bit more than 2 days. Without SSDs 7-8 days are more realistic. Setup of the server \uf0c1 PostgreSQL tuning \uf0c1 You might want to tune your PostgreSQL installation so that the later steps make best use of your hardware. You should tune the following parameters in your postgresql.conf file. shared_buffers (2GB) maintenance_work_mem (10GB) work_mem (50MB) effective_cache_size (24GB) synchronous_commit = off checkpoint_segments = 100 # only for postgresql <= 9.4 checkpoint_timeout = 10min checkpoint_completion_target = 0.9 The numbers in brackets behind some parameters seem to work fine for 32GB RAM machine. Adjust to your setup. For the initial import, you should also set: fsync = off full_page_writes = off Don't forget to reenable them after the initial import or you risk database corruption. Autovacuum must not be switched off because it ensures that the tables are frequently analysed. Webserver setup \uf0c1 The website/ directory in the build directory contains the configured website. Include the directory into your webbrowser to serve php files from there. Configure for use with Apache \uf0c1 Make sure your Apache configuration contains the required permissions for the directory and create an alias: <Directory \"/srv/nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim /srv/nominatim/build/website /srv/nominatim/build should be replaced with the location of your build directory. After making changes in the apache config you need to restart apache. The website should now be available on http://localhost/nominatim. Configure for use with Nginx \uf0c1 Use php-fpm as a deamon for serving PHP cgi. Install php-fpm together with nginx. By default php listens on a network socket. If you want it to listen to a Unix socket instead, change the pool configuration ( pool.d/www.conf ) as follows: ; Comment out the tcp listener and add the unix socket ;listen = 127.0.0.1:9000 listen = /var/run/php5-fpm.sock ; Ensure that the daemon runs as the correct user listen.owner = www-data listen.group = www-data listen.mode = 0666 Tell nginx that php files are special and to fastcgi_pass to the php-fpm unix socket by adding the location definition to the default configuration. root /srv/nominatim/build/website; index search.php index.html; location ~ [^/]\\.php(/|$) { fastcgi_split_path_info ^(.+?\\.php)(/.*)$; if (!-f $document_root$fastcgi_script_name) { return 404; } fastcgi_pass unix:/var/run/php5-fpm.sock; fastcgi_index search.php; include fastcgi.conf; } Restart the nginx and php5-fpm services and the website should now be available at http://localhost/ . Now continue with importing the database .","title":"Basic Installation"},{"location":"admin/Installation/#basic-installation","text":"This page contains generic installation instructions for Nominatim and its prerequisites. There are also step-by-step instructions available for the following operating systems: Ubuntu 18.04 Ubuntu 16.04 CentOS 7.2 These OS-specific instructions can also be found in executable form in the vagrant/ directory. Users have created instructions for other frameworks. We haven't tested those and can't offer support. Docker Docker on Kubernetes Ansible","title":"Basic Installation"},{"location":"admin/Installation/#prerequisites","text":"","title":"Prerequisites"},{"location":"admin/Installation/#software","text":"For compiling: cmake libxml2 a recent C++ compiler Nominatim comes with its own version of osm2pgsql. See the osm2pgsql README for additional dependencies required for compiling osm2pgsql. For running tests: behave Psycopg2 nose phpunit For running Nominatim: PostgreSQL (9.3 or later) PostGIS (2.2 or later) PHP (7.0 or later) PHP-pgsql PHP-intl (bundled with PHP) PEAR::DB a webserver (apache or nginx are recommended) For running continuous updates: pyosmium (with Python 3)","title":"Software"},{"location":"admin/Installation/#hardware","text":"A minimum of 2GB of RAM is required or installation will fail. For a full planet import 32GB of RAM or more are strongly recommended. For a full planet install you will need at least 700GB of hard disk space (take into account that the OSM database is growing fast). SSD disks will help considerably to speed up import and queries. On a 6-core machine with 32GB RAM and SSDs the import of a full planet takes a bit more than 2 days. Without SSDs 7-8 days are more realistic.","title":"Hardware"},{"location":"admin/Installation/#setup-of-the-server","text":"","title":"Setup of the server"},{"location":"admin/Installation/#postgresql-tuning","text":"You might want to tune your PostgreSQL installation so that the later steps make best use of your hardware. You should tune the following parameters in your postgresql.conf file. shared_buffers (2GB) maintenance_work_mem (10GB) work_mem (50MB) effective_cache_size (24GB) synchronous_commit = off checkpoint_segments = 100 # only for postgresql <= 9.4 checkpoint_timeout = 10min checkpoint_completion_target = 0.9 The numbers in brackets behind some parameters seem to work fine for 32GB RAM machine. Adjust to your setup. For the initial import, you should also set: fsync = off full_page_writes = off Don't forget to reenable them after the initial import or you risk database corruption. Autovacuum must not be switched off because it ensures that the tables are frequently analysed.","title":"PostgreSQL tuning"},{"location":"admin/Installation/#webserver-setup","text":"The website/ directory in the build directory contains the configured website. Include the directory into your webbrowser to serve php files from there.","title":"Webserver setup"},{"location":"admin/Installation/#configure-for-use-with-apache","text":"Make sure your Apache configuration contains the required permissions for the directory and create an alias: <Directory \"/srv/nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim /srv/nominatim/build/website /srv/nominatim/build should be replaced with the location of your build directory. After making changes in the apache config you need to restart apache. The website should now be available on http://localhost/nominatim.","title":"Configure for use with Apache"},{"location":"admin/Installation/#configure-for-use-with-nginx","text":"Use php-fpm as a deamon for serving PHP cgi. Install php-fpm together with nginx. By default php listens on a network socket. If you want it to listen to a Unix socket instead, change the pool configuration ( pool.d/www.conf ) as follows: ; Comment out the tcp listener and add the unix socket ;listen = 127.0.0.1:9000 listen = /var/run/php5-fpm.sock ; Ensure that the daemon runs as the correct user listen.owner = www-data listen.group = www-data listen.mode = 0666 Tell nginx that php files are special and to fastcgi_pass to the php-fpm unix socket by adding the location definition to the default configuration. root /srv/nominatim/build/website; index search.php index.html; location ~ [^/]\\.php(/|$) { fastcgi_split_path_info ^(.+?\\.php)(/.*)$; if (!-f $document_root$fastcgi_script_name) { return 404; } fastcgi_pass unix:/var/run/php5-fpm.sock; fastcgi_index search.php; include fastcgi.conf; } Restart the nginx and php5-fpm services and the website should now be available at http://localhost/ . Now continue with importing the database .","title":"Configure for use with Nginx"},{"location":"admin/Migration/","text":"Database Migrations \uf0c1 This page describes database migrations necessary to update existing databases to newer versions of Nominatim. SQL statements should be executed from the PostgreSQL commandline. Execute psql nominatim to enter command line mode. 3.3.0 -> 3.4.0 \uf0c1 Reorganisation of location_area_country table \uf0c1 The table location_area_country has been optimized. You need to switch to the new format when you run updates. While updates are disabled, run the following SQL commands: CREATE TABLE location_area_country_new AS SELECT place_id, country_code, geometry FROM location_area_country; DROP TABLE location_area_country; ALTER TABLE location_area_country_new RENAME TO location_area_country; CREATE INDEX idx_location_area_country_geometry ON location_area_country USING GIST (geometry); CREATE INDEX idx_location_area_country_place_id ON location_area_country USING BTREE (place_id); 3.2.0 -> 3.3.0 \uf0c1 New database connection string (DSN) format \uf0c1 Previously database connection setting ( CONST_Database_DSN in settings/*.php ) had the format (simple) pgsql://@/nominatim (complex) pgsql://johndoe:secret@machine1.domain.com:1234/db1 The new format is (simple) pgsql:dbname=nominatim (complex) pgsql:dbname=db1;host=machine1.domain.com;port=1234;user=johndoe;password=secret Natural Earth country boundaries no longer needed as fallback \uf0c1 DROP TABLE country_naturalearthdata; Finally, update all SQL functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions Configurable Address Levels \uf0c1 The new configurable address levels require a new table. Create it with the following command: ./utils/update.php --update-address-levels 3.1.0 -> 3.2.0 \uf0c1 New reverse algorithm \uf0c1 The reverse algorithm has changed and requires new indexes. Run the following SQL statements to create the indexes: CREATE INDEX idx_placex_geometry_reverse_lookupPoint ON placex USING gist (geometry) WHERE (name is not null or housenumber is not null or rank_address between 26 and 27) AND class not in ('railway','tunnel','bridge','man_made') AND rank_address >= 26 AND indexed_status = 0 AND linked_place_id is null; CREATE INDEX idx_placex_geometry_reverse_lookupPolygon ON placex USING gist (geometry) WHERE St_GeometryType(geometry) in ('ST_Polygon', 'ST_MultiPolygon') AND rank_address between 4 and 25 AND type != 'postcode' AND name is not null AND indexed_status = 0 AND linked_place_id is null; CREATE INDEX idx_placex_geometry_reverse_placeNode ON placex USING gist (geometry) WHERE osm_type = 'N' AND rank_search between 5 and 25 AND class = 'place' AND type != 'postcode' AND name is not null AND indexed_status = 0 AND linked_place_id is null; You also need to grant the website user access to the country_osm_grid table: GRANT SELECT ON table country_osm_grid to \"www-user\"; Replace the www-user with the user name of your website server if necessary. You can now drop the unused indexes: DROP INDEX idx_placex_reverse_geometry; Finally, update all SQL functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions 3.0.0 -> 3.1.0 \uf0c1 Postcode Table \uf0c1 A new separate table for artificially computed postcode centroids was introduced. Migration to the new format is possible but not recommended . Create postcode table and indexes, running the following SQL statements: CREATE TABLE location_postcode (place_id BIGINT, parent_place_id BIGINT, rank_search SMALLINT, rank_address SMALLINT, indexed_status SMALLINT, indexed_date TIMESTAMP, country_code varchar(2), postcode TEXT, geometry GEOMETRY(Geometry, 4326)); CREATE INDEX idx_postcode_geometry ON location_postcode USING GIST (geometry); CREATE UNIQUE INDEX idx_postcode_id ON location_postcode USING BTREE (place_id); CREATE INDEX idx_postcode_postcode ON location_postcode USING BTREE (postcode); GRANT SELECT ON location_postcode TO \"www-data\"; drop type if exists nearfeaturecentr cascade; create type nearfeaturecentr as ( place_id BIGINT, keywords int[], rank_address smallint, rank_search smallint, distance float, isguess boolean, postcode TEXT, centroid GEOMETRY ); Add postcode column to location_area tables with SQL statement: ALTER TABLE location_area ADD COLUMN postcode TEXT; Then reimport the functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions Create appropriate triggers with SQL: CREATE TRIGGER location_postcode_before_update BEFORE UPDATE ON location_postcode FOR EACH ROW EXECUTE PROCEDURE postcode_update(); Finally populate the postcode table (will take a while): ./utils/setup.php --calculate-postcodes --index --index-noanalyse This will create a working database. You may also delete the old artificial postcodes now. Note that this may be expensive and is not absolutely necessary. The following SQL statement will remove them: DELETE FROM place_addressline a USING placex p WHERE a.address_place_id = p.place_id and p.osm_type = 'P'; ALTER TABLE placex DISABLE TRIGGER USER; DELETE FROM placex WHERE osm_type = 'P'; ALTER TABLE placex ENABLE TRIGGER USER;","title":"Migration from older Versions"},{"location":"admin/Migration/#database-migrations","text":"This page describes database migrations necessary to update existing databases to newer versions of Nominatim. SQL statements should be executed from the PostgreSQL commandline. Execute psql nominatim to enter command line mode.","title":"Database Migrations"},{"location":"admin/Migration/#330-340","text":"","title":"3.3.0 -&gt; 3.4.0"},{"location":"admin/Migration/#reorganisation-of-location_area_country-table","text":"The table location_area_country has been optimized. You need to switch to the new format when you run updates. While updates are disabled, run the following SQL commands: CREATE TABLE location_area_country_new AS SELECT place_id, country_code, geometry FROM location_area_country; DROP TABLE location_area_country; ALTER TABLE location_area_country_new RENAME TO location_area_country; CREATE INDEX idx_location_area_country_geometry ON location_area_country USING GIST (geometry); CREATE INDEX idx_location_area_country_place_id ON location_area_country USING BTREE (place_id);","title":"Reorganisation of location_area_country table"},{"location":"admin/Migration/#320-330","text":"","title":"3.2.0 -&gt; 3.3.0"},{"location":"admin/Migration/#new-database-connection-string-dsn-format","text":"Previously database connection setting ( CONST_Database_DSN in settings/*.php ) had the format (simple) pgsql://@/nominatim (complex) pgsql://johndoe:secret@machine1.domain.com:1234/db1 The new format is (simple) pgsql:dbname=nominatim (complex) pgsql:dbname=db1;host=machine1.domain.com;port=1234;user=johndoe;password=secret","title":"New database connection string (DSN) format"},{"location":"admin/Migration/#natural-earth-country-boundaries-no-longer-needed-as-fallback","text":"DROP TABLE country_naturalearthdata; Finally, update all SQL functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions","title":"Natural Earth country boundaries no longer needed as fallback"},{"location":"admin/Migration/#configurable-address-levels","text":"The new configurable address levels require a new table. Create it with the following command: ./utils/update.php --update-address-levels","title":"Configurable Address Levels"},{"location":"admin/Migration/#310-320","text":"","title":"3.1.0 -&gt; 3.2.0"},{"location":"admin/Migration/#new-reverse-algorithm","text":"The reverse algorithm has changed and requires new indexes. Run the following SQL statements to create the indexes: CREATE INDEX idx_placex_geometry_reverse_lookupPoint ON placex USING gist (geometry) WHERE (name is not null or housenumber is not null or rank_address between 26 and 27) AND class not in ('railway','tunnel','bridge','man_made') AND rank_address >= 26 AND indexed_status = 0 AND linked_place_id is null; CREATE INDEX idx_placex_geometry_reverse_lookupPolygon ON placex USING gist (geometry) WHERE St_GeometryType(geometry) in ('ST_Polygon', 'ST_MultiPolygon') AND rank_address between 4 and 25 AND type != 'postcode' AND name is not null AND indexed_status = 0 AND linked_place_id is null; CREATE INDEX idx_placex_geometry_reverse_placeNode ON placex USING gist (geometry) WHERE osm_type = 'N' AND rank_search between 5 and 25 AND class = 'place' AND type != 'postcode' AND name is not null AND indexed_status = 0 AND linked_place_id is null; You also need to grant the website user access to the country_osm_grid table: GRANT SELECT ON table country_osm_grid to \"www-user\"; Replace the www-user with the user name of your website server if necessary. You can now drop the unused indexes: DROP INDEX idx_placex_reverse_geometry; Finally, update all SQL functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions","title":"New reverse algorithm"},{"location":"admin/Migration/#300-310","text":"","title":"3.0.0 -&gt; 3.1.0"},{"location":"admin/Migration/#postcode-table","text":"A new separate table for artificially computed postcode centroids was introduced. Migration to the new format is possible but not recommended . Create postcode table and indexes, running the following SQL statements: CREATE TABLE location_postcode (place_id BIGINT, parent_place_id BIGINT, rank_search SMALLINT, rank_address SMALLINT, indexed_status SMALLINT, indexed_date TIMESTAMP, country_code varchar(2), postcode TEXT, geometry GEOMETRY(Geometry, 4326)); CREATE INDEX idx_postcode_geometry ON location_postcode USING GIST (geometry); CREATE UNIQUE INDEX idx_postcode_id ON location_postcode USING BTREE (place_id); CREATE INDEX idx_postcode_postcode ON location_postcode USING BTREE (postcode); GRANT SELECT ON location_postcode TO \"www-data\"; drop type if exists nearfeaturecentr cascade; create type nearfeaturecentr as ( place_id BIGINT, keywords int[], rank_address smallint, rank_search smallint, distance float, isguess boolean, postcode TEXT, centroid GEOMETRY ); Add postcode column to location_area tables with SQL statement: ALTER TABLE location_area ADD COLUMN postcode TEXT; Then reimport the functions: ./utils/setup.php --create-functions --enable-diff-updates --create-partition-functions Create appropriate triggers with SQL: CREATE TRIGGER location_postcode_before_update BEFORE UPDATE ON location_postcode FOR EACH ROW EXECUTE PROCEDURE postcode_update(); Finally populate the postcode table (will take a while): ./utils/setup.php --calculate-postcodes --index --index-noanalyse This will create a working database. You may also delete the old artificial postcodes now. Note that this may be expensive and is not absolutely necessary. The following SQL statement will remove them: DELETE FROM place_addressline a USING placex p WHERE a.address_place_id = p.place_id and p.osm_type = 'P'; ALTER TABLE placex DISABLE TRIGGER USER; DELETE FROM placex WHERE osm_type = 'P'; ALTER TABLE placex ENABLE TRIGGER USER;","title":"Postcode Table"},{"location":"api/Details/","text":"Place details \uf0c1 Lookup details about a single place by id. The default output is HTML for debugging search logic and results. The details page (including JSON output) exists for debugging only and must not be downloaded automatically , see Nominatim Usage Policy . Parameters \uf0c1 The details API supports the following two request formats: https://nominatim.openstreetmap.org/details?osmtype=[N|W|R]&osmid=<value>&class=<value> osmtype and osmid are required parameter. The type is one of node (N), way (W) or relation (R). The id must be a number. The class parameter is optional and allows to distinguish between entries, when the corresponding OSM object has more than one main tag. For example, when a place is tagged with tourism=hotel and amenity=restaurant , there will be two place entries in Nominatim, one for a restaurant, one for a hotel. You need to specify class=tourism or class=amentity to get exactly the one you want. If there are multiple places in the database but the class parameter is left out, then one of the places will be chosen at random and displayed. https://nominatim.openstreetmap.org/details?place_id=<value> Placeids are assigned sequentially during Nominatim data import. The id for a place is different between Nominatim installation (servers) and changes when data gets reimported. Therefore it can't be used as permanent id and shouldn't be used in bug reports. Additional optional parameters are explained below. Output format \uf0c1 format=[html|json] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function (JSONP) i.e. <string>(<json>) . Only has an effect for JSON output formats. pretty=[0|1] For JSON output will add indentation to make it more human-readable. (Default: 0) Output details \uf0c1 addressdetails=[0|1] Include a breakdown of the address into elements. (Default for JSON: 0, for HTML: 1) keywords=[0|1] Include a list of name keywords and address keywords (word ids). (Default: 0) linkedplaces=[0|1] Include details of places higher in the address hierarchy. E.g. for a street this is usually the city, state, postal code, country. (Default: 1) hierarchy=[0|1] Include details of places lower in the address hierarchy. E.g. for a city this usually a list of streets, suburbs, rivers. (Default for JSON: 0, for HTML: 1) group_hierarchy=[0|1] For JSON output will group the places by type. (Default: 0) polygon_geojson=[0|1] Include geometry of result. (Default for JSON: 0, for HTML: 1) Language of results \uf0c1 accept-language=<browser language string> Preferred language order for showing result, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes. Examples \uf0c1 HTML \uf0c1 https://nominatim.openstreetmap.org/details.php?osmtype=W&osmid=38210407 JSON \uf0c1 https://nominatim.openstreetmap.org/details.php?osmtype=W&osmid=38210407&format=json { \"place_id\": 85993608, \"parent_place_id\": 72765313, \"osm_type\": \"W\", \"osm_id\": 38210407, \"category\": \"place\", \"type\": \"square\", \"admin_level\": \"15\", \"localname\": \"Pariser Platz\", \"names\": { \"name\": \"Pariser Platz\", \"name:be\": \"\u041f\u0430\u0440\u044b\u0436\u0441\u043a\u0430\u044f \u043f\u043b\u043e\u0448\u0447\u0430\", \"name:de\": \"Pariser Platz\", \"name:es\": \"Plaza de Par\u00eds\", \"name:he\": \"\u05e4\u05d0\u05e8\u05d9\u05d6\u05e8 \u05e4\u05dc\u05d0\u05e5\", \"name:ko\": \"\ud30c\ub9ac\uc800 \uad11\uc7a5\", \"name:la\": \"Forum Parisinum\", \"name:ru\": \"\u041f\u0430\u0440\u0438\u0436\u0441\u043a\u0430\u044f \u043f\u043b\u043e\u0449\u0430\u0434\u044c\", \"name:uk\": \"\u041f\u0430\u0440\u0438\u0437\u044c\u043a\u0430 \u043f\u043b\u043e\u0449\u0430\", \"name:zh\": \"\u5df4\u9ece\u5ee3\u5834\" }, \"addresstags\": { \"postcode\": \"10117\" }, \"housenumber\": null, \"calculated_postcode\": \"10117\", \"country_code\": \"de\", \"indexed_date\": \"2018-08-18T17:02:45+00:00\", \"importance\": 0.339401620591472, \"calculated_importance\": 0.339401620591472, \"extratags\": { \"wikidata\": \"Q156716\", \"wikipedia\": \"de:Pariser Platz\" }, \"calculated_wikipedia\": \"de:Pariser_Platz\", \"rank_address\": 30, \"rank_search\": 30, \"isarea\": true, \"centroid\": { \"type\": \"Point\", \"coordinates\": [ 13.3786822618517, 52.5163654 ] }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 13.3786822618517, 52.5163654 ] } }","title":"Details"},{"location":"api/Details/#place-details","text":"Lookup details about a single place by id. The default output is HTML for debugging search logic and results. The details page (including JSON output) exists for debugging only and must not be downloaded automatically , see Nominatim Usage Policy .","title":"Place details"},{"location":"api/Details/#parameters","text":"The details API supports the following two request formats: https://nominatim.openstreetmap.org/details?osmtype=[N|W|R]&osmid=<value>&class=<value> osmtype and osmid are required parameter. The type is one of node (N), way (W) or relation (R). The id must be a number. The class parameter is optional and allows to distinguish between entries, when the corresponding OSM object has more than one main tag. For example, when a place is tagged with tourism=hotel and amenity=restaurant , there will be two place entries in Nominatim, one for a restaurant, one for a hotel. You need to specify class=tourism or class=amentity to get exactly the one you want. If there are multiple places in the database but the class parameter is left out, then one of the places will be chosen at random and displayed. https://nominatim.openstreetmap.org/details?place_id=<value> Placeids are assigned sequentially during Nominatim data import. The id for a place is different between Nominatim installation (servers) and changes when data gets reimported. Therefore it can't be used as permanent id and shouldn't be used in bug reports. Additional optional parameters are explained below.","title":"Parameters"},{"location":"api/Details/#output-format","text":"format=[html|json] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function (JSONP) i.e. <string>(<json>) . Only has an effect for JSON output formats. pretty=[0|1] For JSON output will add indentation to make it more human-readable. (Default: 0)","title":"Output format"},{"location":"api/Details/#output-details","text":"addressdetails=[0|1] Include a breakdown of the address into elements. (Default for JSON: 0, for HTML: 1) keywords=[0|1] Include a list of name keywords and address keywords (word ids). (Default: 0) linkedplaces=[0|1] Include details of places higher in the address hierarchy. E.g. for a street this is usually the city, state, postal code, country. (Default: 1) hierarchy=[0|1] Include details of places lower in the address hierarchy. E.g. for a city this usually a list of streets, suburbs, rivers. (Default for JSON: 0, for HTML: 1) group_hierarchy=[0|1] For JSON output will group the places by type. (Default: 0) polygon_geojson=[0|1] Include geometry of result. (Default for JSON: 0, for HTML: 1)","title":"Output details"},{"location":"api/Details/#language-of-results","text":"accept-language=<browser language string> Preferred language order for showing result, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes.","title":"Language of results"},{"location":"api/Details/#examples","text":"","title":"Examples"},{"location":"api/Details/#html","text":"https://nominatim.openstreetmap.org/details.php?osmtype=W&osmid=38210407","title":"HTML"},{"location":"api/Details/#json","text":"https://nominatim.openstreetmap.org/details.php?osmtype=W&osmid=38210407&format=json { \"place_id\": 85993608, \"parent_place_id\": 72765313, \"osm_type\": \"W\", \"osm_id\": 38210407, \"category\": \"place\", \"type\": \"square\", \"admin_level\": \"15\", \"localname\": \"Pariser Platz\", \"names\": { \"name\": \"Pariser Platz\", \"name:be\": \"\u041f\u0430\u0440\u044b\u0436\u0441\u043a\u0430\u044f \u043f\u043b\u043e\u0448\u0447\u0430\", \"name:de\": \"Pariser Platz\", \"name:es\": \"Plaza de Par\u00eds\", \"name:he\": \"\u05e4\u05d0\u05e8\u05d9\u05d6\u05e8 \u05e4\u05dc\u05d0\u05e5\", \"name:ko\": \"\ud30c\ub9ac\uc800 \uad11\uc7a5\", \"name:la\": \"Forum Parisinum\", \"name:ru\": \"\u041f\u0430\u0440\u0438\u0436\u0441\u043a\u0430\u044f \u043f\u043b\u043e\u0449\u0430\u0434\u044c\", \"name:uk\": \"\u041f\u0430\u0440\u0438\u0437\u044c\u043a\u0430 \u043f\u043b\u043e\u0449\u0430\", \"name:zh\": \"\u5df4\u9ece\u5ee3\u5834\" }, \"addresstags\": { \"postcode\": \"10117\" }, \"housenumber\": null, \"calculated_postcode\": \"10117\", \"country_code\": \"de\", \"indexed_date\": \"2018-08-18T17:02:45+00:00\", \"importance\": 0.339401620591472, \"calculated_importance\": 0.339401620591472, \"extratags\": { \"wikidata\": \"Q156716\", \"wikipedia\": \"de:Pariser Platz\" }, \"calculated_wikipedia\": \"de:Pariser_Platz\", \"rank_address\": 30, \"rank_search\": 30, \"isarea\": true, \"centroid\": { \"type\": \"Point\", \"coordinates\": [ 13.3786822618517, 52.5163654 ] }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 13.3786822618517, 52.5163654 ] } }","title":"JSON"},{"location":"api/Faq/","text":"Frequently Asked Questions \uf0c1 API Results \uf0c1 1. The address of my search results contains far-away places that don't belong there. \uf0c1 Nominatim computes the address from two sources in the OpenStreetMap data: from administrative boundaries and from place nodes. Boundaries are the more useful source. They precisely describe an area. So it is very clear for Nominatim if a point belongs to an area or not. Place nodes are more complicated. These are only points without any precise extent. So Nominatim has to take a guess and assume that an address belongs to the closest place node it can find. In an ideal world, Nominatim would not need the place nodes but there are many places on earth where there are no precise boundaries available for all parts that make up an address. This is in particular true for the more local address parts, like villages and suburbs. Therefore it is not possible to completely dismiss place nodes. And sometimes they sneak in where they don't belong. As a OpenStreetMap mapper, you can improve the situation in two ways: if you see a place node for which already an administrative area exists, then you should link the two by adding the node with a 'label' role to the boundary relation. If there is no administrative area, you can add the approximate extent of the place and tag it place= as well. 2. When doing reverse search, the address details have parts that don't contain the point I was looking up. \uf0c1 There is a common misconception how the reverse API call works in Nominatim. Reverse does not give you the address of the point you asked for. Reverse returns the closest object to the point you asked for and then returns the address of that object. Now, if you are close to a border, then the closest object may be across that border. When Nominatim then returns the address, it contains the county/state/country across the border. 3. I get different counties/states/countries when I change the zoom parameter in the reverse query. How is that possible? \uf0c1 This is basically the same problem as in the previous answer. The zoom level influences at which search rank Nominatim starts looking for the closest object. So the closest house number maybe on one side of the border while the closest street is on the other. As the address details contain the address of the closest object found, you might sometimes get one result, sometimes the other for the closest point. 4. Can you return the continent? \uf0c1 Nominatim assigns each map feature one country. Those outside any administrative boundaries are assigned a special no-country. Continents or other super-national administrations (e.g. European Union, NATO, Custom unions) are not supported, see also Administrative Boundary . 5. Can you return the timezone? \uf0c1 See this separate OpenStreetMap-based project Timezone Boundary Builder . 6. I want to download a list of streets/restaurants of a city/region \uf0c1 The Overpass API is more suited for these kinds of queries. That said if you installed your own Nominatim instance you can use the /utils/export.php PHP script as basis to return such lists.","title":"FAQ"},{"location":"api/Faq/#frequently-asked-questions","text":"","title":"Frequently Asked Questions"},{"location":"api/Faq/#api-results","text":"","title":"API Results"},{"location":"api/Faq/#1-the-address-of-my-search-results-contains-far-away-places-that-dont-belong-there","text":"Nominatim computes the address from two sources in the OpenStreetMap data: from administrative boundaries and from place nodes. Boundaries are the more useful source. They precisely describe an area. So it is very clear for Nominatim if a point belongs to an area or not. Place nodes are more complicated. These are only points without any precise extent. So Nominatim has to take a guess and assume that an address belongs to the closest place node it can find. In an ideal world, Nominatim would not need the place nodes but there are many places on earth where there are no precise boundaries available for all parts that make up an address. This is in particular true for the more local address parts, like villages and suburbs. Therefore it is not possible to completely dismiss place nodes. And sometimes they sneak in where they don't belong. As a OpenStreetMap mapper, you can improve the situation in two ways: if you see a place node for which already an administrative area exists, then you should link the two by adding the node with a 'label' role to the boundary relation. If there is no administrative area, you can add the approximate extent of the place and tag it place= as well.","title":"1. The address of my search results contains far-away places that don't belong there."},{"location":"api/Faq/#2-when-doing-reverse-search-the-address-details-have-parts-that-dont-contain-the-point-i-was-looking-up","text":"There is a common misconception how the reverse API call works in Nominatim. Reverse does not give you the address of the point you asked for. Reverse returns the closest object to the point you asked for and then returns the address of that object. Now, if you are close to a border, then the closest object may be across that border. When Nominatim then returns the address, it contains the county/state/country across the border.","title":"2. When doing reverse search, the address details have parts that don't contain the point I was looking up."},{"location":"api/Faq/#3-i-get-different-countiesstatescountries-when-i-change-the-zoom-parameter-in-the-reverse-query-how-is-that-possible","text":"This is basically the same problem as in the previous answer. The zoom level influences at which search rank Nominatim starts looking for the closest object. So the closest house number maybe on one side of the border while the closest street is on the other. As the address details contain the address of the closest object found, you might sometimes get one result, sometimes the other for the closest point.","title":"3. I get different counties/states/countries when I change the zoom parameter in the reverse query. How is that possible?"},{"location":"api/Faq/#4-can-you-return-the-continent","text":"Nominatim assigns each map feature one country. Those outside any administrative boundaries are assigned a special no-country. Continents or other super-national administrations (e.g. European Union, NATO, Custom unions) are not supported, see also Administrative Boundary .","title":"4. Can you return the continent?"},{"location":"api/Faq/#5-can-you-return-the-timezone","text":"See this separate OpenStreetMap-based project Timezone Boundary Builder .","title":"5. Can you return the timezone?"},{"location":"api/Faq/#6-i-want-to-download-a-list-of-streetsrestaurants-of-a-cityregion","text":"The Overpass API is more suited for these kinds of queries. That said if you installed your own Nominatim instance you can use the /utils/export.php PHP script as basis to return such lists.","title":"6. I want to download a list of streets/restaurants of a city/region"},{"location":"api/Lookup/","text":"Address lookup \uf0c1 The lookup API allows to query the address and other details of one or multiple OSM objects like node, way or relation. Parameters \uf0c1 The lookup API has the following format: https://nominatim.openstreetmap.org/lookup?osm_ids=[N|W|R]<value>,\u2026,\u2026,&<params> osm_ids is mandatory and must contain a comma-separated list of OSM ids each prefixed with its type, one of node(N), way(W) or relation(R). Up to 50 ids can be queried at the same time. Additional optional parameters are explained below. Output format \uf0c1 format=[xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: xml) json_callback=<string> Wrap JSON output in a callback function (JSONP) i.e. <string>(<json>) . Only has an effect for JSON output formats. Output details \uf0c1 addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 0) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0) Language of results \uf0c1 accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes. Other \uf0c1 email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0) Examples \uf0c1 XML \uf0c1 https://nominatim.openstreetmap.org/lookup?osm_ids=R146656,W104393803,N240109189 <lookupresults timestamp=\"Mon, 29 Jun 15 18:01:33 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"R146656,W104393803,N240109189\" polygon=\"false\"> <place place_id=\"127761056\" osm_type=\"relation\" osm_id=\"146656\" place_rank=\"16\" lat=\"53.4791466\" lon=\"-2.2447445\" display_name=\"Manchester, Greater Manchester, North West England, England, United Kingdom\" class=\"boundary\" type=\"administrative\" importance=\"0.704893333438333\"> <city>Manchester</city> <county>Greater Manchester</county> <state_district>North West England</state_district> <state>England</state> <country>United Kingdom</country> <country_code>gb</country_code> </place> <place place_id=\"77769745\" osm_type=\"way\" osm_id=\"104393803\" place_rank=\"30\" lat=\"52.5162024\" lon=\"13.3777343363579\" display_name=\"Brandenburg Gate, 1, Pariser Platz, Mitte, Berlin, 10117, Germany\" class=\"tourism\" type=\"attraction\" importance=\"0.443472858361592\"> <attraction>Brandenburg Gate</attraction> <house_number>1</house_number> <pedestrian>Pariser Platz</pedestrian> <suburb>Mitte</suburb> <city_district>Mitte</city_district> <city>Berlin</city> <state>Berlin</state> <postcode>10117</postcode> <country>Germany</country> <country_code>de</country_code> </place> <place place_id=\"2570600569\" osm_type=\"node\" osm_id=\"240109189\" place_rank=\"15\" lat=\"52.5170365\" lon=\"13.3888599\" display_name=\"Berlin, Germany\" class=\"place\" type=\"city\" importance=\"0.822149797630868\"> <city>Berlin</city> <state>Berlin</state> <country>Germany</country> <country_code>de</country_code> </place> </lookupresults> JSON with extratags \uf0c1 https://nominatim.openstreetmap.org/lookup?osm_ids=W50637691&format=json [ { \"place_id\": \"84271358\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"osm_type\": \"way\", \"osm_id\": \"50637691\", \"lat\": \"52.39955055\", \"lon\": \"13.04806574678\", \"display_name\": \"Brandenburger Tor, Brandenburger Stra\u00dfe, N\u00f6rdliche Innenstadt, Innenstadt, Potsdam, Brandenburg, 14467, Germany\", \"class\": \"historic\", \"type\": \"city_gate\", \"importance\": \"0.221233780277011\", \"address\": { \"address29\": \"Brandenburger Tor\", \"pedestrian\": \"Brandenburger Stra\u00dfe\", \"suburb\": \"N\u00f6rdliche Innenstadt\", \"city\": \"Potsdam\", \"state\": \"Brandenburg\", \"postcode\": \"14467\", \"country\": \"Germany\", \"country_code\": \"de\" }, \"extratags\": { \"image\": \"http://commons.wikimedia.org/wiki/File:Potsdam_brandenburger_tor.jpg\", \"wikidata\": \"Q695045\", \"wikipedia\": \"de:Brandenburger Tor (Potsdam)\", \"wheelchair\": \"yes\", \"description\": \"Kleines Brandenburger Tor in Potsdam\" } } ]","title":"Address Lookup"},{"location":"api/Lookup/#address-lookup","text":"The lookup API allows to query the address and other details of one or multiple OSM objects like node, way or relation.","title":"Address lookup"},{"location":"api/Lookup/#parameters","text":"The lookup API has the following format: https://nominatim.openstreetmap.org/lookup?osm_ids=[N|W|R]<value>,\u2026,\u2026,&<params> osm_ids is mandatory and must contain a comma-separated list of OSM ids each prefixed with its type, one of node(N), way(W) or relation(R). Up to 50 ids can be queried at the same time. Additional optional parameters are explained below.","title":"Parameters"},{"location":"api/Lookup/#output-format","text":"format=[xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: xml) json_callback=<string> Wrap JSON output in a callback function (JSONP) i.e. <string>(<json>) . Only has an effect for JSON output formats.","title":"Output format"},{"location":"api/Lookup/#output-details","text":"addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 0) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0)","title":"Output details"},{"location":"api/Lookup/#language-of-results","text":"accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes.","title":"Language of results"},{"location":"api/Lookup/#other","text":"email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0)","title":"Other"},{"location":"api/Lookup/#examples","text":"","title":"Examples"},{"location":"api/Lookup/#xml","text":"https://nominatim.openstreetmap.org/lookup?osm_ids=R146656,W104393803,N240109189 <lookupresults timestamp=\"Mon, 29 Jun 15 18:01:33 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"R146656,W104393803,N240109189\" polygon=\"false\"> <place place_id=\"127761056\" osm_type=\"relation\" osm_id=\"146656\" place_rank=\"16\" lat=\"53.4791466\" lon=\"-2.2447445\" display_name=\"Manchester, Greater Manchester, North West England, England, United Kingdom\" class=\"boundary\" type=\"administrative\" importance=\"0.704893333438333\"> <city>Manchester</city> <county>Greater Manchester</county> <state_district>North West England</state_district> <state>England</state> <country>United Kingdom</country> <country_code>gb</country_code> </place> <place place_id=\"77769745\" osm_type=\"way\" osm_id=\"104393803\" place_rank=\"30\" lat=\"52.5162024\" lon=\"13.3777343363579\" display_name=\"Brandenburg Gate, 1, Pariser Platz, Mitte, Berlin, 10117, Germany\" class=\"tourism\" type=\"attraction\" importance=\"0.443472858361592\"> <attraction>Brandenburg Gate</attraction> <house_number>1</house_number> <pedestrian>Pariser Platz</pedestrian> <suburb>Mitte</suburb> <city_district>Mitte</city_district> <city>Berlin</city> <state>Berlin</state> <postcode>10117</postcode> <country>Germany</country> <country_code>de</country_code> </place> <place place_id=\"2570600569\" osm_type=\"node\" osm_id=\"240109189\" place_rank=\"15\" lat=\"52.5170365\" lon=\"13.3888599\" display_name=\"Berlin, Germany\" class=\"place\" type=\"city\" importance=\"0.822149797630868\"> <city>Berlin</city> <state>Berlin</state> <country>Germany</country> <country_code>de</country_code> </place> </lookupresults>","title":"XML"},{"location":"api/Lookup/#json-with-extratags","text":"https://nominatim.openstreetmap.org/lookup?osm_ids=W50637691&format=json [ { \"place_id\": \"84271358\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"osm_type\": \"way\", \"osm_id\": \"50637691\", \"lat\": \"52.39955055\", \"lon\": \"13.04806574678\", \"display_name\": \"Brandenburger Tor, Brandenburger Stra\u00dfe, N\u00f6rdliche Innenstadt, Innenstadt, Potsdam, Brandenburg, 14467, Germany\", \"class\": \"historic\", \"type\": \"city_gate\", \"importance\": \"0.221233780277011\", \"address\": { \"address29\": \"Brandenburger Tor\", \"pedestrian\": \"Brandenburger Stra\u00dfe\", \"suburb\": \"N\u00f6rdliche Innenstadt\", \"city\": \"Potsdam\", \"state\": \"Brandenburg\", \"postcode\": \"14467\", \"country\": \"Germany\", \"country_code\": \"de\" }, \"extratags\": { \"image\": \"http://commons.wikimedia.org/wiki/File:Potsdam_brandenburger_tor.jpg\", \"wikidata\": \"Q695045\", \"wikipedia\": \"de:Brandenburger Tor (Potsdam)\", \"wheelchair\": \"yes\", \"description\": \"Kleines Brandenburger Tor in Potsdam\" } } ]","title":"JSON with extratags"},{"location":"api/Output/","text":"Place Output \uf0c1 The /reverse , /search and /lookup API calls produce very similar output which is explained in this section. There is one section for each format which is selectable via the format parameter. Formats \uf0c1 JSON \uf0c1 The JSON format returns an array of places (for search and lookup) or a single place (for reverse) of the following format: { \"place_id\": \"100149\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"osm_type\": \"node\", \"osm_id\": \"107775\", \"boundingbox\": [\"51.3473219\", \"51.6673219\", \"-0.2876474\", \"0.0323526\"], \"lat\": \"51.5073219\", \"lon\": \"-0.1276474\", \"display_name\": \"London, Greater London, England, SW1A 2DU, United Kingdom\", \"class\": \"place\", \"type\": \"city\", \"importance\": 0.9654895765402, \"icon\": \"https://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\", \"address\": { \"city\": \"London\", \"state_district\": \"Greater London\", \"state\": \"England\", \"postcode\": \"SW1A 2DU\", \"country\": \"United Kingdom\", \"country_code\": \"gb\" }, \"extratags\": { \"capital\": \"yes\", \"website\": \"http://www.london.gov.uk\", \"wikidata\": \"Q84\", \"wikipedia\": \"en:London\", \"population\": \"8416535\" } }, The possible fields are: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object boundingbox - area of corner coordinates lat , lon - latitude and longitude of the centroid of the object display_name - full comma-separated address class , type - key and value of the main OSM tag importance - computed importance rank icon - link to class icon (if available) address - dictionary of address details (only with addressdetails=1 ) extratags - dictionary with additional useful tags like website or maxspeed (only with extratags=1 ) namedetails - dictionary with full list of available names including ref etc. geojson , svg , geotext , geokml - full geometry (only with the appropriate polygon_* parameter) JSONv2 \uf0c1 This is the same as the JSON format with two changes: class renamed to category additional field place_rank with the search rank of the object GeoJSON \uf0c1 This format follows the RFC7946 . Every feature includes a bounding box ( bbox ). The feature list has the following fields: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object category , type - key and value of the main OSM tag display_name - full comma-separated address place_rank - class search rank importance - computed importance rank icon - link to class icon (if available) address - dictionary of address details (only with addressdetails=1 ) extratags - dictionary with additional useful tags like website or maxspeed (only with extratags=1 ) namedetails - dictionary with full list of available names including ref etc. Use polygon_geojson to output the full geometry of the object instead of the centroid. GeocodeJSON \uf0c1 The GeocodeJSON format follows the GeocodeJSON spec 0.1.0 . The following feature attributes are implemented: osm_type , osm_id - reference to the OSM object (unofficial extension) type - value of the main tag of the object (e.g. residential, restaurant, ...) label - full comma-separated address name - localised name of the place housenumber , street , locality , postcode , city , district , county , state , country - provided when it can be determined from the address (see this issue for current limitations on the correctness of the address) and addressdetails=1 was given admin - list of localised names of administrative boundaries (only with addressdetails=1 ) Use polygon_geojson to output the full geometry of the object instead of the centroid. XML \uf0c1 The XML response returns one or more place objects in slightly different formats depending on the API call. Reverse \uf0c1 <reversegeocode timestamp=\"Sat, 11 Aug 18 11:53:21 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"lat=48.400381&lon=11.745876&zoom=5&format=xml\"> <result place_id=\"179509537\" osm_type=\"relation\" osm_id=\"2145268\" ref=\"BY\" lat=\"48.9467562\" lon=\"11.4038717\" boundingbox=\"47.2701114,50.5647142,8.9763497,13.8396373\"> Bavaria, Germany </result> <addressparts> <state>Bavaria</state> <country>Germany</country> <country_code>de</country_code> </addressparts> <extratags> <tag key=\"place\" value=\"state\"/> <tag key=\"wikidata\" value=\"Q980\"/> <tag key=\"wikipedia\" value=\"de:Bayern\"/> <tag key=\"population\" value=\"12520000\"/> <tag key=\"name:prefix\" value=\"Freistaat\"/> </extratags> </reversegeocode> The attributes of the outer reversegeocode element return generic information about the query, including the time when the response was sent (in UTC), attribution to OSM and the original querystring. The place information can be found in the result element. The attributes of that element contain: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object ref - content of ref tag if it exists lat , lon - latitude and longitude of the centroid of the object boundingbox - comma-separated list of corner coordinates The full address of the result can be found in the content of the result element as a comma-separated list. Additional information requested with addressdetails=1 , extratags=1 and namedetails=1 can be found in extra elements. Search and Lookup \uf0c1 <searchresults timestamp=\"Sat, 11 Aug 18 11:55:35 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"london\" polygon=\"false\" exclude_place_ids=\"100149\" more_url=\"https://nominatim.openstreetmap.org/search.php?q=london&addressdetails=1&extratags=1&exclude_place_ids=100149&format=xml&accept-language=en-US%2Cen%3Bq%3D0.7%2Cde%3Bq%3D0.3\"> <place place_id=\"100149\" osm_type=\"node\" osm_id=\"107775\" place_rank=\"15\" boundingbox=\"51.3473219,51.6673219,-0.2876474,0.0323526\" lat=\"51.5073219\" lon=\"-0.1276474\" display_name=\"London, Greater London, England, SW1A 2DU, United Kingdom\" class=\"place\" type=\"city\" importance=\"0.9654895765402\" icon=\"https://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\"> <extratags> <tag key=\"capital\" value=\"yes\"/> <tag key=\"website\" value=\"http://www.london.gov.uk\"/> <tag key=\"wikidata\" value=\"Q84\"/> <tag key=\"wikipedia\" value=\"en:London\"/> <tag key=\"population\" value=\"8416535\"/> </extratags> <city>London</city> <state_district>Greater London</state_district> <state>England</state> <postcode>SW1A 2DU</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </place> </searchresults> The attributes of the outer searchresults or lookupresults element return generic information about the query: timestamp - UTC time when the response was sent attribution - OSM licensing information querystring - original query polygon - true when extra geometry information was requested exclude_place_ids - IDs of places that should be ignored in a follow-up request more_url - search call that will yield additional results for the query just sent The place information can be found in the place elements, of which there may be more than one. The attributes of that element contain: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object ref - content of ref tag if it exists lat , lon - latitude and longitude of the centroid of the object boundingbox - comma-separated list of corner coordinates place_rank - class search rank display_name - full comma-separated address class , type - key and value of the main OSM tag importance - computed importance rank icon - link to class icon (if available) When addressdetails=1 is requested, the localised address parts appear as subelements with the type of the address part. Additional information requested with extratags=1 and namedetails=1 can be found in extra elements as sub-element of each place. Notes on field values \uf0c1 place_id is not a persistent id \uf0c1 The place_id is created when a Nominatim database gets installed. A single place will have a different value on another server or even when the same data gets re-imported. It's thus not useful to treat it as permanent for later use. The combination osm_type + osm_id is slighly better but remember in OpenStreetMap mappers can delete, split, recreate places (and those get a new osm_id ), there is no link between those old and new ids. Places can also change their meaning without changing their osm_id , e.g. when a restaurant is retagged as supermarket. For a more in-depth discussion see Permanent ID . Nominatim merges some places (e.g. center node of a city with the boundary relation) so osm_type + osm_id + class_name would be more unique. boundingbox \uf0c1 Comma separated list of min latitude, max latitude, min longitude, max longitude. The whole planet would be -90,90,-180,180 .","title":"Place Output Formats"},{"location":"api/Output/#place-output","text":"The /reverse , /search and /lookup API calls produce very similar output which is explained in this section. There is one section for each format which is selectable via the format parameter.","title":"Place Output"},{"location":"api/Output/#formats","text":"","title":"Formats"},{"location":"api/Output/#json","text":"The JSON format returns an array of places (for search and lookup) or a single place (for reverse) of the following format: { \"place_id\": \"100149\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"osm_type\": \"node\", \"osm_id\": \"107775\", \"boundingbox\": [\"51.3473219\", \"51.6673219\", \"-0.2876474\", \"0.0323526\"], \"lat\": \"51.5073219\", \"lon\": \"-0.1276474\", \"display_name\": \"London, Greater London, England, SW1A 2DU, United Kingdom\", \"class\": \"place\", \"type\": \"city\", \"importance\": 0.9654895765402, \"icon\": \"https://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\", \"address\": { \"city\": \"London\", \"state_district\": \"Greater London\", \"state\": \"England\", \"postcode\": \"SW1A 2DU\", \"country\": \"United Kingdom\", \"country_code\": \"gb\" }, \"extratags\": { \"capital\": \"yes\", \"website\": \"http://www.london.gov.uk\", \"wikidata\": \"Q84\", \"wikipedia\": \"en:London\", \"population\": \"8416535\" } }, The possible fields are: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object boundingbox - area of corner coordinates lat , lon - latitude and longitude of the centroid of the object display_name - full comma-separated address class , type - key and value of the main OSM tag importance - computed importance rank icon - link to class icon (if available) address - dictionary of address details (only with addressdetails=1 ) extratags - dictionary with additional useful tags like website or maxspeed (only with extratags=1 ) namedetails - dictionary with full list of available names including ref etc. geojson , svg , geotext , geokml - full geometry (only with the appropriate polygon_* parameter)","title":"JSON"},{"location":"api/Output/#jsonv2","text":"This is the same as the JSON format with two changes: class renamed to category additional field place_rank with the search rank of the object","title":"JSONv2"},{"location":"api/Output/#geojson","text":"This format follows the RFC7946 . Every feature includes a bounding box ( bbox ). The feature list has the following fields: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object category , type - key and value of the main OSM tag display_name - full comma-separated address place_rank - class search rank importance - computed importance rank icon - link to class icon (if available) address - dictionary of address details (only with addressdetails=1 ) extratags - dictionary with additional useful tags like website or maxspeed (only with extratags=1 ) namedetails - dictionary with full list of available names including ref etc. Use polygon_geojson to output the full geometry of the object instead of the centroid.","title":"GeoJSON"},{"location":"api/Output/#geocodejson","text":"The GeocodeJSON format follows the GeocodeJSON spec 0.1.0 . The following feature attributes are implemented: osm_type , osm_id - reference to the OSM object (unofficial extension) type - value of the main tag of the object (e.g. residential, restaurant, ...) label - full comma-separated address name - localised name of the place housenumber , street , locality , postcode , city , district , county , state , country - provided when it can be determined from the address (see this issue for current limitations on the correctness of the address) and addressdetails=1 was given admin - list of localised names of administrative boundaries (only with addressdetails=1 ) Use polygon_geojson to output the full geometry of the object instead of the centroid.","title":"GeocodeJSON"},{"location":"api/Output/#xml","text":"The XML response returns one or more place objects in slightly different formats depending on the API call.","title":"XML"},{"location":"api/Output/#reverse","text":"<reversegeocode timestamp=\"Sat, 11 Aug 18 11:53:21 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"lat=48.400381&lon=11.745876&zoom=5&format=xml\"> <result place_id=\"179509537\" osm_type=\"relation\" osm_id=\"2145268\" ref=\"BY\" lat=\"48.9467562\" lon=\"11.4038717\" boundingbox=\"47.2701114,50.5647142,8.9763497,13.8396373\"> Bavaria, Germany </result> <addressparts> <state>Bavaria</state> <country>Germany</country> <country_code>de</country_code> </addressparts> <extratags> <tag key=\"place\" value=\"state\"/> <tag key=\"wikidata\" value=\"Q980\"/> <tag key=\"wikipedia\" value=\"de:Bayern\"/> <tag key=\"population\" value=\"12520000\"/> <tag key=\"name:prefix\" value=\"Freistaat\"/> </extratags> </reversegeocode> The attributes of the outer reversegeocode element return generic information about the query, including the time when the response was sent (in UTC), attribution to OSM and the original querystring. The place information can be found in the result element. The attributes of that element contain: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object ref - content of ref tag if it exists lat , lon - latitude and longitude of the centroid of the object boundingbox - comma-separated list of corner coordinates The full address of the result can be found in the content of the result element as a comma-separated list. Additional information requested with addressdetails=1 , extratags=1 and namedetails=1 can be found in extra elements.","title":"Reverse"},{"location":"api/Output/#search-and-lookup","text":"<searchresults timestamp=\"Sat, 11 Aug 18 11:55:35 +0000\" attribution=\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\" querystring=\"london\" polygon=\"false\" exclude_place_ids=\"100149\" more_url=\"https://nominatim.openstreetmap.org/search.php?q=london&addressdetails=1&extratags=1&exclude_place_ids=100149&format=xml&accept-language=en-US%2Cen%3Bq%3D0.7%2Cde%3Bq%3D0.3\"> <place place_id=\"100149\" osm_type=\"node\" osm_id=\"107775\" place_rank=\"15\" boundingbox=\"51.3473219,51.6673219,-0.2876474,0.0323526\" lat=\"51.5073219\" lon=\"-0.1276474\" display_name=\"London, Greater London, England, SW1A 2DU, United Kingdom\" class=\"place\" type=\"city\" importance=\"0.9654895765402\" icon=\"https://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png\"> <extratags> <tag key=\"capital\" value=\"yes\"/> <tag key=\"website\" value=\"http://www.london.gov.uk\"/> <tag key=\"wikidata\" value=\"Q84\"/> <tag key=\"wikipedia\" value=\"en:London\"/> <tag key=\"population\" value=\"8416535\"/> </extratags> <city>London</city> <state_district>Greater London</state_district> <state>England</state> <postcode>SW1A 2DU</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </place> </searchresults> The attributes of the outer searchresults or lookupresults element return generic information about the query: timestamp - UTC time when the response was sent attribution - OSM licensing information querystring - original query polygon - true when extra geometry information was requested exclude_place_ids - IDs of places that should be ignored in a follow-up request more_url - search call that will yield additional results for the query just sent The place information can be found in the place elements, of which there may be more than one. The attributes of that element contain: place_id - reference to the Nominatim internal database ID (see notes below) osm_type , osm_id - reference to the OSM object ref - content of ref tag if it exists lat , lon - latitude and longitude of the centroid of the object boundingbox - comma-separated list of corner coordinates place_rank - class search rank display_name - full comma-separated address class , type - key and value of the main OSM tag importance - computed importance rank icon - link to class icon (if available) When addressdetails=1 is requested, the localised address parts appear as subelements with the type of the address part. Additional information requested with extratags=1 and namedetails=1 can be found in extra elements as sub-element of each place.","title":"Search and Lookup"},{"location":"api/Output/#notes-on-field-values","text":"","title":"Notes on field values"},{"location":"api/Output/#place_id-is-not-a-persistent-id","text":"The place_id is created when a Nominatim database gets installed. A single place will have a different value on another server or even when the same data gets re-imported. It's thus not useful to treat it as permanent for later use. The combination osm_type + osm_id is slighly better but remember in OpenStreetMap mappers can delete, split, recreate places (and those get a new osm_id ), there is no link between those old and new ids. Places can also change their meaning without changing their osm_id , e.g. when a restaurant is retagged as supermarket. For a more in-depth discussion see Permanent ID . Nominatim merges some places (e.g. center node of a city with the boundary relation) so osm_type + osm_id + class_name would be more unique.","title":"place_id is not a persistent id"},{"location":"api/Output/#boundingbox","text":"Comma separated list of min latitude, max latitude, min longitude, max longitude. The whole planet would be -90,90,-180,180 .","title":"boundingbox"},{"location":"api/Overview/","text":"Nominatim API \uf0c1 Nominatim indexes named (or numbered) features within the OpenStreetMap (OSM) dataset and a subset of other unnamed features (pubs, hotels, churches, etc). Its API has the following endpoints for querying the data: /search - search OSM objects by name or type /reverse - search OSM object by their location /lookup - look up address details for OSM objects by their ID /status - query the status of the server /deletable - list objects that have been deleted in OSM but are held back in Nominatim in case the deletion was accidental /polygons - list of broken polygons detected by Nominatim /details - show internal details for an object (for debugging only)","title":"Overview"},{"location":"api/Overview/#nominatim-api","text":"Nominatim indexes named (or numbered) features within the OpenStreetMap (OSM) dataset and a subset of other unnamed features (pubs, hotels, churches, etc). Its API has the following endpoints for querying the data: /search - search OSM objects by name or type /reverse - search OSM object by their location /lookup - look up address details for OSM objects by their ID /status - query the status of the server /deletable - list objects that have been deleted in OSM but are held back in Nominatim in case the deletion was accidental /polygons - list of broken polygons detected by Nominatim /details - show internal details for an object (for debugging only)","title":"Nominatim API"},{"location":"api/Reverse/","text":"Reverse Geocoding \uf0c1 Reverse geocoding generates an address from a latitude and longitude or from an OSM object. Parameters \uf0c1 The main format of the reverse API is https://nominatim.openstreetmap.org/reverse?<query> There are two ways how the requested location can be specified: lat=<value> lon=<value> A geographic location to generate an address for. The coordiantes must be in WGS84 format. osm_type=[N|W|R] osm_id=<value> A specific OSM node(N), way(W) or relation(R) to return an address for. In both cases exactly one object is returned. The two input parameters cannot be used at the same time. Both accept the additional optional parameters listed below. Output format \uf0c1 format=[xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function ( JSONP ) i.e. <string>(<json>) . Only has an effect for JSON output formats. Output details \uf0c1 addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 1) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0) Language of results \uf0c1 accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes. Result limitation \uf0c1 zoom=[0-18] Level of detail required for the address. Default: 18. This is a number that corresponds roughly to the zoom level used in map frameworks like Leaflet.js, Openlayers etc. In terms of address details the zoom levels are as follows: zoom address detail 3 country 5 state 8 county 10 city 14 suburb 16 major streets 17 major and minor streets 18 building Polygon output \uf0c1 polygon_geojson=1 polygon_kml=1 polygon_svg=1 polygon_text=1 Output geometry of results as a GeoJSON, KML, SVG or WKT. Only one of these options can be used at a time. (Default: 0) polygon_threshold=0.0 Simplify the output geometry before returning. The parameter is the tolerance in degrees with which the geometry may differ from the original geometry. Topology is preserved in the result. (Default: 0.0) Other \uf0c1 email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0) Examples \uf0c1 https://nominatim.openstreetmap.org/reverse?format=xml&lat=52.5487429714954&lon=-1.81602098644987&zoom=18&addressdetails=1 <reversegeocode timestamp=\"Fri, 06 Nov 09 16:33:54 +0000\" querystring=\"...\"> <result place_id=\"1620612\" osm_type=\"node\" osm_id=\"452010817\"> 135, Pilkington Avenue, Wylde Green, City of Birmingham, West Midlands (county), B72, United Kingdom </result> <addressparts> <house_number>135</house_number> <road>Pilkington Avenue</road> <village>Wylde Green</village> <town>Sutton Coldfield</town> <city>City of Birmingham</city> <county>West Midlands (county)</county> <postcode>B72</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </addressparts> </reversegeocode> Example with format=jsonv2 \uf0c1 https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=-34.44076&lon=-58.70521 { \"place_id\":\"134140761\", \"licence\":\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https:\\/\\/www.openstreetmap.org\\/copyright\", \"osm_type\":\"way\", \"osm_id\":\"280940520\", \"lat\":\"-34.4391708\", \"lon\":\"-58.7064573\", \"place_rank\":\"26\", \"category\":\"highway\", \"type\":\"motorway\", \"importance\":\"0.1\", \"addresstype\":\"road\", \"display_name\":\"Autopista Pedro Eugenio Aramburu, El Tri\u00e1ngulo, Partido de Malvinas Argentinas, Buenos Aires, 1.619, Argentina\", \"name\":\"Autopista Pedro Eugenio Aramburu\", \"address\":{ \"road\":\"Autopista Pedro Eugenio Aramburu\", \"village\":\"El Tri\u00e1ngulo\", \"state_district\":\"Partido de Malvinas Argentinas\", \"state\":\"Buenos Aires\", \"postcode\":\"1.619\", \"country\":\"Argentina\", \"country_code\":\"ar\" }, \"boundingbox\":[\"-34.44159\",\"-34.4370994\",\"-58.7086067\",\"-58.7044712\"] } Example with format=geojson \uf0c1 https://nominatim.openstreetmap.org/reverse?format=geojson&lat=44.50155&lon=11.33989 { \"type\": \"FeatureCollection\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"features\": [ { \"type\": \"Feature\", \"properties\": { \"place_id\": \"18512203\", \"osm_type\": \"node\", \"osm_id\": \"1704756187\", \"place_rank\": \"30\", \"category\": \"place\", \"type\": \"house\", \"importance\": \"0\", \"addresstype\": \"place\", \"name\": null, \"display_name\": \"71, Via Guglielmo Marconi, Saragozza-Porto, Bologna, BO, Emilia-Romagna, 40122, Italy\", \"address\": { \"house_number\": \"71\", \"road\": \"Via Guglielmo Marconi\", \"suburb\": \"Saragozza-Porto\", \"city\": \"Bologna\", \"county\": \"BO\", \"state\": \"Emilia-Romagna\", \"postcode\": \"40122\", \"country\": \"Italy\", \"country_code\": \"it\" } }, \"bbox\": [ 11.3397676, 44.5014307, 11.3399676, 44.5016307 ], \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 11.3398676, 44.5015307 ] } } ] } Example with format=geocodejson \uf0c1 https://nominatim.openstreetmap.org/reverse?format=geocodejson&lat=60.2299&lon=11.1663 { \"type\": \"FeatureCollection\", \"geocoding\": { \"version\": \"0.1.0\", \"attribution\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"licence\": \"ODbL\", \"query\": \"60.229917843587,11.16630979382\" }, \"features\": { \"type\": \"Feature\", \"properties\": { \"geocoding\": { \"place_id\": \"42700574\", \"osm_type\": \"node\", \"osm_id\": \"3110596255\", \"type\": \"house\", \"accuracy\": 0, \"label\": \"1, L\u00f8venbergvegen, Mogreina, Ullensaker, Akershus, 2054, Norway\", \"name\": null, \"housenumber\": \"1\", \"street\": \"L\u00f8venbergvegen\", \"postcode\": \"2054\", \"county\": \"Akershus\", \"country\": \"Norway\", \"admin\": { \"level7\": \"Ullensaker\", \"level4\": \"Akershus\", \"level2\": \"Norway\" } } }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 11.1658572, 60.2301296 ] } } }","title":"Reverse"},{"location":"api/Reverse/#reverse-geocoding","text":"Reverse geocoding generates an address from a latitude and longitude or from an OSM object.","title":"Reverse Geocoding"},{"location":"api/Reverse/#parameters","text":"The main format of the reverse API is https://nominatim.openstreetmap.org/reverse?<query> There are two ways how the requested location can be specified: lat=<value> lon=<value> A geographic location to generate an address for. The coordiantes must be in WGS84 format. osm_type=[N|W|R] osm_id=<value> A specific OSM node(N), way(W) or relation(R) to return an address for. In both cases exactly one object is returned. The two input parameters cannot be used at the same time. Both accept the additional optional parameters listed below.","title":"Parameters"},{"location":"api/Reverse/#output-format","text":"format=[xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function ( JSONP ) i.e. <string>(<json>) . Only has an effect for JSON output formats.","title":"Output format"},{"location":"api/Reverse/#output-details","text":"addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 1) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0)","title":"Output details"},{"location":"api/Reverse/#language-of-results","text":"accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header. Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes.","title":"Language of results"},{"location":"api/Reverse/#result-limitation","text":"zoom=[0-18] Level of detail required for the address. Default: 18. This is a number that corresponds roughly to the zoom level used in map frameworks like Leaflet.js, Openlayers etc. In terms of address details the zoom levels are as follows: zoom address detail 3 country 5 state 8 county 10 city 14 suburb 16 major streets 17 major and minor streets 18 building","title":"Result limitation"},{"location":"api/Reverse/#polygon-output","text":"polygon_geojson=1 polygon_kml=1 polygon_svg=1 polygon_text=1 Output geometry of results as a GeoJSON, KML, SVG or WKT. Only one of these options can be used at a time. (Default: 0) polygon_threshold=0.0 Simplify the output geometry before returning. The parameter is the tolerance in degrees with which the geometry may differ from the original geometry. Topology is preserved in the result. (Default: 0.0)","title":"Polygon output"},{"location":"api/Reverse/#other","text":"email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0)","title":"Other"},{"location":"api/Reverse/#examples","text":"https://nominatim.openstreetmap.org/reverse?format=xml&lat=52.5487429714954&lon=-1.81602098644987&zoom=18&addressdetails=1 <reversegeocode timestamp=\"Fri, 06 Nov 09 16:33:54 +0000\" querystring=\"...\"> <result place_id=\"1620612\" osm_type=\"node\" osm_id=\"452010817\"> 135, Pilkington Avenue, Wylde Green, City of Birmingham, West Midlands (county), B72, United Kingdom </result> <addressparts> <house_number>135</house_number> <road>Pilkington Avenue</road> <village>Wylde Green</village> <town>Sutton Coldfield</town> <city>City of Birmingham</city> <county>West Midlands (county)</county> <postcode>B72</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </addressparts> </reversegeocode>","title":"Examples"},{"location":"api/Reverse/#example-with-formatjsonv2","text":"https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=-34.44076&lon=-58.70521 { \"place_id\":\"134140761\", \"licence\":\"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https:\\/\\/www.openstreetmap.org\\/copyright\", \"osm_type\":\"way\", \"osm_id\":\"280940520\", \"lat\":\"-34.4391708\", \"lon\":\"-58.7064573\", \"place_rank\":\"26\", \"category\":\"highway\", \"type\":\"motorway\", \"importance\":\"0.1\", \"addresstype\":\"road\", \"display_name\":\"Autopista Pedro Eugenio Aramburu, El Tri\u00e1ngulo, Partido de Malvinas Argentinas, Buenos Aires, 1.619, Argentina\", \"name\":\"Autopista Pedro Eugenio Aramburu\", \"address\":{ \"road\":\"Autopista Pedro Eugenio Aramburu\", \"village\":\"El Tri\u00e1ngulo\", \"state_district\":\"Partido de Malvinas Argentinas\", \"state\":\"Buenos Aires\", \"postcode\":\"1.619\", \"country\":\"Argentina\", \"country_code\":\"ar\" }, \"boundingbox\":[\"-34.44159\",\"-34.4370994\",\"-58.7086067\",\"-58.7044712\"] }","title":"Example with format=jsonv2"},{"location":"api/Reverse/#example-with-formatgeojson","text":"https://nominatim.openstreetmap.org/reverse?format=geojson&lat=44.50155&lon=11.33989 { \"type\": \"FeatureCollection\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"features\": [ { \"type\": \"Feature\", \"properties\": { \"place_id\": \"18512203\", \"osm_type\": \"node\", \"osm_id\": \"1704756187\", \"place_rank\": \"30\", \"category\": \"place\", \"type\": \"house\", \"importance\": \"0\", \"addresstype\": \"place\", \"name\": null, \"display_name\": \"71, Via Guglielmo Marconi, Saragozza-Porto, Bologna, BO, Emilia-Romagna, 40122, Italy\", \"address\": { \"house_number\": \"71\", \"road\": \"Via Guglielmo Marconi\", \"suburb\": \"Saragozza-Porto\", \"city\": \"Bologna\", \"county\": \"BO\", \"state\": \"Emilia-Romagna\", \"postcode\": \"40122\", \"country\": \"Italy\", \"country_code\": \"it\" } }, \"bbox\": [ 11.3397676, 44.5014307, 11.3399676, 44.5016307 ], \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 11.3398676, 44.5015307 ] } } ] }","title":"Example with format=geojson"},{"location":"api/Reverse/#example-with-formatgeocodejson","text":"https://nominatim.openstreetmap.org/reverse?format=geocodejson&lat=60.2299&lon=11.1663 { \"type\": \"FeatureCollection\", \"geocoding\": { \"version\": \"0.1.0\", \"attribution\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"licence\": \"ODbL\", \"query\": \"60.229917843587,11.16630979382\" }, \"features\": { \"type\": \"Feature\", \"properties\": { \"geocoding\": { \"place_id\": \"42700574\", \"osm_type\": \"node\", \"osm_id\": \"3110596255\", \"type\": \"house\", \"accuracy\": 0, \"label\": \"1, L\u00f8venbergvegen, Mogreina, Ullensaker, Akershus, 2054, Norway\", \"name\": null, \"housenumber\": \"1\", \"street\": \"L\u00f8venbergvegen\", \"postcode\": \"2054\", \"county\": \"Akershus\", \"country\": \"Norway\", \"admin\": { \"level7\": \"Ullensaker\", \"level4\": \"Akershus\", \"level2\": \"Norway\" } } }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 11.1658572, 60.2301296 ] } } }","title":"Example with format=geocodejson"},{"location":"api/Search/","text":"Search queries \uf0c1 The search API allows you to look up a location from a textual description. Nominatim supports structured as well as free-form search queries. The search query may also contain special phrases which are translated into specific OpenStreetMap (OSM) tags (e.g. Pub => amenity=pub ). Note that this only limits the items to be found, it's not suited to return complete lists of OSM objects of a specific type. For those use Overpass API . Parameters \uf0c1 The search API has the following two formats: https://nominatim.openstreetmap.org/search/<query>?<params> This format only accepts a free-form query string where the parts of the query are separated by slashes. https://nominatim.openstreetmap.org/search?<params> In this form, the query may be given through two different sets of parameters: q=<query> Free-form query string to search for. Free-form queries are processed first left-to-right and then right-to-left if that fails. So you may search for pilkington avenue, birmingham as well as for birmingham, pilkington avenue . Commas are optional, but improve performance by reducing the complexity of the search. street=<housenumber> <streetname> city=<city> county=<county> state=<state> country=<country> postalcode=<postalcode> Alternative query string format split into several parameters for structured requests. Structured requests are faster but are less robust against alternative OSM tagging schemas. Do not combine with q=<query> parameter . All three query forms accept the additional parameters listed below. Output format \uf0c1 format=[html|xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function ( JSONP ) i.e. <string>(<json>) . Only has an effect for JSON output formats. Output details \uf0c1 addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 0) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0) Language of results \uf0c1 accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header . Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes. Result limitation \uf0c1 countrycodes=<countrycode>[,<countrycode>][,<countrycode>]... Limit search results to one or more countries. <countrycode> must be the ISO 3166-1alpha2 code, e.g. gb for the United Kingdom, de for Germany. exclude_place_ids=<place_id,[place_id],[place_id] If you do not want certain OSM objects to appear in the search result, give a comma separated list of the place_id s you want to skip. This can be used to broaden search results. For example, if a previous query only returned a few results, then including those here would cause the search to return other, less accurate, matches (if possible). limit=<integer> Limit the number of returned results. (Default: 10, Maximum: 50) viewbox=<x1>,<y1>,<x2>,<y2> The preferred area to find search results. Any two corner points of the box are accepted in any order as long as they span a real box. x is longitude, y is latitude. bounded=[0|1] When a viewbox is given, restrict the result to items contained with that viewbox (see above). When viewbox and bounded=1 are given, an amenity only search is allowed. In this case, give the special keyword for the amenity in square brackets, e.g. [pub] . (Default: 0) Polygon output \uf0c1 polygon_geojson=1 polygon_kml=1 polygon_svg=1 polygon_text=1 Output geometry of results as a GeoJSON, KML, SVG or WKT. Only one of these options can be used at a time. (Default: 0) polygon_threshold=0.0 Simplify the output geometry before returning. The parameter is the tolerance in degrees with which the geometry may differ from the original geometry. Topology is preserved in the result. (Default: 0.0) Other \uf0c1 email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. dedupe=[0|1] Sometimes you have several objects in OSM identifying the same place or object in reality. The simplest case is a street being split in many different OSM ways due to different characteristics. Nominatim will attempt to detect such duplicates and only return one match unless this parameter is set to 0. (Default: 1) debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0) Examples \uf0c1 XML with polygon points \uf0c1 https://nominatim.openstreetmap.org/search?q=135+pilkington+avenue,+birmingham&format=xml&polygon=1&addressdetails=1 https://nominatim.openstreetmap.org/search/gb/birmingham/pilkington%20avenue/135?format=xml&polygon=1&addressdetails=1 https://nominatim.openstreetmap.org/search/135%20pilkington%20avenue,%20birmingham?format=xml&polygon=1&addressdetails=1 <searchresults timestamp=\"Sat, 07 Nov 09 14:42:10 +0000\" querystring=\"135 pilkington, avenue birmingham\" polygon=\"true\"> <place place_id=\"1620612\" osm_type=\"node\" osm_id=\"452010817\" boundingbox=\"52.548641204834,52.5488433837891,-1.81612110137939,-1.81592094898224\" polygonpoints=\"[['-1.81592098644987','52.5487429714954'],['-1.81592290792183','52.5487234624632'],...]\" lat=\"52.5487429714954\" lon=\"-1.81602098644987\" display_name=\"135, Pilkington Avenue, Wylde Green, City of Birmingham, West Midlands (county), B72, United Kingdom\" class=\"place\" type=\"house\"> <house_number>135</house_number> <road>Pilkington Avenue</road> <village>Wylde Green</village> <town>Sutton Coldfield</town> <city>City of Birmingham</city> <county>West Midlands (county)</county> <postcode>B72</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </place> </searchresults> JSON with SVG polygon \uf0c1 https://nominatim.openstreetmap.org/search/Unter%20den%20Linden%201%20Berlin?format=json&addressdetails=1&limit=1&polygon_svg=1 { \"address\": { \"city\": \"Berlin\", \"city_district\": \"Mitte\", \"construction\": \"Unter den Linden\", \"continent\": \"European Union\", \"country\": \"Deutschland\", \"country_code\": \"de\", \"house_number\": \"1\", \"neighbourhood\": \"Scheunenviertel\", \"postcode\": \"10117\", \"public_building\": \"Kommandantenhaus\", \"state\": \"Berlin\", \"suburb\": \"Mitte\" }, \"boundingbox\": [ \"52.5170783996582\", \"52.5173187255859\", \"13.3975105285645\", \"13.3981599807739\" ], \"class\": \"amenity\", \"display_name\": \"Kommandantenhaus, 1, Unter den Linden, Scheunenviertel, Mitte, Berlin, 10117, Deutschland, European Union\", \"importance\": 0.73606775332943, \"lat\": \"52.51719785\", \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\", \"lon\": \"13.3978352028938\", \"osm_id\": \"15976890\", \"osm_type\": \"way\", \"place_id\": \"30848715\", \"svg\": \"M 13.397511 -52.517283599999999 L 13.397829400000001 -52.517299800000004 13.398131599999999 -52.517315099999998 13.398159400000001 -52.517112099999999 13.3975388 -52.517080700000001 Z\", \"type\": \"public_building\" } JSON with address details \uf0c1 https://nominatim.openstreetmap.org/?addressdetails=1&q=bakery+in+berlin+wedding&format=json&limit=1 { \"address\": { \"bakery\": \"B\\u00e4cker Kamps\", \"city_district\": \"Mitte\", \"continent\": \"European Union\", \"country\": \"Deutschland\", \"country_code\": \"de\", \"footway\": \"Bahnsteig U6\", \"neighbourhood\": \"Sprengelkiez\", \"postcode\": \"13353\", \"state\": \"Berlin\", \"suburb\": \"Wedding\" }, \"boundingbox\": [ \"52.5460929870605\", \"52.5460968017578\", \"13.3591794967651\", \"13.3591804504395\" ], \"class\": \"shop\", \"display_name\": \"B\\u00e4cker Kamps, Bahnsteig U6, Sprengelkiez, Wedding, Mitte, Berlin, 13353, Deutschland, European Union\", \"icon\": \"https://nominatim.openstreetmap.org/images/mapicons/shopping_bakery.p.20.png\", \"importance\": 0.201, \"lat\": \"52.5460941\", \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\", \"lon\": \"13.35918\", \"osm_id\": \"317179427\", \"osm_type\": \"node\", \"place_id\": \"1453068\", \"type\": \"bakery\" } GeoJSON \uf0c1 https://nominatim.openstreetmap.org/search?q=17+Strada+Pictor+Alexandru+Romano%2C+Bukarest&format=geojson { \"type\": \"FeatureCollection\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"features\": [ { \"type\": \"Feature\", \"properties\": { \"place_id\": \"35811445\", \"osm_type\": \"node\", \"osm_id\": \"2846295644\", \"display_name\": \"17, Strada Pictor Alexandru Romano, Bukarest, Bucharest, Sector 2, Bucharest, 023964, Romania\", \"place_rank\": \"30\", \"category\": \"place\", \"type\": \"house\", \"importance\": 0.62025 }, \"bbox\": [ 26.1156689, 44.4354754, 26.1157689, 44.4355754 ], \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 26.1157189, 44.4355254 ] } } ] } GeocodeJSON \uf0c1 https://nominatim.openstreetmap.org/search?q=%CE%91%CE%B3%CE%AF%CE%B1+%CE%A4%CF%81%CE%B9%CE%AC%CE%B4%CE%B1%2C+%CE%91%CE%B4%CF%89%CE%BD%CE%B9%CE%B4%CE%BF%CF%82%2C+Athens%2C+Greece&format=geocodejson { \"type\": \"FeatureCollection\", \"geocoding\": { \"version\": \"0.1.0\", \"attribution\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"licence\": \"ODbL\", \"query\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1, \u0391\u03b4\u03c9\u03bd\u03b9\u03b4\u03bf\u03c2, Athens, Greece\" }, \"features\": [ { \"type\": \"Feature\", \"properties\": { \"geocoding\": { \"type\": \"place_of_worship\", \"label\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1, \u0391\u03b4\u03c9\u03bd\u03b9\u03b4\u03bf\u03c2, \u0386\u03b3\u03b9\u03bf\u03c2 \u039d\u03b9\u03ba\u03cc\u03bb\u03b1\u03bf\u03c2, 5\u00ba \u0394\u03b7\u03bc\u03bf\u03c4\u03b9\u03ba\u03cc \u0394\u03b9\u03b1\u03bc\u03ad\u03c1\u03b9\u03c3\u03bc\u03b1 \u0391\u03b8\u03b7\u03bd\u03ce\u03bd, Athens, Municipality of Athens, Regional Unit of Central Athens, Region of Attica, Attica, 11472, Greece\", \"name\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1\", \"admin\": null } }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 23.72949633941, 38.0051697 ] } } ] }","title":"Search"},{"location":"api/Search/#search-queries","text":"The search API allows you to look up a location from a textual description. Nominatim supports structured as well as free-form search queries. The search query may also contain special phrases which are translated into specific OpenStreetMap (OSM) tags (e.g. Pub => amenity=pub ). Note that this only limits the items to be found, it's not suited to return complete lists of OSM objects of a specific type. For those use Overpass API .","title":"Search queries"},{"location":"api/Search/#parameters","text":"The search API has the following two formats: https://nominatim.openstreetmap.org/search/<query>?<params> This format only accepts a free-form query string where the parts of the query are separated by slashes. https://nominatim.openstreetmap.org/search?<params> In this form, the query may be given through two different sets of parameters: q=<query> Free-form query string to search for. Free-form queries are processed first left-to-right and then right-to-left if that fails. So you may search for pilkington avenue, birmingham as well as for birmingham, pilkington avenue . Commas are optional, but improve performance by reducing the complexity of the search. street=<housenumber> <streetname> city=<city> county=<county> state=<state> country=<country> postalcode=<postalcode> Alternative query string format split into several parameters for structured requests. Structured requests are faster but are less robust against alternative OSM tagging schemas. Do not combine with q=<query> parameter . All three query forms accept the additional parameters listed below.","title":"Parameters"},{"location":"api/Search/#output-format","text":"format=[html|xml|json|jsonv2|geojson|geocodejson] See Place Output Formats for details on each format. (Default: html) json_callback=<string> Wrap JSON output in a callback function ( JSONP ) i.e. <string>(<json>) . Only has an effect for JSON output formats.","title":"Output format"},{"location":"api/Search/#output-details","text":"addressdetails=[0|1] Include a breakdown of the address into elements. (Default: 0) extratags=[0|1] Include additional information in the result if available, e.g. wikipedia link, opening hours. (Default: 0) namedetails=[0|1] Include a list of alternative names in the results. These may include language variants, references, operator and brand. (Default: 0)","title":"Output details"},{"location":"api/Search/#language-of-results","text":"accept-language=<browser language string> Preferred language order for showing search results, overrides the value specified in the \"Accept-Language\" HTTP header . Either use a standard RFC2616 accept-language string or a simple comma-separated list of language codes.","title":"Language of results"},{"location":"api/Search/#result-limitation","text":"countrycodes=<countrycode>[,<countrycode>][,<countrycode>]... Limit search results to one or more countries. <countrycode> must be the ISO 3166-1alpha2 code, e.g. gb for the United Kingdom, de for Germany. exclude_place_ids=<place_id,[place_id],[place_id] If you do not want certain OSM objects to appear in the search result, give a comma separated list of the place_id s you want to skip. This can be used to broaden search results. For example, if a previous query only returned a few results, then including those here would cause the search to return other, less accurate, matches (if possible). limit=<integer> Limit the number of returned results. (Default: 10, Maximum: 50) viewbox=<x1>,<y1>,<x2>,<y2> The preferred area to find search results. Any two corner points of the box are accepted in any order as long as they span a real box. x is longitude, y is latitude. bounded=[0|1] When a viewbox is given, restrict the result to items contained with that viewbox (see above). When viewbox and bounded=1 are given, an amenity only search is allowed. In this case, give the special keyword for the amenity in square brackets, e.g. [pub] . (Default: 0)","title":"Result limitation"},{"location":"api/Search/#polygon-output","text":"polygon_geojson=1 polygon_kml=1 polygon_svg=1 polygon_text=1 Output geometry of results as a GeoJSON, KML, SVG or WKT. Only one of these options can be used at a time. (Default: 0) polygon_threshold=0.0 Simplify the output geometry before returning. The parameter is the tolerance in degrees with which the geometry may differ from the original geometry. Topology is preserved in the result. (Default: 0.0)","title":"Polygon output"},{"location":"api/Search/#other","text":"email=<valid email address> If you are making large numbers of request please include an appropriate email address to identify your requests. See Nominatim's Usage Policy for more details. dedupe=[0|1] Sometimes you have several objects in OSM identifying the same place or object in reality. The simplest case is a street being split in many different OSM ways due to different characteristics. Nominatim will attempt to detect such duplicates and only return one match unless this parameter is set to 0. (Default: 1) debug=[0|1] Output assorted developer debug information. Data on internals of Nominatim's \"Search Loop\" logic, and SQL queries. The output is (rough) HTML format. This overrides the specified machine readable format. (Default: 0)","title":"Other"},{"location":"api/Search/#examples","text":"","title":"Examples"},{"location":"api/Search/#xml-with-polygon-points","text":"https://nominatim.openstreetmap.org/search?q=135+pilkington+avenue,+birmingham&format=xml&polygon=1&addressdetails=1 https://nominatim.openstreetmap.org/search/gb/birmingham/pilkington%20avenue/135?format=xml&polygon=1&addressdetails=1 https://nominatim.openstreetmap.org/search/135%20pilkington%20avenue,%20birmingham?format=xml&polygon=1&addressdetails=1 <searchresults timestamp=\"Sat, 07 Nov 09 14:42:10 +0000\" querystring=\"135 pilkington, avenue birmingham\" polygon=\"true\"> <place place_id=\"1620612\" osm_type=\"node\" osm_id=\"452010817\" boundingbox=\"52.548641204834,52.5488433837891,-1.81612110137939,-1.81592094898224\" polygonpoints=\"[['-1.81592098644987','52.5487429714954'],['-1.81592290792183','52.5487234624632'],...]\" lat=\"52.5487429714954\" lon=\"-1.81602098644987\" display_name=\"135, Pilkington Avenue, Wylde Green, City of Birmingham, West Midlands (county), B72, United Kingdom\" class=\"place\" type=\"house\"> <house_number>135</house_number> <road>Pilkington Avenue</road> <village>Wylde Green</village> <town>Sutton Coldfield</town> <city>City of Birmingham</city> <county>West Midlands (county)</county> <postcode>B72</postcode> <country>United Kingdom</country> <country_code>gb</country_code> </place> </searchresults>","title":"XML with polygon points"},{"location":"api/Search/#json-with-svg-polygon","text":"https://nominatim.openstreetmap.org/search/Unter%20den%20Linden%201%20Berlin?format=json&addressdetails=1&limit=1&polygon_svg=1 { \"address\": { \"city\": \"Berlin\", \"city_district\": \"Mitte\", \"construction\": \"Unter den Linden\", \"continent\": \"European Union\", \"country\": \"Deutschland\", \"country_code\": \"de\", \"house_number\": \"1\", \"neighbourhood\": \"Scheunenviertel\", \"postcode\": \"10117\", \"public_building\": \"Kommandantenhaus\", \"state\": \"Berlin\", \"suburb\": \"Mitte\" }, \"boundingbox\": [ \"52.5170783996582\", \"52.5173187255859\", \"13.3975105285645\", \"13.3981599807739\" ], \"class\": \"amenity\", \"display_name\": \"Kommandantenhaus, 1, Unter den Linden, Scheunenviertel, Mitte, Berlin, 10117, Deutschland, European Union\", \"importance\": 0.73606775332943, \"lat\": \"52.51719785\", \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\", \"lon\": \"13.3978352028938\", \"osm_id\": \"15976890\", \"osm_type\": \"way\", \"place_id\": \"30848715\", \"svg\": \"M 13.397511 -52.517283599999999 L 13.397829400000001 -52.517299800000004 13.398131599999999 -52.517315099999998 13.398159400000001 -52.517112099999999 13.3975388 -52.517080700000001 Z\", \"type\": \"public_building\" }","title":"JSON with SVG polygon"},{"location":"api/Search/#json-with-address-details","text":"https://nominatim.openstreetmap.org/?addressdetails=1&q=bakery+in+berlin+wedding&format=json&limit=1 { \"address\": { \"bakery\": \"B\\u00e4cker Kamps\", \"city_district\": \"Mitte\", \"continent\": \"European Union\", \"country\": \"Deutschland\", \"country_code\": \"de\", \"footway\": \"Bahnsteig U6\", \"neighbourhood\": \"Sprengelkiez\", \"postcode\": \"13353\", \"state\": \"Berlin\", \"suburb\": \"Wedding\" }, \"boundingbox\": [ \"52.5460929870605\", \"52.5460968017578\", \"13.3591794967651\", \"13.3591804504395\" ], \"class\": \"shop\", \"display_name\": \"B\\u00e4cker Kamps, Bahnsteig U6, Sprengelkiez, Wedding, Mitte, Berlin, 13353, Deutschland, European Union\", \"icon\": \"https://nominatim.openstreetmap.org/images/mapicons/shopping_bakery.p.20.png\", \"importance\": 0.201, \"lat\": \"52.5460941\", \"licence\": \"Data \\u00a9 OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\", \"lon\": \"13.35918\", \"osm_id\": \"317179427\", \"osm_type\": \"node\", \"place_id\": \"1453068\", \"type\": \"bakery\" }","title":"JSON with address details"},{"location":"api/Search/#geojson","text":"https://nominatim.openstreetmap.org/search?q=17+Strada+Pictor+Alexandru+Romano%2C+Bukarest&format=geojson { \"type\": \"FeatureCollection\", \"licence\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"features\": [ { \"type\": \"Feature\", \"properties\": { \"place_id\": \"35811445\", \"osm_type\": \"node\", \"osm_id\": \"2846295644\", \"display_name\": \"17, Strada Pictor Alexandru Romano, Bukarest, Bucharest, Sector 2, Bucharest, 023964, Romania\", \"place_rank\": \"30\", \"category\": \"place\", \"type\": \"house\", \"importance\": 0.62025 }, \"bbox\": [ 26.1156689, 44.4354754, 26.1157689, 44.4355754 ], \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 26.1157189, 44.4355254 ] } } ] }","title":"GeoJSON"},{"location":"api/Search/#geocodejson","text":"https://nominatim.openstreetmap.org/search?q=%CE%91%CE%B3%CE%AF%CE%B1+%CE%A4%CF%81%CE%B9%CE%AC%CE%B4%CE%B1%2C+%CE%91%CE%B4%CF%89%CE%BD%CE%B9%CE%B4%CE%BF%CF%82%2C+Athens%2C+Greece&format=geocodejson { \"type\": \"FeatureCollection\", \"geocoding\": { \"version\": \"0.1.0\", \"attribution\": \"Data \u00a9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\", \"licence\": \"ODbL\", \"query\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1, \u0391\u03b4\u03c9\u03bd\u03b9\u03b4\u03bf\u03c2, Athens, Greece\" }, \"features\": [ { \"type\": \"Feature\", \"properties\": { \"geocoding\": { \"type\": \"place_of_worship\", \"label\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1, \u0391\u03b4\u03c9\u03bd\u03b9\u03b4\u03bf\u03c2, \u0386\u03b3\u03b9\u03bf\u03c2 \u039d\u03b9\u03ba\u03cc\u03bb\u03b1\u03bf\u03c2, 5\u00ba \u0394\u03b7\u03bc\u03bf\u03c4\u03b9\u03ba\u03cc \u0394\u03b9\u03b1\u03bc\u03ad\u03c1\u03b9\u03c3\u03bc\u03b1 \u0391\u03b8\u03b7\u03bd\u03ce\u03bd, Athens, Municipality of Athens, Regional Unit of Central Athens, Region of Attica, Attica, 11472, Greece\", \"name\": \"\u0391\u03b3\u03af\u03b1 \u03a4\u03c1\u03b9\u03ac\u03b4\u03b1\", \"admin\": null } }, \"geometry\": { \"type\": \"Point\", \"coordinates\": [ 23.72949633941, 38.0051697 ] } } ] }","title":"GeocodeJSON"},{"location":"appendix/Install-on-Centos-7/","text":"Note: these installation instructions are also available in executable form for use with vagrant under vagrant/Install-on-Centos-7.sh . Installing the Required Software \uf0c1 These instructions expect that you have a freshly installed CentOS version 7. Make sure all packages are up-to-date by running: sudo yum update -y The standard CentOS repositories don't contain all the required packages, you need to enable the EPEL repository as well. To enable it on CentOS, install the epel-release RPM by running: sudo yum install -y epel-release Now you can install all packages needed for Nominatim: sudo yum install -y postgresql-server postgresql-contrib postgresql-devel \\ postgis postgis-utils \\ wget git cmake make gcc gcc-c++ libtool policycoreutils-python \\ php-pgsql php php-intl libpqxx-devel \\ proj-epsg bzip2-devel proj-devel libxml2-devel boost-devel \\ expat-devel zlib-devel If you want to run the test suite, you need to install the following additional packages: sudo yum install -y python34-pip python34-setuptools python34-devel \\ php-phpunit-PHPUnit pip3 install --user behave nose pytidylib psycopg2 composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/ System Configuration \uf0c1 The following steps are meant to configure a fresh CentOS installation for use with Nominatim. You may skip some of the steps if you have your OS already configured. Creating Dedicated User Accounts \uf0c1 Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME Setting up PostgreSQL \uf0c1 CentOS does not automatically create a database cluster. Therefore, start with initializing the database, then enable the server to start at boot: sudo postgresql-setup initdb sudo systemctl enable postgresql Next tune the postgresql configuration, which is located in /var/lib/pgsql/data/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Now start the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database only for reading: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser apache Setting up the Apache Webserver \uf0c1 You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/httpd/conf.d/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/build/website EOFAPACHECONF Then reload apache sudo systemctl enable httpd sudo systemctl restart httpd Installing Nominatim \uf0c1 Building and Configuration \uf0c1 Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: cd $USERHOME mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make Adding SELinux Security Settings \uf0c1 It is a good idea to leave SELinux enabled and enforcing, particularly with a web server accessible from the Internet. At a minimum the following SELinux labeling should be done for Nominatim: sudo semanage fcontext -a -t httpd_sys_content_t \"$USERHOME/Nominatim-3.4.0/(website|lib|settings)(/.*)?\" sudo semanage fcontext -a -t httpd_sys_content_t \"$USERHOME/build/(website|lib|settings)(/.*)?\" sudo semanage fcontext -a -t lib_t \"$USERHOME/build/module/nominatim.so\" sudo restorecon -R -v $USERHOME/Nominatim-3.4.0 sudo restorecon -R -v $USERHOME/build You need to create a minimal configuration file that tells nominatim the name of your webserver user and the URL of the website: tee settings/local.php << EOF <?php @define('CONST_Database_Web_User', 'apache'); @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Installation on CentOS 7"},{"location":"appendix/Install-on-Centos-7/#installing-the-required-software","text":"These instructions expect that you have a freshly installed CentOS version 7. Make sure all packages are up-to-date by running: sudo yum update -y The standard CentOS repositories don't contain all the required packages, you need to enable the EPEL repository as well. To enable it on CentOS, install the epel-release RPM by running: sudo yum install -y epel-release Now you can install all packages needed for Nominatim: sudo yum install -y postgresql-server postgresql-contrib postgresql-devel \\ postgis postgis-utils \\ wget git cmake make gcc gcc-c++ libtool policycoreutils-python \\ php-pgsql php php-intl libpqxx-devel \\ proj-epsg bzip2-devel proj-devel libxml2-devel boost-devel \\ expat-devel zlib-devel If you want to run the test suite, you need to install the following additional packages: sudo yum install -y python34-pip python34-setuptools python34-devel \\ php-phpunit-PHPUnit pip3 install --user behave nose pytidylib psycopg2 composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/","title":"Installing the Required Software"},{"location":"appendix/Install-on-Centos-7/#system-configuration","text":"The following steps are meant to configure a fresh CentOS installation for use with Nominatim. You may skip some of the steps if you have your OS already configured.","title":"System Configuration"},{"location":"appendix/Install-on-Centos-7/#creating-dedicated-user-accounts","text":"Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME","title":"Creating Dedicated User Accounts"},{"location":"appendix/Install-on-Centos-7/#setting-up-postgresql","text":"CentOS does not automatically create a database cluster. Therefore, start with initializing the database, then enable the server to start at boot: sudo postgresql-setup initdb sudo systemctl enable postgresql Next tune the postgresql configuration, which is located in /var/lib/pgsql/data/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Now start the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database only for reading: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser apache","title":"Setting up PostgreSQL"},{"location":"appendix/Install-on-Centos-7/#setting-up-the-apache-webserver","text":"You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/httpd/conf.d/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/build/website EOFAPACHECONF Then reload apache sudo systemctl enable httpd sudo systemctl restart httpd","title":"Setting up the Apache Webserver"},{"location":"appendix/Install-on-Centos-7/#installing-nominatim","text":"","title":"Installing Nominatim"},{"location":"appendix/Install-on-Centos-7/#building-and-configuration","text":"Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: cd $USERHOME mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make","title":"Building and Configuration"},{"location":"appendix/Install-on-Centos-7/#adding-selinux-security-settings","text":"It is a good idea to leave SELinux enabled and enforcing, particularly with a web server accessible from the Internet. At a minimum the following SELinux labeling should be done for Nominatim: sudo semanage fcontext -a -t httpd_sys_content_t \"$USERHOME/Nominatim-3.4.0/(website|lib|settings)(/.*)?\" sudo semanage fcontext -a -t httpd_sys_content_t \"$USERHOME/build/(website|lib|settings)(/.*)?\" sudo semanage fcontext -a -t lib_t \"$USERHOME/build/module/nominatim.so\" sudo restorecon -R -v $USERHOME/Nominatim-3.4.0 sudo restorecon -R -v $USERHOME/build You need to create a minimal configuration file that tells nominatim the name of your webserver user and the URL of the website: tee settings/local.php << EOF <?php @define('CONST_Database_Web_User', 'apache'); @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Adding SELinux Security Settings"},{"location":"appendix/Install-on-Ubuntu-16/","text":"Note: these installation instructions are also available in executable form for use with vagrant under vagrant/Install-on-Ubuntu-16.sh. Installing the Required Software \uf0c1 These instructions expect that you have a freshly installed Ubuntu 16.04. Make sure all packages are are up-to-date by running: sudo apt-get update -qq Now you can install all packages needed for Nominatim: sudo apt-get install -y build-essential cmake g++ libboost-dev libboost-system-dev \\ libboost-filesystem-dev libexpat1-dev zlib1g-dev libxml2-dev\\ libbz2-dev libpq-dev libproj-dev \\ postgresql-server-dev-9.5 postgresql-9.5-postgis-2.2 \\ postgresql-contrib-9.5 \\ apache2 php php-pgsql libapache2-mod-php \\ php-intl git If you want to run the test suite, you need to install the following additional packages: sudo apt-get install -y python3-setuptools python3-dev python3-pip \\ python3-psycopg2 python3-tidylib phpunit php-cgi pip3 install --user behave nose composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/ System Configuration \uf0c1 The following steps are meant to configure a fresh Ubuntu installation for use with Nominatim. You may skip some of the steps if you have your OS already configured. Creating Dedicated User Accounts \uf0c1 Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME Setting up PostgreSQL \uf0c1 Tune the postgresql configuration, which is located in /etc/postgresql/9.5/main/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Restart the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database for reading only: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser www-data Setting up the Apache Webserver \uf0c1 You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/apache2/conf-available/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/Nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/Nominatim/build/website EOFAPACHECONF Then enable the configuration and restart apache sudo a2enconf nominatim sudo systemctl restart apache2 Installing Nominatim \uf0c1 Building and Configuration \uf0c1 Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make You need to create a minimal configuration file that tells nominatim where it is located on the webserver: tee settings/local.php << EOF <?php @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Installation on Ubuntu 16"},{"location":"appendix/Install-on-Ubuntu-16/#installing-the-required-software","text":"These instructions expect that you have a freshly installed Ubuntu 16.04. Make sure all packages are are up-to-date by running: sudo apt-get update -qq Now you can install all packages needed for Nominatim: sudo apt-get install -y build-essential cmake g++ libboost-dev libboost-system-dev \\ libboost-filesystem-dev libexpat1-dev zlib1g-dev libxml2-dev\\ libbz2-dev libpq-dev libproj-dev \\ postgresql-server-dev-9.5 postgresql-9.5-postgis-2.2 \\ postgresql-contrib-9.5 \\ apache2 php php-pgsql libapache2-mod-php \\ php-intl git If you want to run the test suite, you need to install the following additional packages: sudo apt-get install -y python3-setuptools python3-dev python3-pip \\ python3-psycopg2 python3-tidylib phpunit php-cgi pip3 install --user behave nose composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/","title":"Installing the Required Software"},{"location":"appendix/Install-on-Ubuntu-16/#system-configuration","text":"The following steps are meant to configure a fresh Ubuntu installation for use with Nominatim. You may skip some of the steps if you have your OS already configured.","title":"System Configuration"},{"location":"appendix/Install-on-Ubuntu-16/#creating-dedicated-user-accounts","text":"Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME","title":"Creating Dedicated User Accounts"},{"location":"appendix/Install-on-Ubuntu-16/#setting-up-postgresql","text":"Tune the postgresql configuration, which is located in /etc/postgresql/9.5/main/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Restart the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database for reading only: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser www-data","title":"Setting up PostgreSQL"},{"location":"appendix/Install-on-Ubuntu-16/#setting-up-the-apache-webserver","text":"You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/apache2/conf-available/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/Nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/Nominatim/build/website EOFAPACHECONF Then enable the configuration and restart apache sudo a2enconf nominatim sudo systemctl restart apache2","title":"Setting up the Apache Webserver"},{"location":"appendix/Install-on-Ubuntu-16/#installing-nominatim","text":"","title":"Installing Nominatim"},{"location":"appendix/Install-on-Ubuntu-16/#building-and-configuration","text":"Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make You need to create a minimal configuration file that tells nominatim where it is located on the webserver: tee settings/local.php << EOF <?php @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Building and Configuration"},{"location":"appendix/Install-on-Ubuntu-18/","text":"Note: these installation instructions are also available in executable form for use with vagrant under vagrant/Install-on-Ubuntu-18.sh. Installing the Required Software \uf0c1 These instructions expect that you have a freshly installed Ubuntu 18.04. Make sure all packages are are up-to-date by running: sudo apt-get update -qq Now you can install all packages needed for Nominatim: sudo apt-get install -y build-essential cmake g++ libboost-dev libboost-system-dev \\ libboost-filesystem-dev libexpat1-dev zlib1g-dev libxml2-dev \\ libbz2-dev libpq-dev libproj-dev \\ postgresql-server-dev-10 postgresql-10-postgis-2.4 \\ postgresql-contrib-10 postgresql-10-postgis-scripts \\ apache2 php php-pgsql libapache2-mod-php \\ php-intl git If you want to run the test suite, you need to install the following additional packages: sudo apt-get install -y python3-setuptools python3-dev python3-pip \\ python3-psycopg2 python3-tidylib phpunit php-cgi pip3 install --user behave nose composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/ System Configuration \uf0c1 The following steps are meant to configure a fresh Ubuntu installation for use with Nominatim. You may skip some of the steps if you have your OS already configured. Creating Dedicated User Accounts \uf0c1 Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME Setting up PostgreSQL \uf0c1 Tune the postgresql configuration, which is located in /etc/postgresql/10/main/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Restart the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database for reading only: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser www-data Setting up the Apache Webserver \uf0c1 You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/apache2/conf-available/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/Nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/Nominatim/build/website EOFAPACHECONF Then enable the configuration and restart apache sudo a2enconf nominatim sudo systemctl restart apache2 Installing Nominatim \uf0c1 Building and Configuration \uf0c1 Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make You need to create a minimal configuration file that tells nominatim where it is located on the webserver: tee settings/local.php << EOF <?php @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Installation on Ubuntu 18"},{"location":"appendix/Install-on-Ubuntu-18/#installing-the-required-software","text":"These instructions expect that you have a freshly installed Ubuntu 18.04. Make sure all packages are are up-to-date by running: sudo apt-get update -qq Now you can install all packages needed for Nominatim: sudo apt-get install -y build-essential cmake g++ libboost-dev libboost-system-dev \\ libboost-filesystem-dev libexpat1-dev zlib1g-dev libxml2-dev \\ libbz2-dev libpq-dev libproj-dev \\ postgresql-server-dev-10 postgresql-10-postgis-2.4 \\ postgresql-contrib-10 postgresql-10-postgis-scripts \\ apache2 php php-pgsql libapache2-mod-php \\ php-intl git If you want to run the test suite, you need to install the following additional packages: sudo apt-get install -y python3-setuptools python3-dev python3-pip \\ python3-psycopg2 python3-tidylib phpunit php-cgi pip3 install --user behave nose composer global require \"squizlabs/php_codesniffer=*\" sudo ln -s ~/.config/composer/vendor/bin/phpcs /usr/bin/","title":"Installing the Required Software"},{"location":"appendix/Install-on-Ubuntu-18/#system-configuration","text":"The following steps are meant to configure a fresh Ubuntu installation for use with Nominatim. You may skip some of the steps if you have your OS already configured.","title":"System Configuration"},{"location":"appendix/Install-on-Ubuntu-18/#creating-dedicated-user-accounts","text":"Nominatim will run as a global service on your machine. It is therefore best to install it under its own separate user account. In the following we assume this user is called nominatim and the installation will be in /srv/nominatim. To create the user and directory run: sudo useradd -d /srv/nominatim -s /bin/bash -m nominatim You may find a more suitable location if you wish. To be able to copy and paste instructions from this manual, export user name and home directory now like this: export USERNAME=nominatim export USERHOME=/srv/nominatim Never, ever run the installation as a root user. You have been warned. Make sure that system servers can read from the home directory: chmod a+x $USERHOME","title":"Creating Dedicated User Accounts"},{"location":"appendix/Install-on-Ubuntu-18/#setting-up-postgresql","text":"Tune the postgresql configuration, which is located in /etc/postgresql/10/main/postgresql.conf . See section Postgres Tuning in the installation page for the parameters to change. Restart the postgresql service after updating this config file. sudo systemctl restart postgresql Finally, we need to add two postgres users: one for the user that does the import and another for the webserver which should access the database for reading only: sudo -u postgres createuser -s $USERNAME sudo -u postgres createuser www-data","title":"Setting up PostgreSQL"},{"location":"appendix/Install-on-Ubuntu-18/#setting-up-the-apache-webserver","text":"You need to create an alias to the website directory in your apache configuration. Add a separate nominatim configuration to your webserver: sudo tee /etc/apache2/conf-available/nominatim.conf << EOFAPACHECONF <Directory \"$USERHOME/Nominatim/build/website\"> Options FollowSymLinks MultiViews AddType text/html .php DirectoryIndex search.php Require all granted </Directory> Alias /nominatim $USERHOME/Nominatim/build/website EOFAPACHECONF Then enable the configuration and restart apache sudo a2enconf nominatim sudo systemctl restart apache2","title":"Setting up the Apache Webserver"},{"location":"appendix/Install-on-Ubuntu-18/#installing-nominatim","text":"","title":"Installing Nominatim"},{"location":"appendix/Install-on-Ubuntu-18/#building-and-configuration","text":"Get the source code for the release and change into the source directory cd $USERHOME wget https://nominatim.org/release/Nominatim-3.4.0.tar.bz2 tar xf Nominatim-3.4.0.tar.bz2 cd Nominatim-3.4.0 The code must be built in a separate directory. Create this directory, then configure and build Nominatim in there: mkdir build cd build cmake $USERHOME/Nominatim-3.4.0 make You need to create a minimal configuration file that tells nominatim where it is located on the webserver: tee settings/local.php << EOF <?php @define('CONST_Website_BaseURL', '/nominatim/'); EOF Nominatim is now ready to use. Continue with importing a database from OSM data .","title":"Building and Configuration"},{"location":"data-sources/Country-Grid/","text":"Fallback Country Boundaries \uf0c1 Each place is assigned a country_code and partition. Partitions derive from country_code . Nominatim imports two pre-generated files data/country_name.sql (country code, name, default language, partition) data/country_osm_grid.sql (country code, geometry) before creating places in the database. This helps with fast lookups and missing data (e.g. if the data the user wants to import doesn't contain any country places). The number of countries in the world can change (South Sudan created 2011, Germany reunification), so can their boundaries. This document explain how the pre-generated files can be updated. Country code \uf0c1 Each place is assigned a two letter country_code based on its location, e.g. gb for Great Britain. Or NULL if no suitable country is found (usually it's in open water then). In sql/functions.sql: get_country_code(geometry) the place's center is checked against country places already imported from the user's data file. Places are imported by rank low-to-high. Lowest rank 2 is countries so most places should be matched. Still the data file might be incomplete. if unmatched: OSM grid boundaries if still unmatched: OSM grid boundaries, but allow a small distance Partitions \uf0c1 Each place is assigned partition, which is a number 0..250. 0 is fallback/other. During place indexing ( sql/functions.sql: placex_insert() ) a place is assigned the partition based on its country code ( sql/functions.sql: get_partition(country_code) ). It checks in the country_name table. Most countries have their own partition, some share a partition. Thus partition counts vary greatly. Several database tables are split by partition to allow queries to run against less indices and improve caching. location_area_large_<partition> search_name_<partition> location_road_<partition> Data files \uf0c1 data/country_name.sql \uf0c1 Export from existing database table plus manual changes. country_default_language_code most taken from https://wiki.openstreetmap.org/wiki/Nominatim/Country_Codes , see utils/country_languages.php . data/country_osm_grid.sql \uf0c1 country_grid.sql merges territories by country. Then uses function.sql: quad_split_geometry to split each country into multiple Quadtree polygons for faster point-in-polygon lookups. To visualize one country as geojson feature collection, e.g. for loading into geojson.io : -- http://www.postgresonline.com/journal/archives/267-Creating-GeoJSON-Feature-Collections-with-JSON-and-PostGIS-functions.html SELECT row_to_json(fc) FROM ( SELECT 'FeatureCollection' As type, array_to_json(array_agg(f)) As features FROM ( SELECT 'Feature' As type, ST_AsGeoJSON(lg.geometry)::json As geometry, row_to_json((country_code, area)) As properties FROM country_osm_grid As lg where country_code='mx' ) As f ) As fc; cat /tmp/query.sql | psql -At nominatim > /tmp/mexico.quad.geojson","title":"Country Grid"},{"location":"data-sources/Country-Grid/#fallback-country-boundaries","text":"Each place is assigned a country_code and partition. Partitions derive from country_code . Nominatim imports two pre-generated files data/country_name.sql (country code, name, default language, partition) data/country_osm_grid.sql (country code, geometry) before creating places in the database. This helps with fast lookups and missing data (e.g. if the data the user wants to import doesn't contain any country places). The number of countries in the world can change (South Sudan created 2011, Germany reunification), so can their boundaries. This document explain how the pre-generated files can be updated.","title":"Fallback Country Boundaries"},{"location":"data-sources/Country-Grid/#country-code","text":"Each place is assigned a two letter country_code based on its location, e.g. gb for Great Britain. Or NULL if no suitable country is found (usually it's in open water then). In sql/functions.sql: get_country_code(geometry) the place's center is checked against country places already imported from the user's data file. Places are imported by rank low-to-high. Lowest rank 2 is countries so most places should be matched. Still the data file might be incomplete. if unmatched: OSM grid boundaries if still unmatched: OSM grid boundaries, but allow a small distance","title":"Country code"},{"location":"data-sources/Country-Grid/#partitions","text":"Each place is assigned partition, which is a number 0..250. 0 is fallback/other. During place indexing ( sql/functions.sql: placex_insert() ) a place is assigned the partition based on its country code ( sql/functions.sql: get_partition(country_code) ). It checks in the country_name table. Most countries have their own partition, some share a partition. Thus partition counts vary greatly. Several database tables are split by partition to allow queries to run against less indices and improve caching. location_area_large_<partition> search_name_<partition> location_road_<partition>","title":"Partitions"},{"location":"data-sources/Country-Grid/#data-files","text":"","title":"Data files"},{"location":"data-sources/Country-Grid/#datacountry_namesql","text":"Export from existing database table plus manual changes. country_default_language_code most taken from https://wiki.openstreetmap.org/wiki/Nominatim/Country_Codes , see utils/country_languages.php .","title":"data/country_name.sql"},{"location":"data-sources/Country-Grid/#datacountry_osm_gridsql","text":"country_grid.sql merges territories by country. Then uses function.sql: quad_split_geometry to split each country into multiple Quadtree polygons for faster point-in-polygon lookups. To visualize one country as geojson feature collection, e.g. for loading into geojson.io : -- http://www.postgresonline.com/journal/archives/267-Creating-GeoJSON-Feature-Collections-with-JSON-and-PostGIS-functions.html SELECT row_to_json(fc) FROM ( SELECT 'FeatureCollection' As type, array_to_json(array_agg(f)) As features FROM ( SELECT 'Feature' As type, ST_AsGeoJSON(lg.geometry)::json As geometry, row_to_json((country_code, area)) As properties FROM country_osm_grid As lg where country_code='mx' ) As f ) As fc; cat /tmp/query.sql | psql -At nominatim > /tmp/mexico.quad.geojson","title":"data/country_osm_grid.sql"},{"location":"data-sources/GB-Postcodes/","text":"GB Postcodes \uf0c1 The server importing instructions allow optionally download gb_postcode_data.sql.gz . This document explains how the file got created. GB vs UK \uf0c1 GB (Great Britain) is more correct as the Ordnance Survey dataset doesn't contain postcodes from Northern Ireland. Importing separately after the initial import \uf0c1 If you forgot to download the file, or have a new version, you can import it separately: Import the downloaded gb_postcode_data.sql.gz file. Run the SQL query SELECT count(getorcreate_postcode_id(postcode)) FROM gb_postcode; . This will update the search index. Run utils/setup.php --calculate-postcodes from the build directory. This will copy data form the gb_postcode table to the location_postcodes table. Converting Code-Point Open data \uf0c1 Download from Code-Point\u00ae Open . It requires an email address where a download link will be send to. unzip codepo_gb.zip Unpacked you'll see a directory of CSV files. $ more codepo_gb/Data/CSV/n.csv \"N1 0AA\",10,530626,183961,\"E92000001\",\"E19000003\",\"E18000007\",\"\",\"E09000019\",\"E05000368\" \"N1 0AB\",10,530559,183978,\"E92000001\",\"E19000003\",\"E18000007\",\"\",\"E09000019\",\"E05000368\" The coordinates are \"Northings\" and \"Eastings\" in OSGB 1936 projection. They can be projected to WGS84 like this SELECT ST_AsText(ST_Transform(ST_SetSRID('POINT(530626 183961)'::geometry,27700), 4326)); POINT(-0.117872733220225 51.5394424719303) -0.117872733220225 51.5394424719303 on OSM map Create database, import CSV files, add geometry column, dump into file DBNAME=create_gb_postcode_file createdb $DBNAME echo 'CREATE EXTENSION postgis' | psql $DBNAME cat data/gb_postcode_table.sql | psql $DBNAME cat codepo_gb/Data/CSV/*.csv | ./data-sources/gb-postcodes/convert_codepoint.php | psql $DBNAME cat codepo_gb/Doc/licence.txt | iconv -f iso-8859-1 -t utf-8 | dos2unix | sed 's/^/-- /g' > gb_postcode_data.sql pg_dump -a -t gb_postcode $DBNAME | grep -v '^--' >> gb_postcode_data.sql gzip -9 -f gb_postcode_data.sql ls -lah gb_postcode_data.* # dropdb $DBNAME","title":"GB Postcodes"},{"location":"data-sources/GB-Postcodes/#gb-postcodes","text":"The server importing instructions allow optionally download gb_postcode_data.sql.gz . This document explains how the file got created.","title":"GB Postcodes"},{"location":"data-sources/GB-Postcodes/#gb-vs-uk","text":"GB (Great Britain) is more correct as the Ordnance Survey dataset doesn't contain postcodes from Northern Ireland.","title":"GB vs UK"},{"location":"data-sources/GB-Postcodes/#importing-separately-after-the-initial-import","text":"If you forgot to download the file, or have a new version, you can import it separately: Import the downloaded gb_postcode_data.sql.gz file. Run the SQL query SELECT count(getorcreate_postcode_id(postcode)) FROM gb_postcode; . This will update the search index. Run utils/setup.php --calculate-postcodes from the build directory. This will copy data form the gb_postcode table to the location_postcodes table.","title":"Importing separately after the initial import"},{"location":"data-sources/GB-Postcodes/#converting-code-point-open-data","text":"Download from Code-Point\u00ae Open . It requires an email address where a download link will be send to. unzip codepo_gb.zip Unpacked you'll see a directory of CSV files. $ more codepo_gb/Data/CSV/n.csv \"N1 0AA\",10,530626,183961,\"E92000001\",\"E19000003\",\"E18000007\",\"\",\"E09000019\",\"E05000368\" \"N1 0AB\",10,530559,183978,\"E92000001\",\"E19000003\",\"E18000007\",\"\",\"E09000019\",\"E05000368\" The coordinates are \"Northings\" and \"Eastings\" in OSGB 1936 projection. They can be projected to WGS84 like this SELECT ST_AsText(ST_Transform(ST_SetSRID('POINT(530626 183961)'::geometry,27700), 4326)); POINT(-0.117872733220225 51.5394424719303) -0.117872733220225 51.5394424719303 on OSM map Create database, import CSV files, add geometry column, dump into file DBNAME=create_gb_postcode_file createdb $DBNAME echo 'CREATE EXTENSION postgis' | psql $DBNAME cat data/gb_postcode_table.sql | psql $DBNAME cat codepo_gb/Data/CSV/*.csv | ./data-sources/gb-postcodes/convert_codepoint.php | psql $DBNAME cat codepo_gb/Doc/licence.txt | iconv -f iso-8859-1 -t utf-8 | dos2unix | sed 's/^/-- /g' > gb_postcode_data.sql pg_dump -a -t gb_postcode $DBNAME | grep -v '^--' >> gb_postcode_data.sql gzip -9 -f gb_postcode_data.sql ls -lah gb_postcode_data.* # dropdb $DBNAME","title":"Converting Code-Point Open data"},{"location":"data-sources/US-Tiger/","text":"US TIGER address data \uf0c1 Convert TIGER /Line dataset of the US Census Bureau to SQL files which can be imported by Nominatim. The created tables in the Nominatim database are separate from OpenStreetMap tables and get queried at search time separately. The dataset gets updated once per year. Downloading is prone to be slow (can take a full day) and converting them can take hours as well. Replace '2019' with the current year throughout. Install the GDAL library and python bindings and the unzip tool # Ubuntu: sudo apt-get install python3-gdal unzip Get the TIGER 2019 data. You will need the EDGES files (3,233 zip files, 11GB total). wget -r ftp://ftp2.census.gov/geo/tiger/TIGER2019/EDGES/ Convert the data into SQL statements. Adjust the file paths in the scripts as needed cd data-sources/us-tiger ./convert.sh <input-path> <output-path> Maybe: package the created files tar -czf tiger2019-nominatim-preprocessed.tar.gz tiger","title":"US Census (Tiger)"},{"location":"data-sources/US-Tiger/#us-tiger-address-data","text":"Convert TIGER /Line dataset of the US Census Bureau to SQL files which can be imported by Nominatim. The created tables in the Nominatim database are separate from OpenStreetMap tables and get queried at search time separately. The dataset gets updated once per year. Downloading is prone to be slow (can take a full day) and converting them can take hours as well. Replace '2019' with the current year throughout. Install the GDAL library and python bindings and the unzip tool # Ubuntu: sudo apt-get install python3-gdal unzip Get the TIGER 2019 data. You will need the EDGES files (3,233 zip files, 11GB total). wget -r ftp://ftp2.census.gov/geo/tiger/TIGER2019/EDGES/ Convert the data into SQL statements. Adjust the file paths in the scripts as needed cd data-sources/us-tiger ./convert.sh <input-path> <output-path> Maybe: package the created files tar -czf tiger2019-nominatim-preprocessed.tar.gz tiger","title":"US TIGER address data"},{"location":"data-sources/Wikipedia-Wikidata/","text":"Add Wikipedia and Wikidata to Nominatim \uf0c1 OSM contributors frequently tag items with links to Wikipedia and Wikidata. Nominatim can use the page ranking of Wikipedia pages to help indicate the relative importance of osm features. This is done by calculating an importance score between 0 and 1 based on the number of inlinks to an article for a location. If two places have the same name and one is more important than the other, the wikipedia score often points to the correct place. These scripts extract and prepare both Wikipedia page rank and Wikidata links for use in Nominatim. Create a new postgres DB for Processing \uf0c1 Due to the size of initial and intermediate tables, processing can be done in an external database: CREATE DATABASE wikiprocessingdb; Wikipedia \uf0c1 Processing these data requires a large amount of disk space (~1TB) and considerable time (>24 hours). Import & Process Wikipedia tables \uf0c1 This step downloads and converts Wikipedia page data SQL dumps to postgreSQL files which can be imported and processed with pagelink information from Wikipedia language sites to calculate importance scores. The script will processes data from whatever set of Wikipedia languages are specified in the initial languages array Note that processing the top 40 Wikipedia languages can take over a day, and will add nearly 1TB to the processing database. The final output tables will be approximately 11GB and 2GB in size To download, convert, and import the data, then process summary statistics and compute importance scores, run: ./wikipedia_import.sh Wikidata \uf0c1 This script downloads and processes Wikidata to enrich the previously created Wikipedia tables for use in Nominatim. Import & Process Wikidata \uf0c1 This step downloads and converts Wikidata page data SQL dumps to postgreSQL files which can be processed and imported into Nominatim database. Also utilizes Wikidata Query Service API to discover and include place types. Script presumes that the user has already processed Wikipedia tables as specified above Script requires wikidata_place_types.txt and wikidata_place_type_levles.csv script requires the jq json parser Script processes data from whatever set of Wikipedia languages are specified in the initial languages array Script queries Wikidata Query Service API and imports all instances of place types listed in wikidata_place_types.txt Script updates wikipedia_articles table with extracted wikidata By including Wikidata in the wikipedia_articles table, new connections can be made on the fly from the Nominatim placex table to wikipedia_article importance scores. To download, convert, and import the data, then process required items, run: ./wikidata_import.sh","title":"Wikipedia & Wikidata"},{"location":"data-sources/Wikipedia-Wikidata/#add-wikipedia-and-wikidata-to-nominatim","text":"OSM contributors frequently tag items with links to Wikipedia and Wikidata. Nominatim can use the page ranking of Wikipedia pages to help indicate the relative importance of osm features. This is done by calculating an importance score between 0 and 1 based on the number of inlinks to an article for a location. If two places have the same name and one is more important than the other, the wikipedia score often points to the correct place. These scripts extract and prepare both Wikipedia page rank and Wikidata links for use in Nominatim.","title":"Add Wikipedia and Wikidata to Nominatim"},{"location":"data-sources/Wikipedia-Wikidata/#create-a-new-postgres-db-for-processing","text":"Due to the size of initial and intermediate tables, processing can be done in an external database: CREATE DATABASE wikiprocessingdb;","title":"Create a new postgres DB for Processing"},{"location":"data-sources/Wikipedia-Wikidata/#wikipedia","text":"Processing these data requires a large amount of disk space (~1TB) and considerable time (>24 hours).","title":"Wikipedia"},{"location":"data-sources/Wikipedia-Wikidata/#import-process-wikipedia-tables","text":"This step downloads and converts Wikipedia page data SQL dumps to postgreSQL files which can be imported and processed with pagelink information from Wikipedia language sites to calculate importance scores. The script will processes data from whatever set of Wikipedia languages are specified in the initial languages array Note that processing the top 40 Wikipedia languages can take over a day, and will add nearly 1TB to the processing database. The final output tables will be approximately 11GB and 2GB in size To download, convert, and import the data, then process summary statistics and compute importance scores, run: ./wikipedia_import.sh","title":"Import &amp; Process Wikipedia tables"},{"location":"data-sources/Wikipedia-Wikidata/#wikidata","text":"This script downloads and processes Wikidata to enrich the previously created Wikipedia tables for use in Nominatim.","title":"Wikidata"},{"location":"data-sources/Wikipedia-Wikidata/#import-process-wikidata","text":"This step downloads and converts Wikidata page data SQL dumps to postgreSQL files which can be processed and imported into Nominatim database. Also utilizes Wikidata Query Service API to discover and include place types. Script presumes that the user has already processed Wikipedia tables as specified above Script requires wikidata_place_types.txt and wikidata_place_type_levles.csv script requires the jq json parser Script processes data from whatever set of Wikipedia languages are specified in the initial languages array Script queries Wikidata Query Service API and imports all instances of place types listed in wikidata_place_types.txt Script updates wikipedia_articles table with extracted wikidata By including Wikidata in the wikipedia_articles table, new connections can be made on the fly from the Nominatim placex table to wikipedia_article importance scores. To download, convert, and import the data, then process required items, run: ./wikidata_import.sh","title":"Import &amp; Process Wikidata"},{"location":"data-sources/overview/","text":"Additional Data Sources \uf0c1 This guide explains how data sources other than OpenStreetMap mentioned in the install instructions got obtained and converted.","title":"Overview"},{"location":"data-sources/overview/#additional-data-sources","text":"This guide explains how data sources other than OpenStreetMap mentioned in the install instructions got obtained and converted.","title":"Additional Data Sources"},{"location":"develop/Documentation/","text":"Documentation Pages \uf0c1 The Nominatim documentation is built using the MkDocs static site generation framework. The master branch is automatically deployed every night on under https://nominatim.org/release-docs/develop/ To preview local changes: Install MkDocs pip3 install --user mkdocs In build directory run make doc INFO - Cleaning site directory INFO - Building documentation to directory: /home/vagrant/build/site-html This runs mkdocs build plus extra transformion of some files and adds symlinks (see CMakeLists.txt for the exact steps). Start webserver for local testing mkdocs serve [server:296] Serving on http://127.0.0.1:8000 [handlers:62] Start watching changes If you develop inside a Vagrant virtual machine: * add port forwarding to your Vagrantfile, e.g. config.vm.network \"forwarded_port\", guest: 8000, host: 8000 * use mkdocs serve --dev-addr 0.0.0.0:8000 because the default localhost IP does not get forwarded.","title":"Documentation"},{"location":"develop/Documentation/#documentation-pages","text":"The Nominatim documentation is built using the MkDocs static site generation framework. The master branch is automatically deployed every night on under https://nominatim.org/release-docs/develop/ To preview local changes: Install MkDocs pip3 install --user mkdocs In build directory run make doc INFO - Cleaning site directory INFO - Building documentation to directory: /home/vagrant/build/site-html This runs mkdocs build plus extra transformion of some files and adds symlinks (see CMakeLists.txt for the exact steps). Start webserver for local testing mkdocs serve [server:296] Serving on http://127.0.0.1:8000 [handlers:62] Start watching changes If you develop inside a Vagrant virtual machine: * add port forwarding to your Vagrantfile, e.g. config.vm.network \"forwarded_port\", guest: 8000, host: 8000 * use mkdocs serve --dev-addr 0.0.0.0:8000 because the default localhost IP does not get forwarded.","title":"Documentation Pages"},{"location":"develop/Import/","text":"OSM Data Import \uf0c1 OSM data is initially imported using osm2pgsql. Nominatim uses its own data output style 'gazetteer', which differs from the output style created for map rendering. Database Layout \uf0c1 The gazetteer style produces a single table place with the following rows: osm_type - kind of OSM object ( N - node, W - way, R - relation) osm_id - original OSM ID class - key of principal tag defining the object type type - value of principal tag defining the object type name - collection of tags that contain a name or reference admin_level - numerical value of the tagged administrative level address - collection of tags defining the address of an object extratags - collection of additional interesting tags that are not directly relevant for searching geometry - geometry of the object (in WGS84) A single OSM object may appear multiple times in this table when it is tagged with multiple tags that may constitute a principal tag. Take for example a motorway bridge. In OSM, this would be a way which is tagged with highway=motorway and bridge=yes . This way would appear in the place table once with class of highway and once with a class of bridge . Thus the unique key for place is ( osm_type , osm_id , class ). Configuring the Import \uf0c1 How tags are interpreted and assigned to the different place columns can be configured via the import style configuration file ( CONST_Import_style ). This is a JSON file which contains a list of rules which are matched against every tag of every object and then assign the tag its specific role. Configuration Rules \uf0c1 A single rule looks like this: { \"keys\" : [\"key1\", \"key2\", ...], \"values\" : { \"value1\" : \"prop\", \"value2\" : \"prop1,prop2\" } } A rule first defines a list of keys to apply the rule to. This is always a list of strings. The string may have four forms. An empty string matches against any key. A string that ends in an asterisk * is a prefix match and accordingly matches against any key that starts with the given string (minus the * ). A suffix match can be defined similarly with a string that starts with a * . Any other string constitutes an exact match. The second part of the rules defines a list of values and the properties that apply to a successful match. Value strings may be either empty, which means that they match any value, or describe an exact match. Prefix or suffix matching of values is not possible. For a rule to match, it has to find a valid combination of keys and values. The resulting property is that of the matched values. The rules in a configuration file are processed sequentially and the first match for each tag wins. A rule where key and value are the empty string is special. This defines the fallback when none of the rules match. The fallback is always used as a last resort when nothing else matches, no matter where the rule appears in the file. Defining multiple fallback rules is not allowed. What happens in this case, is undefined. Tag Properties \uf0c1 One or more of the following properties may be given for each tag: main A principal tag. A new row will be added for the object with key and value as class and type . with_name When the tag is a principal tag ( main property set): only really add a new row, if there is any name tag found (a reference tag is not sufficient, see below). with_name_key When the tag is a principal tag ( main property set): only really add a new row, if there is also a name tag that matches the key of the principal tag. For example, if the main tag is bridge=yes , then it will only be added as an extra row, if there is a tag bridge:name[:XXX] for the same object. If this property is set, all other names that are not domain-specific are ignored. fallback When the tag is a principal tag ( main property set): only really add a new row, when no other principal tags for this object have been found. Only one fallback tag can win for an object. operator When the tag is a principal tag ( main property set): also include the operator tag in the list of names. This is a special construct for an out-dated tagging practise in OSM. Fuel stations and chain restaurants in particular used to have the name of the chain tagged as operator . These days the chain can be more commonly found in the brand tag but there is still enough old data around to warrant this special case. name Add tag to the list of names. ref Add tag to the list of names as a reference. At the moment this only means that the object is not considered to be named for with_name . address Add tag to the list of address tags. If the tag starts with addr: or is_in: , then this prefix is cut off before adding it to the list. postcode Add the value as a postcode to the address tags. If multiple tags are candidate for postcodes, one wins out and the others are dropped. country Add the value as a country code to the address tags. The value must be a two letter country code, otherwise it is ignored. If there are multiple tags that match, then one wins out and the others are dropped. house If no principle tags can be found for the object, still add the object with class = place and type = house . Use this for address nodes that have no other function. interpolation Add this object as an address interpolation (appears as class = place and type = houses in the database). extra Add tag to the list of extra tags. skip Skip the tag completely. Useful when a custom default fallback is defined or to define exceptions to rules. A rule can define as many of these properties for one match as it likes. For example, if the property is \"main,extra\" then the tag will open a new row but also have the tag appear in the list of extra tags. There are a number of pre-defined styles in the settings/ directory. It is advisable to start from one of these styles when defining your own. Changing the Style of Existing Databases \uf0c1 There is normally no issue changing the style of a database that is already imported and now kept up-to-date with change files. Just be aware that any change in the style applies to updates only. If you want to change the data that is already in the database, then a reimport is necessary.","title":"OSM Data Import"},{"location":"develop/Import/#osm-data-import","text":"OSM data is initially imported using osm2pgsql. Nominatim uses its own data output style 'gazetteer', which differs from the output style created for map rendering.","title":"OSM Data Import"},{"location":"develop/Import/#database-layout","text":"The gazetteer style produces a single table place with the following rows: osm_type - kind of OSM object ( N - node, W - way, R - relation) osm_id - original OSM ID class - key of principal tag defining the object type type - value of principal tag defining the object type name - collection of tags that contain a name or reference admin_level - numerical value of the tagged administrative level address - collection of tags defining the address of an object extratags - collection of additional interesting tags that are not directly relevant for searching geometry - geometry of the object (in WGS84) A single OSM object may appear multiple times in this table when it is tagged with multiple tags that may constitute a principal tag. Take for example a motorway bridge. In OSM, this would be a way which is tagged with highway=motorway and bridge=yes . This way would appear in the place table once with class of highway and once with a class of bridge . Thus the unique key for place is ( osm_type , osm_id , class ).","title":"Database Layout"},{"location":"develop/Import/#configuring-the-import","text":"How tags are interpreted and assigned to the different place columns can be configured via the import style configuration file ( CONST_Import_style ). This is a JSON file which contains a list of rules which are matched against every tag of every object and then assign the tag its specific role.","title":"Configuring the Import"},{"location":"develop/Import/#configuration-rules","text":"A single rule looks like this: { \"keys\" : [\"key1\", \"key2\", ...], \"values\" : { \"value1\" : \"prop\", \"value2\" : \"prop1,prop2\" } } A rule first defines a list of keys to apply the rule to. This is always a list of strings. The string may have four forms. An empty string matches against any key. A string that ends in an asterisk * is a prefix match and accordingly matches against any key that starts with the given string (minus the * ). A suffix match can be defined similarly with a string that starts with a * . Any other string constitutes an exact match. The second part of the rules defines a list of values and the properties that apply to a successful match. Value strings may be either empty, which means that they match any value, or describe an exact match. Prefix or suffix matching of values is not possible. For a rule to match, it has to find a valid combination of keys and values. The resulting property is that of the matched values. The rules in a configuration file are processed sequentially and the first match for each tag wins. A rule where key and value are the empty string is special. This defines the fallback when none of the rules match. The fallback is always used as a last resort when nothing else matches, no matter where the rule appears in the file. Defining multiple fallback rules is not allowed. What happens in this case, is undefined.","title":"Configuration Rules"},{"location":"develop/Import/#tag-properties","text":"One or more of the following properties may be given for each tag: main A principal tag. A new row will be added for the object with key and value as class and type . with_name When the tag is a principal tag ( main property set): only really add a new row, if there is any name tag found (a reference tag is not sufficient, see below). with_name_key When the tag is a principal tag ( main property set): only really add a new row, if there is also a name tag that matches the key of the principal tag. For example, if the main tag is bridge=yes , then it will only be added as an extra row, if there is a tag bridge:name[:XXX] for the same object. If this property is set, all other names that are not domain-specific are ignored. fallback When the tag is a principal tag ( main property set): only really add a new row, when no other principal tags for this object have been found. Only one fallback tag can win for an object. operator When the tag is a principal tag ( main property set): also include the operator tag in the list of names. This is a special construct for an out-dated tagging practise in OSM. Fuel stations and chain restaurants in particular used to have the name of the chain tagged as operator . These days the chain can be more commonly found in the brand tag but there is still enough old data around to warrant this special case. name Add tag to the list of names. ref Add tag to the list of names as a reference. At the moment this only means that the object is not considered to be named for with_name . address Add tag to the list of address tags. If the tag starts with addr: or is_in: , then this prefix is cut off before adding it to the list. postcode Add the value as a postcode to the address tags. If multiple tags are candidate for postcodes, one wins out and the others are dropped. country Add the value as a country code to the address tags. The value must be a two letter country code, otherwise it is ignored. If there are multiple tags that match, then one wins out and the others are dropped. house If no principle tags can be found for the object, still add the object with class = place and type = house . Use this for address nodes that have no other function. interpolation Add this object as an address interpolation (appears as class = place and type = houses in the database). extra Add tag to the list of extra tags. skip Skip the tag completely. Useful when a custom default fallback is defined or to define exceptions to rules. A rule can define as many of these properties for one match as it likes. For example, if the property is \"main,extra\" then the tag will open a new row but also have the tag appear in the list of extra tags. There are a number of pre-defined styles in the settings/ directory. It is advisable to start from one of these styles when defining your own.","title":"Tag Properties"},{"location":"develop/Import/#changing-the-style-of-existing-databases","text":"There is normally no issue changing the style of a database that is already imported and now kept up-to-date with change files. Just be aware that any change in the style applies to updates only. If you want to change the data that is already in the database, then a reimport is necessary.","title":"Changing the Style of Existing Databases"},{"location":"develop/Ranking/","text":"Place Ranking in Nominatim \uf0c1 Nominatim uses two metrics to rank a place: search rank and address rank. Both can be assigned a value between 0 and 30. They serve slightly different purposes, which are explained in this chapter. Search rank \uf0c1 The search rank describes the extent and importance of a place. It is used when ranking search result. Simply put, if there are two results for a search query which are otherwise equal, then the result with the lower search rank will be appear higher in the result list. Search ranks are not so important these days because many well-known places use the Wikipedia importance ranking instead. Address rank \uf0c1 The address rank describes where a place shows up in an address hierarchy. Usually only administrative boundaries and place nodes and areas are eligible to be part of an address. All other objects have an address rank of 0. Note that the search rank of a place plays a role in the address computation as well. When collecting the places that should make up the address parts then only places are taken into account that have a lower address rank than the search rank of the base object. Rank configuration \uf0c1 Search and address ranks are assigned to a place when it is first imported into the database. There are a few hard-coded rules for the assignment: postcodes follow special rules according to their length boundaries that are not areas and railway=rail are dropped completely the following are always search rank 30 and address rank 0: highway nodes landuse that is not an area Other than that, the ranks can be freely assigned via the JSON file defined with CONST_Address_Level_Config according to their type and the country they are in. The address level configuration must consist of an array of configuration entries, each containing a tag definition and an optional country array: [ { \"tags\" : { \"place\" : { \"county\" : 12, \"city\" : 16, }, \"landuse\" : { \"residential\" : 22, \"\" : 30 } } }, { \"countries\" : [ \"ca\", \"us\" ], \"tags\" : { \"boundary\" : { \"administrative8\" : 18, \"administrative9\" : 20 }, \"landuse\" : { \"residential\" : [22, 0] } } } ] The countries field contains a list of countries (as ISO 3166-1 alpha 2 code) for which the definition applies. When the field is omitted, then the definition is used as a fallback, when nothing more specific for a given country exists. tags contains the ranks for key/value pairs. The ranks can be either a single number, in which case they are the search and address rank, or an array of search and address rank (in that order). The value may be left empty. Then the rank is used when no more specific value is found for the given key. Countries and key/value combination may appear in multiple definitions. Just make sure that each combination of counrty/key/value appears only once per file. Otherwise the import will fail with a UNIQUE INDEX constraint violation on import.","title":"Place Ranking"},{"location":"develop/Ranking/#place-ranking-in-nominatim","text":"Nominatim uses two metrics to rank a place: search rank and address rank. Both can be assigned a value between 0 and 30. They serve slightly different purposes, which are explained in this chapter.","title":"Place Ranking in Nominatim"},{"location":"develop/Ranking/#search-rank","text":"The search rank describes the extent and importance of a place. It is used when ranking search result. Simply put, if there are two results for a search query which are otherwise equal, then the result with the lower search rank will be appear higher in the result list. Search ranks are not so important these days because many well-known places use the Wikipedia importance ranking instead.","title":"Search rank"},{"location":"develop/Ranking/#address-rank","text":"The address rank describes where a place shows up in an address hierarchy. Usually only administrative boundaries and place nodes and areas are eligible to be part of an address. All other objects have an address rank of 0. Note that the search rank of a place plays a role in the address computation as well. When collecting the places that should make up the address parts then only places are taken into account that have a lower address rank than the search rank of the base object.","title":"Address rank"},{"location":"develop/Ranking/#rank-configuration","text":"Search and address ranks are assigned to a place when it is first imported into the database. There are a few hard-coded rules for the assignment: postcodes follow special rules according to their length boundaries that are not areas and railway=rail are dropped completely the following are always search rank 30 and address rank 0: highway nodes landuse that is not an area Other than that, the ranks can be freely assigned via the JSON file defined with CONST_Address_Level_Config according to their type and the country they are in. The address level configuration must consist of an array of configuration entries, each containing a tag definition and an optional country array: [ { \"tags\" : { \"place\" : { \"county\" : 12, \"city\" : 16, }, \"landuse\" : { \"residential\" : 22, \"\" : 30 } } }, { \"countries\" : [ \"ca\", \"us\" ], \"tags\" : { \"boundary\" : { \"administrative8\" : 18, \"administrative9\" : 20 }, \"landuse\" : { \"residential\" : [22, 0] } } } ] The countries field contains a list of countries (as ISO 3166-1 alpha 2 code) for which the definition applies. When the field is omitted, then the definition is used as a fallback, when nothing more specific for a given country exists. tags contains the ranks for key/value pairs. The ranks can be either a single number, in which case they are the search and address rank, or an array of search and address rank (in that order). The value may be left empty. Then the rank is used when no more specific value is found for the given key. Countries and key/value combination may appear in multiple definitions. Just make sure that each combination of counrty/key/value appears only once per file. Otherwise the import will fail with a UNIQUE INDEX constraint violation on import.","title":"Rank configuration"},{"location":"develop/overview/","text":"Basic Architecture \uf0c1 Nominatim provides geocoding based on OpenStreetMap data. It uses a PostgreSQL database as a backend for storing the data. There are three basic parts to Nominatim's architecture: the data import, the address computation and the search frontend. The data import stage reads the raw OSM data and extracts all information that is useful for geocoding. This part is done by osm2pgsql, the same tool that can also be used to import a rendering database. It uses the special gazetteer output plugin in osm2pgsql/output-gazetter.[ch]pp . The result of the import can be found in the database table place . The address computation or indexing stage takes the data from place and adds additional information needed for geocoding. It ranks the places by importance, links objects that belong together and computes addresses and the search index. Most of this work is done in PL/pgSQL via database triggers and can be found in the file sql/functions.sql . The search frontend implements the actual API. It takes search and reverse geocoding queries from the user, looks up the data and returns the results in the requested format. This part is written in PHP and can be found in the lib/ and website/ directories.","title":"Overview"},{"location":"develop/overview/#basic-architecture","text":"Nominatim provides geocoding based on OpenStreetMap data. It uses a PostgreSQL database as a backend for storing the data. There are three basic parts to Nominatim's architecture: the data import, the address computation and the search frontend. The data import stage reads the raw OSM data and extracts all information that is useful for geocoding. This part is done by osm2pgsql, the same tool that can also be used to import a rendering database. It uses the special gazetteer output plugin in osm2pgsql/output-gazetter.[ch]pp . The result of the import can be found in the database table place . The address computation or indexing stage takes the data from place and adds additional information needed for geocoding. It ranks the places by importance, links objects that belong together and computes addresses and the search index. Most of this work is done in PL/pgSQL via database triggers and can be found in the file sql/functions.sql . The search frontend implements the actual API. It takes search and reverse geocoding queries from the user, looks up the data and returns the results in the requested format. This part is written in PHP and can be found in the lib/ and website/ directories.","title":"Basic Architecture"}]}