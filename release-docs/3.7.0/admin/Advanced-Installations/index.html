<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://nominatim.org/admin/Advanced-Installations/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Advanced Installations - Nominatim 3.7.0</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  <link href="../../styles.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Advanced Installations";
    var mkdocs_page_input_path = "admin/Advanced-Installations.md";
    var mkdocs_page_url = "/admin/Advanced-Installations/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Nominatim 3.7.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Search/">Search</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Reverse/">Reverse</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Lookup/">Address Lookup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Details/">Details</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Status/">Status</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Output/">Place Output Formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/Faq/">FAQ</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Administration Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../Installation/">Basic Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Import/">Import</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Update/">Update</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Deployment/">Deploy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Setup-Nominatim-UI/">Nominatim UI</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Advanced Installations</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#importing-multiple-regions">Importing multiple regions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#configuring-multiple-regions">Configuring multiple regions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-multiple-regions">Setting up multiple regions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#updating-multiple-regions">Updating multiple regions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuring-multiple-regions_1">Configuring multiple regions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#updating-the-database">Updating the database</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#importing-nominatim-to-an-external-postgresql-database">Importing Nominatim to an external PostgreSQL database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#option-1-compiling-the-library-on-the-database-server">Option 1: Compiling the library on the database server</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#option-2-compiling-the-library-on-the-import-machine">Option 2: Compiling the library on the import machine</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#running-the-import">Running the import</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Migration/">Migration from older Versions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Faq/">Troubleshooting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developers Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Development-Environment/">Setup for Development</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/overview/">Architecture Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Import/">OSM Data Import</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Ranking/">Place Ranking</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Postcodes/">Postcodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/Testing/">Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../develop/data-sources/">External Data Sources</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Appendix</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Centos-7/">Installation on CentOS 7</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Centos-8/">Installation on CentOS 8</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-18/">Installation on Ubuntu 18</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../appendix/Install-on-Ubuntu-20/">Installation on Ubuntu 20</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Nominatim 3.7.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration Guide &raquo;</li>
        
      
    
    <li>Advanced Installations</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/openstreetmap/Nominatim/edit/master/docs/admin/Advanced-Installations.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="advanced-installations">Advanced installations<a class="headerlink" href="#advanced-installations" title="Permanent link"></a></h1>
<p>This page contains instructions for setting up multiple countries in 
your Nominatim database. It is assumed that you have already successfully
installed the Nominatim software itself, if not return to the 
<a href="../Installation/">installation page</a>.</p>
<h2 id="importing-multiple-regions">Importing multiple regions<a class="headerlink" href="#importing-multiple-regions" title="Permanent link"></a></h2>
<p>To import multiple regions in your database, you need to configure and run <code>utils/import_multiple_regions.sh</code> file. This script will set up the update directory which has the following structure:</p>
<div class="codehilite"><pre><span></span><code>update
    ├── europe
    │   ├── andorra
    │   │   └── sequence.state
    │   └── monaco
    │       └── sequence.state
    └── tmp
        ├── combined.osm.pbf
        └── europe
                ├── andorra-latest.osm.pbf
                └── monaco-latest.osm.pbf
</code></pre></div>


<p>The <code>sequence.state</code> files will contain the sequence ID, which will be used by pyosmium to get updates. The tmp folder is used for import dump.</p>
<h3 id="configuring-multiple-regions">Configuring multiple regions<a class="headerlink" href="#configuring-multiple-regions" title="Permanent link"></a></h3>
<p>The file <code>import_multiple_regions.sh</code> needs to be edited as per your requirement:</p>
<ol>
<li>
<p>List of countries. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">COUNTRIES=&quot;europe/monaco europe/andorra&quot;</span>
</code></pre></div>


</li>
<li>
<p>Path to Build directory. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">NOMINATIMBUILD=&quot;/srv/nominatim/build&quot;</span>
</code></pre></div>


</li>
<li>
<p>Path to Update directory. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">UPDATEDIR=&quot;/srv/nominatim/update&quot;</span>
</code></pre></div>


</li>
<li>
<p>Replication URL. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">BASEURL=&quot;https://download.geofabrik.de&quot;</span>
<span class="err">DOWNCOUNTRYPOSTFIX=&quot;-latest.osm.pbf&quot;</span>
</code></pre></div>


</li>
</ol>
<h3 id="setting-up-multiple-regions">Setting up multiple regions<a class="headerlink" href="#setting-up-multiple-regions" title="Permanent link"></a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your database already exists and you want to add more countries,
replace the setting up part
<code>${SETUPFILE} --osm-file ${UPDATEDIR}/tmp/combined.osm.pbf --all 2&gt;&amp;1</code>
with <code>${UPDATEFILE} --import-file ${UPDATEDIR}/tmp/combined.osm.pbf --index --index-instances N 2&gt;&amp;1</code>
where N is the numbers of CPUs in your system.</p>
</div>
<p>Run the following command from your Nominatim directory after configuring the file.</p>
<div class="codehilite"><pre><span></span><code><span class="err">bash ./utils/import_multiple_regions.sh</span>
</code></pre></div>


<div class="admonition danger">
<p class="admonition-title">Important<p>This file uses osmium-tool. It must be installed before executing the import script.
Installation instructions can be found <a href="https://osmcode.org/osmium-tool/manual.html#installation">here</a>.</p>
</p>
</div>
<h3 id="updating-multiple-regions">Updating multiple regions<a class="headerlink" href="#updating-multiple-regions" title="Permanent link"></a></h3>
<p>To import multiple regions in your database, you need to configure and run <code>utils/update_database.sh</code>.
This uses the update directory set up while setting up the DB.   </p>
<h3 id="configuring-multiple-regions_1">Configuring multiple regions<a class="headerlink" href="#configuring-multiple-regions_1" title="Permanent link"></a></h3>
<p>The file <code>update_database.sh</code> needs to be edited as per your requirement:</p>
<ol>
<li>
<p>List of countries. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">COUNTRIES=&quot;europe/monaco europe/andorra&quot;</span>
</code></pre></div>


</li>
<li>
<p>Path to Build directory. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">NOMINATIMBUILD=&quot;/srv/nominatim/build&quot;</span>
</code></pre></div>


</li>
<li>
<p>Path to Update directory. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">UPDATEDIR=&quot;/srv/nominatim/update&quot;</span>
</code></pre></div>


</li>
<li>
<p>Replication URL. eg:</p>
<div class="codehilite"><pre><span></span><code><span class="err">BASEURL=&quot;https://download.geofabrik.de&quot;</span>
<span class="err">DOWNCOUNTRYPOSTFIX=&quot;-updates&quot;</span>
</code></pre></div>


</li>
<li>
<p>Followup can be set according to your installation. eg: For Photon,</p>
<div class="codehilite"><pre><span></span><code><span class="err">FOLLOWUP=&quot;curl http://localhost:2322/nominatim-update&quot;</span>
</code></pre></div>


<p>will handle the indexing.</p>
</li>
</ol>
<h3 id="updating-the-database">Updating the database<a class="headerlink" href="#updating-the-database" title="Permanent link"></a></h3>
<p>Run the following command from your Nominatim directory after configuring the file.</p>
<div class="codehilite"><pre><span></span><code><span class="err">bash ./utils/update_database.sh</span>
</code></pre></div>


<p>This will get diffs from the replication server, import diffs and index the database. The default replication server in the script(<a href="https://download.geofabrik.de">Geofabrik</a>) provides daily updates.</p>
<h2 id="importing-nominatim-to-an-external-postgresql-database">Importing Nominatim to an external PostgreSQL database<a class="headerlink" href="#importing-nominatim-to-an-external-postgresql-database" title="Permanent link"></a></h2>
<p>You can install Nominatim using a database that runs on a different server when
you have physical access to the file system on the other server. Nominatim
uses a custom normalization library that needs to be made accessible to the
PostgreSQL server. This section explains how to set up the normalization
library.</p>
<h3 id="option-1-compiling-the-library-on-the-database-server">Option 1: Compiling the library on the database server<a class="headerlink" href="#option-1-compiling-the-library-on-the-database-server" title="Permanent link"></a></h3>
<p>The most sure way to get a working library is to compile it on the database
server. From the prerequisites you need at least cmake, gcc and the
PostgreSQL server package.</p>
<p>Clone or unpack the Nominatim source code, enter the source directory and
create and enter a build directory.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> Nominatim
mkdir build
<span class="nb">cd</span> build
</code></pre></div>


<p>Now configure cmake to only build the PostgreSQL module and build it:</p>
<div class="codehilite"><pre><span></span><code><span class="err">cmake -DBUILD_IMPORTER=off -DBUILD_API=off -DBUILD_TESTS=off -DBUILD_DOCS=off -DBUILD_OSM2PGSQL=off ..</span>
<span class="err">make</span>
</code></pre></div>


<p>When done, you find the normalization library in <code>build/module/nominatim.so</code>.
Copy it to a place where it is readable and executable by the PostgreSQL server
process.</p>
<h3 id="option-2-compiling-the-library-on-the-import-machine">Option 2: Compiling the library on the import machine<a class="headerlink" href="#option-2-compiling-the-library-on-the-import-machine" title="Permanent link"></a></h3>
<p>You can also compile the normalization library on the machine from where you
run the import.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can only do this when the database server and the import machine have
the same architecture and run the same version of Linux. Otherwise there is
no guarantee that the compiled library is compatible with the PostgreSQL
server running on the database server.</p>
</div>
<p>Make sure that the PostgreSQL server package is installed on the machine
<strong>with the same version as on the database server</strong>. You do not need to install
the PostgreSQL server itself.</p>
<p>Download and compile Nominatim as per standard instructions. Once done, you find
the normalization library in <code>build/module/nominatim.so</code>. Copy the file to
the database server at a location where it is readable and executable by the
PostgreSQL server process.</p>
<h3 id="running-the-import">Running the import<a class="headerlink" href="#running-the-import" title="Permanent link"></a></h3>
<p>On the client side you now need to configure the import to point to the
correct location of the library <strong>on the database server</strong>. Add the following
line to your your <code>.env</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="x">NOMINATIM_DATABASE_MODULE_PATH=&quot;&lt;directory on the database server where nominatim.so resides&gt;&quot;</span>
</code></pre></div>


<p>Now change the <code>NOMINATIM_DATABASE_DSN</code> to point to your remote server and continue
to follow the <a href="/admin/Import">standard instructions for importing</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Migration/" class="btn btn-neutral float-right" title="Migration from older Versions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Setup-Nominatim-UI/" class="btn btn-neutral" title="Nominatim UI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/openstreetmap/Nominatim/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../Setup-Nominatim-UI/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Migration/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
